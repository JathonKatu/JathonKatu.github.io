{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/jquery-3.6.4.min.js","path":"js/jquery-3.6.4.min.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"b108304e4179cc4bc24287cbfca52df25dded403","modified":1758349085581},{"_id":"themes/landscape/.npmignore","hash":"4c40eab00f24304ca400313319c58d461788ff5e","modified":1758252604854},{"_id":"themes/landscape/README.md","hash":"6497b70356271fd6f9f1dc862353be844c457a53","modified":1758293076538},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1758293055396},{"_id":"themes/landscape/_config.yml","hash":"a93d7b3990e45bc7247eecf01888f71674887a63","modified":1758293078098},{"_id":"themes/landscape/.gitignore","hash":"dde61fc2d985d9256a5041e55b285d6803b9010d","modified":1758252604854},{"_id":"themes/landscape/.github/dependabot.yml","hash":"055a7e8776cb1e01c2c489fee80f3e51472a683c","modified":1758252604831},{"_id":"themes/landscape/package.json","hash":"06889bee30e4c39479467021da434d3a6a0990fc","modified":1758293076279},{"_id":"themes/landscape/languages/de-DE.yml","hash":"d29d1c4256b7ed9df42f511c2ff0a23ad5fd6c1f","modified":1758252604856},{"_id":"themes/landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1758293078196},{"_id":"themes/landscape/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1758252604856},{"_id":"themes/landscape/languages/en-GB.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1758252604856},{"_id":"themes/landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1758293078321},{"_id":"themes/landscape/languages/en-US.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1758252604857},{"_id":"themes/landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1758293078355},{"_id":"themes/landscape/languages/es-ES.yml","hash":"7008a8fc91f18d2a735864817b8ebda30c7a2c66","modified":1758252604888},{"_id":"themes/landscape/languages/fr-FR.yml","hash":"8d09dbdab00a30a2870b56f7c0a7ca7deafa7b88","modified":1758252604888},{"_id":"themes/landscape/languages/hu-HU.yml","hash":"712d18664898fa21ba38d4973e90ef41a324ea25","modified":1758252604889},{"_id":"themes/landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1758293078403},{"_id":"themes/landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1758293078463},{"_id":"themes/landscape/languages/it-IT.yml","hash":"2cb6dc2fab9bd2dbe1c8bb869a9e8bf85a564fdd","modified":1758252604889},{"_id":"themes/landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1758293078867},{"_id":"themes/landscape/languages/ja-JP.yml","hash":"08481267e0c112e1f6855620f2837ec4c4a98bbd","modified":1758252604890},{"_id":"themes/landscape/languages/ko-KR.yml","hash":"19209ad8f9d4057e8df808937f950eb265e1db69","modified":1758252604892},{"_id":"themes/landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1758293079194},{"_id":"themes/landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1758293079030},{"_id":"themes/landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1758293079268},{"_id":"themes/landscape/languages/mn-MN.yml","hash":"b9e5f3e7c0c2f779cf2cfded6db847b5941637ca","modified":1758252604894},{"_id":"themes/landscape/languages/nl-NL.yml","hash":"5ebbc30021f05d99938f96dfff280392df7f91f0","modified":1758252604896},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1758293079405},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1758293079366},{"_id":"themes/landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1758293079479},{"_id":"themes/landscape/languages/pt-PT.yml","hash":"0f852b6b228e6ea59aa3540574bb89b233f2a098","modified":1758252604899},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1758293079509},{"_id":"themes/landscape/languages/th-TH.yml","hash":"ebfdba9bc4842c829473c1e6e4544344f182724d","modified":1758252604901},{"_id":"themes/landscape/languages/ru-RU.yml","hash":"360d11a28bb768afb1dd15f63fa7fd3a8cc547ee","modified":1758252604900},{"_id":"themes/landscape/languages/th.yml","hash":"84a55b00aa01f03982be294e43c33a20e6d32862","modified":1758252604901},{"_id":"themes/landscape/layout/archive.ejs","hash":"97160b8111dd0283f8231408bcab4c87d31c1646","modified":1758252604932},{"_id":"themes/landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":1758293079550},{"_id":"themes/landscape/layout/category.ejs","hash":"97160b8111dd0283f8231408bcab4c87d31c1646","modified":1758252604933},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1758293079575},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":1758293079560},{"_id":"themes/landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":1758293074307},{"_id":"themes/landscape/layout/index.ejs","hash":"57281fc3812c877ec2d8e89ec87ede57b9789d4c","modified":1758252604933},{"_id":"themes/landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":1758293067867},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1758252604934},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1758252604935},{"_id":"themes/landscape/.github/workflows/deploy.yml","hash":"b799ce8c96f9dac93b32684c3ca1d92de2ede567","modified":1758252604831},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1758293060142},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"1b89d0caba03a66a43d9c290a5e94fa438a89210","modified":1758293059036},{"_id":"themes/landscape/layout/tag.ejs","hash":"97160b8111dd0283f8231408bcab4c87d31c1646","modified":1758252604935},{"_id":"themes/landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":1758293066448},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"0039146b8ccbdf9b9f8bee58fc6c238f0e9921fc","modified":1758293060980},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"e9d4678e14be5e3cd5e34d783e5af6d6626092f5","modified":1758293063110},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":1758293066585},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":1758293065911},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1758293067935},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1758293061815},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"6a5033d189554c9a6d42e2ef7952ae5c9742648e","modified":1758293067583},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"0e94f5722d4c44d3cc91be2f4fd30b9ab503b868","modified":1758293067152},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1758293070496},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1758252604945},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":1758293069776},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1758293064511},{"_id":"themes/landscape/source/css/_variables.styl","hash":"ca28281423ae57d76b6c1eb91cd845fd4e518bd6","modified":1758293076905},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1758293072373},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1758293072899},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1758293076891},{"_id":"themes/landscape/source/css/style.styl","hash":"e55a1d92954ed20f6887f92dc727bb995a010a43","modified":1758293078022},{"_id":"themes/landscape/source/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1758293075802},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1758293063650},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":1758293065688},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1758293068049},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1758293066211},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1758293071741},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1758293076944},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"f608400a08cf137ab15ec1f44bac551950afe879","modified":1758293076979},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1758293077039},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"9cc3b2927d814f2f6e8e188f9d3657b94f4c6ef3","modified":1758293077178},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1758293077004},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"268d2989acb06e2ddd06cc36a6918c6cd865476b","modified":1758293077128},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1758293077814},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1758293077905},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1758293077626},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1758293077981},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1758293077100},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1758293077205},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":1758293073001},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1758293075698},{"_id":"themes/landscape/source/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1758293075227},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1758252604944},{"_id":"public/2025/09/19/hello-world/index.html","hash":"2eec626a8a4410c81d47d23006a0d7916be63ba8","modified":1758293095921},{"_id":"public/archives/index.html","hash":"e6442ec2f445804f2047f305d913a04f19cbbe7c","modified":1758293095921},{"_id":"public/archives/2025/index.html","hash":"a1c7858974a4dce4dd0c5e34093cad7203a82094","modified":1758293095921},{"_id":"public/archives/2025/09/index.html","hash":"2e8e0e6c71aa82755bedeefb8e0aa2b985141828","modified":1758293095921},{"_id":"public/categories/æ—¥è®°/index.html","hash":"8b6a76b5f677dbdd4d7eb8bdc2827c379a1faa6a","modified":1758293095921},{"_id":"public/index.html","hash":"5c87511db40ccd6f12b95a57117dfccaf9da8b8b","modified":1758293095921},{"_id":"public/tags/Hexo/index.html","hash":"18fd9ee0af4294cf5a86a9033438c3d680d66da4","modified":1758293095921},{"_id":"public/tags/åšå®¢/index.html","hash":"c76b653363a8381081a655435a1b46a261807dda","modified":1758252791634},{"_id":"public/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1758293095921},{"_id":"public/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1758293095921},{"_id":"public/css/style.css","hash":"ecc329be740a220cc188ff49b02da4847cb7ee5e","modified":1758293095921},{"_id":"public/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1758293095921},{"_id":"public/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1758293095921},{"_id":"public/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1758293095921},{"_id":"public/tags/Java/index.html","hash":"9c4aa33a83a03e45c5fc28f392598a38e7b10fae","modified":1758293095921},{"_id":"public/tags/Python/index.html","hash":"fc7b25eea840c974388354cfe18704e3c471e926","modified":1758252791634},{"_id":"public/tags/AI/index.html","hash":"5d7cb0f203c67a1b2e3dd28b5df6352aa4cb0185","modified":1758252791634},{"_id":"source/_posts/RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯».md","hash":"518ce7e84c5c3556865bc9a3412824ce2778d167","modified":1758694161204},{"_id":"source/_drafts/todo-list.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1758349173310},{"_id":"public/2025/09/19/RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯»/index.html","hash":"f7d85b102e07ec8428eaa50a017804b81b1d0e2a","modified":1758293095921},{"_id":"public/tags/RocketMQ/index.html","hash":"0949bc29f15faa862ea67d22fce7158972e56e1f","modified":1758293095921},{"_id":"public/tags/åˆ†å¸ƒå¼/index.html","hash":"5acd8f5e0fe34595828a27fb3f0e99bb19d3e79f","modified":1758293095921},{"_id":"public/tags/æ¶æ„/index.html","hash":"b7654074ca88eaa169714b57ff23f3e07c64a41c","modified":1758293095921},{"_id":"public/tags/æ¶ˆæ¯é˜Ÿåˆ—/index.html","hash":"1fb88f6532d8e891f164968082d0b15c0898f584","modified":1758293095921},{"_id":"public/tags/æºç /index.html","hash":"de866d0d136c64b09ace2e6ebccb1126614b8639","modified":1758293095921},{"_id":"public/categories/æŠ€æœ¯åˆ†äº«/å­¦ä¹ è®°å½•/index.html","hash":"5955dae408dea05f7efac0adb7b27e16ef1f8c6c","modified":1758293095921},{"_id":"public/categories/æŠ€æœ¯åˆ†äº«/index.html","hash":"b47a1d319a49d503effd8d97307cb8477c86e748","modified":1758293095921},{"_id":"source/_posts/todo-list.md","hash":"a15078d2d4ed881ca44d483f24840d4c970699bc","modified":1758779309512},{"_id":"source/_posts/è¥å…»å­¦è¯•å¬è¯¾-1.md","hash":"0f85120c2820976655ddb6f2c2ca27e960f526e8","modified":1758870201282},{"_id":"source/_posts/20250928_Nutritio_catalog.md","hash":"298eb544b6641faffaeaec9262af5955f5f3d631","modified":1759026051057}],"Category":[{"name":"æ—¥è®°","_id":"cmfqa7j9q0001k4u7dcu13wqm"},{"name":"æŠ€æœ¯åˆ†äº«","_id":"cmfqf6qtl0001kgu7gr5da4wd"},{"name":"å­¦ä¹ è®°å½•","parent":"cmfqf6qtl0001kgu7gr5da4wd","_id":"cmfqf6qtn0004kgu77vo0bvzo"},{"name":"å­¦ä¹ ç›®å½•","parent":"cmfqf6qtl0001kgu7gr5da4wd","_id":"cmfxl35cw0003mwu70ovdcbrd"},{"name":"è¥å…»å­¦","_id":"cmfz1q7lt0001wou78y7t9q6s"},{"name":"è¯•å¬ç¬”è®°1","parent":"cmfz1q7lt0001wou78y7t9q6s","_id":"cmfz1q7lu0004wou70dypba1q"},{"name":"æ­£è¯¾ç¬”è®°","parent":"cmfz1q7lt0001wou78y7t9q6s","_id":"cmg32pkil0002sou710gk60zb"},{"name":"è¯•å¬ç¬”è®°","parent":"cmfz1q7lt0001wou78y7t9q6s","_id":"cmg32pkin0005sou7e8xxcso9"}],"Data":[],"Page":[],"Post":[{"title":"Hello World","date":"2025-09-19T03:30:00.000Z","_content":"\næ¬¢è¿æ¥åˆ°æˆ‘çš„å…¨æ–°Hexoåšå®¢ï¼\n\nè¿™æ˜¯ä¸€ä¸ªå…¨æ–°å¼€å§‹çš„æŠ€æœ¯åšå®¢ï¼Œæˆ‘å°†åœ¨è¿™é‡Œåˆ†äº«ï¼š\n\n## ä¸»è¦å†…å®¹\n\n- **Javaå¼€å‘** - æºç åˆ†æã€Springç”Ÿæ€ã€å¾®æœåŠ¡æ¶æ„ã€JVMè°ƒä¼˜\n- **Pythonç¼–ç¨‹** - åŸºç¡€è¯­æ³•ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æ¡†æ¶\n- **ç½‘ç»œå®‰å…¨** - å…¥ä¾µæ£€æµ‹ã€å®‰å…¨é˜²æŠ¤ã€æ¸—é€æµ‹è¯•ã€å®‰å…¨æ¶æ„è®¾è®¡\n- **åˆ†å¸ƒå¼ç³»ç»Ÿ** - å¾®æœåŠ¡æ¶æ„ã€æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é«˜å¯ç”¨è®¾è®¡\n- **ç³»ç»Ÿæ¶æ„** - æ¶æ„è®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–ã€å®¹å™¨åŒ–éƒ¨ç½²ã€äº‘åŸç”Ÿ\n- **äººå·¥æ™ºèƒ½** - æœºå™¨å­¦ä¹ ç®—æ³•ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰\n- **æ•°æ®åº“æŠ€æœ¯** - SQLä¼˜åŒ–ã€NoSQLã€åˆ†å¸ƒå¼æ•°æ®åº“ã€æ•°æ®ä»“åº“\n- **å¼€å‘å·¥å…·** - Gitä½¿ç”¨ã€IDEé…ç½®ã€CI/CDã€DevOpså®è·µ\n\n## åšå®¢ç‰¹è‰²\n\nâœ¨ **æŠ€æœ¯æ·±åº¦** - ä¸ä»…ä»…æ˜¯ä½¿ç”¨ï¼Œæ›´æ³¨é‡åŸç†ç†è§£å’Œæºç åˆ†æ  \nğŸš€ **å®æˆ˜å¯¼å‘** - ç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œåˆ†äº«æ¶æ„è®¾è®¡å’Œè§£å†³æ–¹æ¡ˆ  \nğŸ“š **æŒç»­å­¦ä¹ ** - è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œåˆ†äº«å‰æ²¿æŠ€æœ¯è¶‹åŠ¿  \nğŸ”§ **å·¥å…·åˆ†äº«** - æ¨èå¥½ç”¨çš„å¼€å‘å·¥å…·å’Œæœ€ä½³å®è·µ  \nğŸ—ï¸ **æ¶æ„æ€ç»´** - ä»å•ä½“åˆ°å¾®æœåŠ¡ï¼Œä»ä¼ ç»Ÿåˆ°äº‘åŸç”Ÿçš„æ¶æ„æ¼”è¿›  \nğŸ¤– **AIæ¢ç´¢** - äººå·¥æ™ºèƒ½åœ¨å®é™…ä¸šåŠ¡ä¸­çš„åº”ç”¨å’Œå®è·µ  \n\n## è”ç³»æ–¹å¼\n\nå¦‚æœä½ å¯¹æ–‡ç« å†…å®¹æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š\n\n- GitHub: [JathonKatu](https://github.com/JathonKatu)\n- Email: jathonkatu@foxmail.com\n\nè®©æˆ‘ä»¬ä¸€èµ·åœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸æ–­å‰è¿›ï¼ğŸ¯","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2025-09-19 11:30:00\ntags: [Hexo] \ncategories: [æ—¥è®°]\n---\n\næ¬¢è¿æ¥åˆ°æˆ‘çš„å…¨æ–°Hexoåšå®¢ï¼\n\nè¿™æ˜¯ä¸€ä¸ªå…¨æ–°å¼€å§‹çš„æŠ€æœ¯åšå®¢ï¼Œæˆ‘å°†åœ¨è¿™é‡Œåˆ†äº«ï¼š\n\n## ä¸»è¦å†…å®¹\n\n- **Javaå¼€å‘** - æºç åˆ†æã€Springç”Ÿæ€ã€å¾®æœåŠ¡æ¶æ„ã€JVMè°ƒä¼˜\n- **Pythonç¼–ç¨‹** - åŸºç¡€è¯­æ³•ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æ¡†æ¶\n- **ç½‘ç»œå®‰å…¨** - å…¥ä¾µæ£€æµ‹ã€å®‰å…¨é˜²æŠ¤ã€æ¸—é€æµ‹è¯•ã€å®‰å…¨æ¶æ„è®¾è®¡\n- **åˆ†å¸ƒå¼ç³»ç»Ÿ** - å¾®æœåŠ¡æ¶æ„ã€æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é«˜å¯ç”¨è®¾è®¡\n- **ç³»ç»Ÿæ¶æ„** - æ¶æ„è®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–ã€å®¹å™¨åŒ–éƒ¨ç½²ã€äº‘åŸç”Ÿ\n- **äººå·¥æ™ºèƒ½** - æœºå™¨å­¦ä¹ ç®—æ³•ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰\n- **æ•°æ®åº“æŠ€æœ¯** - SQLä¼˜åŒ–ã€NoSQLã€åˆ†å¸ƒå¼æ•°æ®åº“ã€æ•°æ®ä»“åº“\n- **å¼€å‘å·¥å…·** - Gitä½¿ç”¨ã€IDEé…ç½®ã€CI/CDã€DevOpså®è·µ\n\n## åšå®¢ç‰¹è‰²\n\nâœ¨ **æŠ€æœ¯æ·±åº¦** - ä¸ä»…ä»…æ˜¯ä½¿ç”¨ï¼Œæ›´æ³¨é‡åŸç†ç†è§£å’Œæºç åˆ†æ  \nğŸš€ **å®æˆ˜å¯¼å‘** - ç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œåˆ†äº«æ¶æ„è®¾è®¡å’Œè§£å†³æ–¹æ¡ˆ  \nğŸ“š **æŒç»­å­¦ä¹ ** - è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œåˆ†äº«å‰æ²¿æŠ€æœ¯è¶‹åŠ¿  \nğŸ”§ **å·¥å…·åˆ†äº«** - æ¨èå¥½ç”¨çš„å¼€å‘å·¥å…·å’Œæœ€ä½³å®è·µ  \nğŸ—ï¸ **æ¶æ„æ€ç»´** - ä»å•ä½“åˆ°å¾®æœåŠ¡ï¼Œä»ä¼ ç»Ÿåˆ°äº‘åŸç”Ÿçš„æ¶æ„æ¼”è¿›  \nğŸ¤– **AIæ¢ç´¢** - äººå·¥æ™ºèƒ½åœ¨å®é™…ä¸šåŠ¡ä¸­çš„åº”ç”¨å’Œå®è·µ  \n\n## è”ç³»æ–¹å¼\n\nå¦‚æœä½ å¯¹æ–‡ç« å†…å®¹æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š\n\n- GitHub: [JathonKatu](https://github.com/JathonKatu)\n- Email: jathonkatu@foxmail.com\n\nè®©æˆ‘ä»¬ä¸€èµ·åœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸æ–­å‰è¿›ï¼ğŸ¯","slug":"hello-world","published":1,"updated":"2025-09-20T06:18:05.581Z","_id":"cmfqa7j9n0000k4u7eg5zauep","comments":1,"layout":"post","photos":[],"content":"<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å…¨æ–°Hexoåšå®¢ï¼</p>\n<p>è¿™æ˜¯ä¸€ä¸ªå…¨æ–°å¼€å§‹çš„æŠ€æœ¯åšå®¢ï¼Œæˆ‘å°†åœ¨è¿™é‡Œåˆ†äº«ï¼š</p>\n<h2 id=\"ä¸»è¦å†…å®¹\"><a href=\"#ä¸»è¦å†…å®¹\" class=\"headerlink\" title=\"ä¸»è¦å†…å®¹\"></a>ä¸»è¦å†…å®¹</h2><ul>\n<li><strong>Javaå¼€å‘</strong> - æºç åˆ†æã€Springç”Ÿæ€ã€å¾®æœåŠ¡æ¶æ„ã€JVMè°ƒä¼˜</li>\n<li><strong>Pythonç¼–ç¨‹</strong> - åŸºç¡€è¯­æ³•ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æ¡†æ¶</li>\n<li><strong>ç½‘ç»œå®‰å…¨</strong> - å…¥ä¾µæ£€æµ‹ã€å®‰å…¨é˜²æŠ¤ã€æ¸—é€æµ‹è¯•ã€å®‰å…¨æ¶æ„è®¾è®¡</li>\n<li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong> - å¾®æœåŠ¡æ¶æ„ã€æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é«˜å¯ç”¨è®¾è®¡</li>\n<li><strong>ç³»ç»Ÿæ¶æ„</strong> - æ¶æ„è®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–ã€å®¹å™¨åŒ–éƒ¨ç½²ã€äº‘åŸç”Ÿ</li>\n<li><strong>äººå·¥æ™ºèƒ½</strong> - æœºå™¨å­¦ä¹ ç®—æ³•ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰</li>\n<li><strong>æ•°æ®åº“æŠ€æœ¯</strong> - SQLä¼˜åŒ–ã€NoSQLã€åˆ†å¸ƒå¼æ•°æ®åº“ã€æ•°æ®ä»“åº“</li>\n<li><strong>å¼€å‘å·¥å…·</strong> - Gitä½¿ç”¨ã€IDEé…ç½®ã€CI&#x2F;CDã€DevOpså®è·µ</li>\n</ul>\n<h2 id=\"åšå®¢ç‰¹è‰²\"><a href=\"#åšå®¢ç‰¹è‰²\" class=\"headerlink\" title=\"åšå®¢ç‰¹è‰²\"></a>åšå®¢ç‰¹è‰²</h2><p>âœ¨ <strong>æŠ€æœ¯æ·±åº¦</strong> - ä¸ä»…ä»…æ˜¯ä½¿ç”¨ï¼Œæ›´æ³¨é‡åŸç†ç†è§£å’Œæºç åˆ†æ<br>ğŸš€ <strong>å®æˆ˜å¯¼å‘</strong> - ç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œåˆ†äº«æ¶æ„è®¾è®¡å’Œè§£å†³æ–¹æ¡ˆ<br>ğŸ“š <strong>æŒç»­å­¦ä¹ </strong> - è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œåˆ†äº«å‰æ²¿æŠ€æœ¯è¶‹åŠ¿<br>ğŸ”§ <strong>å·¥å…·åˆ†äº«</strong> - æ¨èå¥½ç”¨çš„å¼€å‘å·¥å…·å’Œæœ€ä½³å®è·µ<br>ğŸ—ï¸ <strong>æ¶æ„æ€ç»´</strong> - ä»å•ä½“åˆ°å¾®æœåŠ¡ï¼Œä»ä¼ ç»Ÿåˆ°äº‘åŸç”Ÿçš„æ¶æ„æ¼”è¿›<br>ğŸ¤– <strong>AIæ¢ç´¢</strong> - äººå·¥æ™ºèƒ½åœ¨å®é™…ä¸šåŠ¡ä¸­çš„åº”ç”¨å’Œå®è·µ  </p>\n<h2 id=\"è”ç³»æ–¹å¼\"><a href=\"#è”ç³»æ–¹å¼\" class=\"headerlink\" title=\"è”ç³»æ–¹å¼\"></a>è”ç³»æ–¹å¼</h2><p>å¦‚æœä½ å¯¹æ–‡ç« å†…å®¹æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/JathonKatu\">JathonKatu</a></li>\n<li>Email: <a href=\"mailto:&#x6a;&#97;&#x74;&#x68;&#111;&#110;&#107;&#97;&#x74;&#x75;&#64;&#102;&#111;&#x78;&#109;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;\">jathonkatu@foxmail.com</a></li>\n</ul>\n<p>è®©æˆ‘ä»¬ä¸€èµ·åœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸æ–­å‰è¿›ï¼ğŸ¯</p>\n","excerpt":"","more":"<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å…¨æ–°Hexoåšå®¢ï¼</p>\n<p>è¿™æ˜¯ä¸€ä¸ªå…¨æ–°å¼€å§‹çš„æŠ€æœ¯åšå®¢ï¼Œæˆ‘å°†åœ¨è¿™é‡Œåˆ†äº«ï¼š</p>\n<h2 id=\"ä¸»è¦å†…å®¹\"><a href=\"#ä¸»è¦å†…å®¹\" class=\"headerlink\" title=\"ä¸»è¦å†…å®¹\"></a>ä¸»è¦å†…å®¹</h2><ul>\n<li><strong>Javaå¼€å‘</strong> - æºç åˆ†æã€Springç”Ÿæ€ã€å¾®æœåŠ¡æ¶æ„ã€JVMè°ƒä¼˜</li>\n<li><strong>Pythonç¼–ç¨‹</strong> - åŸºç¡€è¯­æ³•ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æ¡†æ¶</li>\n<li><strong>ç½‘ç»œå®‰å…¨</strong> - å…¥ä¾µæ£€æµ‹ã€å®‰å…¨é˜²æŠ¤ã€æ¸—é€æµ‹è¯•ã€å®‰å…¨æ¶æ„è®¾è®¡</li>\n<li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong> - å¾®æœåŠ¡æ¶æ„ã€æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é«˜å¯ç”¨è®¾è®¡</li>\n<li><strong>ç³»ç»Ÿæ¶æ„</strong> - æ¶æ„è®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–ã€å®¹å™¨åŒ–éƒ¨ç½²ã€äº‘åŸç”Ÿ</li>\n<li><strong>äººå·¥æ™ºèƒ½</strong> - æœºå™¨å­¦ä¹ ç®—æ³•ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰</li>\n<li><strong>æ•°æ®åº“æŠ€æœ¯</strong> - SQLä¼˜åŒ–ã€NoSQLã€åˆ†å¸ƒå¼æ•°æ®åº“ã€æ•°æ®ä»“åº“</li>\n<li><strong>å¼€å‘å·¥å…·</strong> - Gitä½¿ç”¨ã€IDEé…ç½®ã€CI&#x2F;CDã€DevOpså®è·µ</li>\n</ul>\n<h2 id=\"åšå®¢ç‰¹è‰²\"><a href=\"#åšå®¢ç‰¹è‰²\" class=\"headerlink\" title=\"åšå®¢ç‰¹è‰²\"></a>åšå®¢ç‰¹è‰²</h2><p>âœ¨ <strong>æŠ€æœ¯æ·±åº¦</strong> - ä¸ä»…ä»…æ˜¯ä½¿ç”¨ï¼Œæ›´æ³¨é‡åŸç†ç†è§£å’Œæºç åˆ†æ<br>ğŸš€ <strong>å®æˆ˜å¯¼å‘</strong> - ç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œåˆ†äº«æ¶æ„è®¾è®¡å’Œè§£å†³æ–¹æ¡ˆ<br>ğŸ“š <strong>æŒç»­å­¦ä¹ </strong> - è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œåˆ†äº«å‰æ²¿æŠ€æœ¯è¶‹åŠ¿<br>ğŸ”§ <strong>å·¥å…·åˆ†äº«</strong> - æ¨èå¥½ç”¨çš„å¼€å‘å·¥å…·å’Œæœ€ä½³å®è·µ<br>ğŸ—ï¸ <strong>æ¶æ„æ€ç»´</strong> - ä»å•ä½“åˆ°å¾®æœåŠ¡ï¼Œä»ä¼ ç»Ÿåˆ°äº‘åŸç”Ÿçš„æ¶æ„æ¼”è¿›<br>ğŸ¤– <strong>AIæ¢ç´¢</strong> - äººå·¥æ™ºèƒ½åœ¨å®é™…ä¸šåŠ¡ä¸­çš„åº”ç”¨å’Œå®è·µ  </p>\n<h2 id=\"è”ç³»æ–¹å¼\"><a href=\"#è”ç³»æ–¹å¼\" class=\"headerlink\" title=\"è”ç³»æ–¹å¼\"></a>è”ç³»æ–¹å¼</h2><p>å¦‚æœä½ å¯¹æ–‡ç« å†…å®¹æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/JathonKatu\">JathonKatu</a></li>\n<li>Email: <a href=\"mailto:&#x6a;&#97;&#x74;&#x68;&#111;&#110;&#107;&#97;&#x74;&#x75;&#64;&#102;&#111;&#x78;&#109;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#x6d;\">jathonkatu@foxmail.com</a></li>\n</ul>\n<p>è®©æˆ‘ä»¬ä¸€èµ·åœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸æ–­å‰è¿›ï¼ğŸ¯</p>\n"},{"title":"RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯»","date":"2025-09-19T03:44:41.000Z","_content":"status: draft\ncreateDate: 2025-09-19 11:44:41\nendDate:\n\n## ç›®å½•\n- [RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-4.x-now)<a id=\"rocketmq-4.x-now-title\"></a>â˜‘ï¸\n- [RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-4.x-principle)<a id=\"rocketmq-4.x-principle-title\"></a>â˜‘ï¸\n- [RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-4.x-code)<a id=\"rocketmq-4.x-code-title\"></a>â˜‘ï¸\n- [RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-5.x-now)<a id=\"rocketmq-5.x-now-title\"></a>â˜‘ï¸\n- [RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-5.x-principle)<a id=\"rocketmq-5.x-principle-title\"></a>â¬œ\n- [RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-5.x-code)<a id=\"rocketmq-5.x-code-title\"></a>â¬œ\n- [å†™åœ¨æœ€å](#end)<a id=\"end-title\"></a>\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-4.x-now-title)<a id=\"rocketmq-4.x-now\"></a> [å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/zh/docs/4.x/producer/04message3/)\n- å­—æ®µmessage.delayTimeLevel\n- æšä¸¾ä¸ºæ•°å­—1-18ï¼Œåªæ”¯æŒ18ä¸ªå›ºå®šå»¶æ—¶ç­‰çº§ï¼ˆ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hï¼‰\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-4.x-principle-title)<a id=\"rocketmq-4.x-principle\"></a>\nåº•å±‚å®ç°ä¸»è¦æ˜¯åŸºäºBrokeç«¯ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š\n\n**1. CommitLog å†™å…¥å¤„**\nå½“æ¶ˆæ¯å¸¦æœ‰delayTimeLevel > 0æ—¶ï¼Œåœ¨CommitLog#asyncPutMessageæ–¹æ³•ä¸­ä¼šè¿›è¡Œç‰¹æ®Šå¤„ç†(è€ç‰ˆæœ¬æ˜¯CommitLog#putMessage)\n- å°†åŸå§‹çš„topicå’ŒqueueIdä¿å­˜åˆ°æ¶ˆæ¯å±æ€§ä¸­(REAL_TOPICã€REAL_QUEUE_ID)\n- ä¿®æ”¹æ¶ˆæ¯çš„topicä¸ºç³»ç»Ÿé¢„è®¾çš„å»¶è¿Ÿtopic(SCHEDULE_TOPIC_XXXX)\n- æ ¹æ®å»¶è¿Ÿçº§åˆ«è®¡ç®—å‡ºå¯¹åº”çš„queueId [ScheduleMessageService#delayLevel2QueueId](https://github.com/apache/rocketmq/blob/4.9.x/store/src/main/java/org/apache/rocketmq/store/schedule/ScheduleMessageService.java#L91)å¹¶æŠ•æ”¾åˆ°å¯¹åº”çš„queueä¸­\n\n**2. å®šæ—¶è°ƒåº¦æœåŠ¡ScheduleMessageService**\nè¯¥æœåŠ¡è´Ÿè´£æ‰«æå»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨åˆ°æœŸåå°†å…¶é‡æ–°æŠ•é€’åˆ°åŸå§‹çš„topic\n- å¯åŠ¨æ—¶ä¸ºæ¯ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«çš„queueåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡\n- å®šæœŸæ£€æŸ¥æ¯ä¸ªå»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯å¦åˆ°æœŸ(ä¸Šä¸€æ­¥ä¼šè®¡ç®—å½“å‰æ—¶é—´ï¼Œå¹¶æ ¹æ®å»¶è¿Ÿç­‰çº§è®¡ç®—å‡ºåˆ°æœŸæ—¶é—´ï¼Œæ³¨æ„è¶…å‡º18ä¼šé»˜è®¤18)\n- åˆ°æœŸåï¼Œæ¢å¤åŸå§‹topicå’ŒqueueIdï¼Œé‡æ–°æ„å»ºæ¶ˆæ¯å¹¶å†™å…¥CommitLogï¼Œè¿›å…¥æ­£å¸¸æ¶ˆè´¹æµç¨‹ã€‚\n\n**3.å…³é”®æºç **\n- [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest](#rocketmSendMessageProcessor#asyncProcessRequest)<a id=\"rocketmSendMessageProcessor#asyncProcessRequest-title\"></a>\n- [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage](#SendMessageProcessor#asyncSendMessage)<a id=\"SendMessageProcessor#asyncSendMessage-title\"></a>\n- [org.apache.rocketmq.store.CommitLog#asyncPutMessage](#CommitLog#asyncPutMessage)<a id=\"CommitLog#asyncPutMessage-title\"></a>\n- [org.apache.rocketmq.store.schedule.ScheduleMessageService#start](#ScheduleMessageService#start)<a id=\"ScheduleMessageService#start-title\"></a>\n- [org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask](#ScheduleMessageService.DeliverDelayedMessageTimerTask)<a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask-title\"></a>\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-4.x-code-title)<a id=\"rocketmq-4.x-code\"></a>\n### [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest](#rocketmSendMessageProcessor#asyncProcessRequest-title) <a id=\"rocketmSendMessageProcessor#asyncProcessRequest\"></a>\né¦–å…ˆæ˜¯æ”¶åˆ°çš„æ¶ˆæ¯å…ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬å‘å¤„ç†ï¼Œä¸»è¦æ˜¯ç¬¬17è¡Œä»£ç æä¾›å…¥å£ã€‚\n``` Java\npublic CompletableFuture<RemotingCommand> asyncProcessRequest(ChannelHandlerContext ctx,\n                                                                  RemotingCommand request) throws RemotingCommandException {\n        final SendMessageContext mqtraceContext;\n        switch (request.getCode()) {\n            case RequestCode.CONSUMER_SEND_MSG_BACK:\n                return this.asyncConsumerSendMsgBack(ctx, request);\n            default:\n                SendMessageRequestHeader requestHeader = parseRequestHeader(request);\n                if (requestHeader == null) {\n                    return CompletableFuture.completedFuture(null);\n                }\n                mqtraceContext = buildMsgContext(ctx, requestHeader);\n                this.executeSendMessageHookBefore(ctx, request, mqtraceContext);\n                if (requestHeader.isBatch()) {\n                    return this.asyncSendBatchMessage(ctx, request, mqtraceContext, requestHeader);\n                } else {\n                    return this.asyncSendMessage(ctx, request, mqtraceContext, requestHeader);\n                }\n        }\n    }\n```\n### [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage](#SendMessageProcessor#asyncSendMessage-title) <a id=\"SendMessageProcessor#asyncSendMessage\"></a>\nè¿™é‡Œä¸»è¦çš„æ˜¯å…³æ³¨ç¬¬61è¡Œä»£ç ï¼Œè¿›å…¥åˆ°Stroreï¼Œè¿è¡ŒasyncPutMessageã€‚\n``` Java\nprivate CompletableFuture<RemotingCommand> asyncSendMessage(ChannelHandlerContext ctx, RemotingCommand request,\n                                                                SendMessageContext mqtraceContext,\n                                                                SendMessageRequestHeader requestHeader) {\n        final RemotingCommand response = preSend(ctx, request, requestHeader);\n        final SendMessageResponseHeader responseHeader = (SendMessageResponseHeader)response.readCustomHeader();\n\n        if (response.getCode() != -1) {\n            return CompletableFuture.completedFuture(response);\n        }\n\n        final byte[] body = request.getBody();\n\n        int queueIdInt = requestHeader.getQueueId();\n        TopicConfig topicConfig = this.brokerController.getTopicConfigManager().selectTopicConfig(requestHeader.getTopic());\n\n        if (queueIdInt < 0) {\n            queueIdInt = randomQueueId(topicConfig.getWriteQueueNums());\n        }\n\n        MessageExtBrokerInner msgInner = new MessageExtBrokerInner();\n        msgInner.setTopic(requestHeader.getTopic());\n        msgInner.setQueueId(queueIdInt);\n\n        if (!handleRetryAndDLQ(requestHeader, response, request, msgInner, topicConfig)) {\n            return CompletableFuture.completedFuture(response);\n        }\n\n        msgInner.setBody(body);\n        msgInner.setFlag(requestHeader.getFlag());\n        Map<String, String> origProps = MessageDecoder.string2messageProperties(requestHeader.getProperties());\n        MessageAccessor.setProperties(msgInner, origProps);\n        msgInner.setBornTimestamp(requestHeader.getBornTimestamp());\n        msgInner.setBornHost(ctx.channel().remoteAddress());\n        msgInner.setStoreHost(this.getStoreHost());\n        msgInner.setReconsumeTimes(requestHeader.getReconsumeTimes() == null ? 0 : requestHeader.getReconsumeTimes());\n        String clusterName = this.brokerController.getBrokerConfig().getBrokerClusterName();\n        MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_CLUSTER, clusterName);\n        if (origProps.containsKey(MessageConst.PROPERTY_WAIT_STORE_MSG_OK)) {\n            // There is no need to store \"WAIT=true\", remove it from propertiesString to save 9 bytes for each message.\n            // It works for most case. In some cases msgInner.setPropertiesString invoked later and replace it.\n            String waitStoreMsgOKValue = origProps.remove(MessageConst.PROPERTY_WAIT_STORE_MSG_OK);\n            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));\n            // Reput to properties, since msgInner.isWaitStoreMsgOK() will be invoked later\n            origProps.put(MessageConst.PROPERTY_WAIT_STORE_MSG_OK, waitStoreMsgOKValue);\n        } else {\n            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));\n        }\n\n        CompletableFuture<PutMessageResult> putMessageResult = null;\n        String transFlag = origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);\n        if (Boolean.parseBoolean(transFlag)) {\n            if (this.brokerController.getBrokerConfig().isRejectTransactionMessage()) {\n                response.setCode(ResponseCode.NO_PERMISSION);\n                response.setRemark(\n                        \"the broker[\" + this.brokerController.getBrokerConfig().getBrokerIP1()\n                                + \"] sending transaction message is forbidden\");\n                return CompletableFuture.completedFuture(response);\n            }\n            putMessageResult = this.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);\n        } else {\n            putMessageResult = this.brokerController.getMessageStore().asyncPutMessage(msgInner);\n        }\n        return handlePutMessageResultFuture(putMessageResult, response, request, msgInner, responseHeader, mqtraceContext, ctx, queueIdInt);\n    }\n```\n### [org.apache.rocketmq.store.CommitLog#asyncPutMessage](#CommitLog#asyncPutMessage-title) <a id=\"CommitLog#asyncPutMessage\"></a>\nputMessageçš„è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œä¸»è¦çœ‹ç¬¬åå…«è¡Œå¼€å§‹ï¼Œå¦‚æœæ˜¯å»¶è¿Ÿmqï¼Œåˆ™ä¼šå°†æ¶ˆæ¯æ”¾å…¥åˆ°topic=SCHEDULE_TOPIC_XXXX,queueId=delayLevel-1ä¸­\n``` java\npublic CompletableFuture<PutMessageResult> asyncPutMessage(final MessageExtBrokerInner msg) {\n        // Set the storage time\n        msg.setStoreTimestamp(System.currentTimeMillis());\n        // Set the message body BODY CRC (consider the most appropriate setting\n        // on the client)\n        msg.setBodyCRC(UtilAll.crc32(msg.getBody()));\n        // Back to Results\n        AppendMessageResult result = null;\n\n        StoreStatsService storeStatsService = this.defaultMessageStore.getStoreStatsService();\n\n        String topic = msg.getTopic();\n//        int queueId msg.getQueueId();\n        final int tranType = MessageSysFlag.getTransactionValue(msg.getSysFlag());\n        if (tranType == MessageSysFlag.TRANSACTION_NOT_TYPE\n                || tranType == MessageSysFlag.TRANSACTION_COMMIT_TYPE) {\n            // Delay Delivery\n            if (msg.getDelayTimeLevel() > 0) {\n                if (msg.getDelayTimeLevel() > this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) {\n                    msg.setDelayTimeLevel(this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel());\n                }\n\n                topic = TopicValidator.RMQ_SYS_SCHEDULE_TOPIC;\n                int queueId = ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel());\n\n                // Backup real topic, queueId\n                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic());\n                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId()));\n                msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties()));\n\n                msg.setTopic(topic);\n                msg.setQueueId(queueId);\n            }\n        }\n\n        InetSocketAddress bornSocketAddress = (InetSocketAddress) msg.getBornHost();\n        if (bornSocketAddress.getAddress() instanceof Inet6Address) {\n            msg.setBornHostV6Flag();\n        }\n\n        InetSocketAddress storeSocketAddress = (InetSocketAddress) msg.getStoreHost();\n        if (storeSocketAddress.getAddress() instanceof Inet6Address) {\n            msg.setStoreHostAddressV6Flag();\n        }\n\n        PutMessageThreadLocal putMessageThreadLocal = this.putMessageThreadLocal.get();\n        updateMaxMessageSize(putMessageThreadLocal);\n        if (!multiDispatch.isMultiDispatchMsg(msg)) {\n            PutMessageResult encodeResult = putMessageThreadLocal.getEncoder().encode(msg);\n            if (encodeResult != null) {\n                return CompletableFuture.completedFuture(encodeResult);\n            }\n            msg.setEncodedBuff(putMessageThreadLocal.getEncoder().getEncoderBuffer());\n        }\n        PutMessageContext putMessageContext = new PutMessageContext(generateKey(putMessageThreadLocal.getKeyBuilder(), msg));\n\n        long elapsedTimeInLock = 0;\n        MappedFile unlockMappedFile = null;\n\n        putMessageLock.lock(); //spin or ReentrantLock ,depending on store config\n        try {\n            MappedFile mappedFile = this.mappedFileQueue.getLastMappedFile();\n            long beginLockTimestamp = this.defaultMessageStore.getSystemClock().now();\n            this.beginTimeInLock = beginLockTimestamp;\n\n            // Here settings are stored timestamp, in order to ensure an orderly\n            // global\n            msg.setStoreTimestamp(beginLockTimestamp);\n\n            if (null == mappedFile || mappedFile.isFull()) {\n                mappedFile = this.mappedFileQueue.getLastMappedFile(0); // Mark: NewFile may be cause noise\n            }\n            if (null == mappedFile) {\n                log.error(\"create mapped file1 error, topic: \" + msg.getTopic() + \" clientAddr: \" + msg.getBornHostString());\n                return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.CREATE_MAPEDFILE_FAILED, null));\n            }\n\n            result = mappedFile.appendMessage(msg, this.appendMessageCallback, putMessageContext);\n            switch (result.getStatus()) {\n                case PUT_OK:\n                    break;\n                case END_OF_FILE:\n                    unlockMappedFile = mappedFile;\n                    // Create a new file, re-write the message\n                    mappedFile = this.mappedFileQueue.getLastMappedFile(0);\n                    if (null == mappedFile) {\n                        // XXX: warn and notify me\n                        log.error(\"create mapped file2 error, topic: \" + msg.getTopic() + \" clientAddr: \" + msg.getBornHostString());\n                        return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.CREATE_MAPEDFILE_FAILED, result));\n                    }\n                    result = mappedFile.appendMessage(msg, this.appendMessageCallback, putMessageContext);\n                    break;\n                case MESSAGE_SIZE_EXCEEDED:\n                case PROPERTIES_SIZE_EXCEEDED:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.MESSAGE_ILLEGAL, result));\n                case UNKNOWN_ERROR:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.UNKNOWN_ERROR, result));\n                default:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.UNKNOWN_ERROR, result));\n            }\n\n            elapsedTimeInLock = this.defaultMessageStore.getSystemClock().now() - beginLockTimestamp;\n        } finally {\n            beginTimeInLock = 0;\n            putMessageLock.unlock();\n        }\n\n        if (elapsedTimeInLock > 500) {\n            log.warn(\"[NOTIFYME]putMessage in lock cost time(ms)={}, bodyLength={} AppendMessageResult={}\", elapsedTimeInLock, msg.getBody().length, result);\n        }\n\n        if (null != unlockMappedFile && this.defaultMessageStore.getMessageStoreConfig().isWarmMapedFileEnable()) {\n            this.defaultMessageStore.unlockMappedFile(unlockMappedFile);\n        }\n\n        PutMessageResult putMessageResult = new PutMessageResult(PutMessageStatus.PUT_OK, result);\n\n        // Statistics\n        storeStatsService.getSinglePutMessageTopicTimesTotal(msg.getTopic()).add(1);\n        storeStatsService.getSinglePutMessageTopicSizeTotal(topic).add(result.getWroteBytes());\n\n        CompletableFuture<PutMessageStatus> flushResultFuture = submitFlushRequest(result, msg);\n        CompletableFuture<PutMessageStatus> replicaResultFuture = submitReplicaRequest(result, msg);\n        return flushResultFuture.thenCombine(replicaResultFuture, (flushStatus, replicaStatus) -> {\n            if (flushStatus != PutMessageStatus.PUT_OK) {\n                putMessageResult.setPutMessageStatus(flushStatus);\n            }\n            if (replicaStatus != PutMessageStatus.PUT_OK) {\n                putMessageResult.setPutMessageStatus(replicaStatus);\n            }\n            return putMessageResult;\n        });\n    }\n```\n### [org.apache.rocketmq.store.schedule.ScheduleMessageService#start](#ScheduleMessageService#start-title) <a id=\"ScheduleMessageService#start\"></a>\nè¿™é‡Œä¸»è¦æ˜¯è§£é‡Šscheduleå¯¹æ¯ä¸€ä¸ªdelayLeveléƒ½å¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹ï¼Œæ‰§è¡Œé¢‘ç‡æ ¹æ®ä¸åŒdelayLevelå¯¹åº”çš„deladeliveryTimeå†³å®šã€‚\n``` java\npublic void start() {\n        if (started.compareAndSet(false, true)) {\n            this.load();\n            this.deliverExecutorService = new ScheduledThreadPoolExecutor(this.maxDelayLevel, new ThreadFactoryImpl(\"ScheduleMessageTimerThread_\"));\n            if (this.enableAsyncDeliver) {\n                this.handleExecutorService = new ScheduledThreadPoolExecutor(this.maxDelayLevel, new ThreadFactoryImpl(\"ScheduleMessageExecutorHandleThread_\"));\n            }\n            for (Map.Entry<Integer, Long> entry : this.delayLevelTable.entrySet()) {\n                Integer level = entry.getKey();\n                Long timeDelay = entry.getValue();\n                Long offset = this.offsetTable.get(level);\n                if (null == offset) {\n                    offset = 0L;\n                }\n\n                if (timeDelay != null) {\n                    if (this.enableAsyncDeliver) {\n                        this.handleExecutorService.schedule(new HandlePutResultTask(level), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);\n                    }\n                    this.deliverExecutorService.schedule(new DeliverDelayedMessageTimerTask(level, offset), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);\n                }\n            }\n\n            this.deliverExecutorService.scheduleAtFixedRate(new Runnable() {\n\n                @Override\n                public void run() {\n                    try {\n                        if (started.get()) {\n                            ScheduleMessageService.this.persist();\n                        }\n                    } catch (Throwable e) {\n                        log.error(\"scheduleAtFixedRate flush exception\", e);\n                    }\n                }\n            }, 10000, this.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(), TimeUnit.MILLISECONDS);\n        }\n    }\n```\n### [org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask](#ScheduleMessageService.DeliverDelayedMessageTimerTask-title) <a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask\"></a>\ntaskä¸»è¦çš„ä»»åŠ¡å°±æ˜¯101è¡Œï¼Œè°ƒç”¨org.apache.rocketmq.store.schedule.ScheduleMessageService#messageTimeupï¼Œå°†å¯¹è±¡è½¬æ¢æˆMessageExtBrokerInnerå¯¹è±¡ï¼ˆå¹¶åœ¨æ­¤æ—¶å°†topicå’ŒqueueIdé‡ç½®æˆåŸæ¥çš„ï¼‰ï¼Œç„¶åè°ƒç”¨org.apache.rocketmq.store.DefaultMessageStore#putMessageï¼Œå°†æ¶ˆæ¯æ”¾å…¥åˆ°commitLogä¸­ã€‚\n``` java\nclass DeliverDelayedMessageTimerTask implements Runnable {\n        private final int delayLevel;\n        private final long offset;\n\n        public DeliverDelayedMessageTimerTask(int delayLevel, long offset) {\n            this.delayLevel = delayLevel;\n            this.offset = offset;\n        }\n\n        @Override\n        public void run() {\n            try {\n                if (isStarted()) {\n                    this.executeOnTimeup();\n                }\n            } catch (Exception e) {\n                // XXX: warn and notify me\n                log.error(\"ScheduleMessageService, executeOnTimeup exception\", e);\n                this.scheduleNextTimerTask(this.offset, DELAY_FOR_A_PERIOD);\n            }\n        }\n\n        /**\n         * @return\n         */\n        private long correctDeliverTimestamp(final long now, final long deliverTimestamp) {\n\n            long result = deliverTimestamp;\n\n            long maxTimestamp = now + ScheduleMessageService.this.delayLevelTable.get(this.delayLevel);\n            if (deliverTimestamp > maxTimestamp) {\n                result = now;\n            }\n\n            return result;\n        }\n\n        public void executeOnTimeup() {\n            ConsumeQueue cq =\n                ScheduleMessageService.this.defaultMessageStore.findConsumeQueue(TopicValidator.RMQ_SYS_SCHEDULE_TOPIC,\n                    delayLevel2QueueId(delayLevel));\n\n            if (cq == null) {\n                this.scheduleNextTimerTask(this.offset, DELAY_FOR_A_WHILE);\n                return;\n            }\n\n            SelectMappedBufferResult bufferCQ = cq.getIndexBuffer(this.offset);\n            if (bufferCQ == null) {\n                long resetOffset;\n                if ((resetOffset = cq.getMinOffsetInQueue()) > this.offset) {\n                    log.error(\"schedule CQ offset invalid. offset={}, cqMinOffset={}, queueId={}\",\n                        this.offset, resetOffset, cq.getQueueId());\n                } else if ((resetOffset = cq.getMaxOffsetInQueue()) < this.offset) {\n                    log.error(\"schedule CQ offset invalid. offset={}, cqMaxOffset={}, queueId={}\",\n                        this.offset, resetOffset, cq.getQueueId());\n                } else {\n                    resetOffset = this.offset;\n                }\n\n                this.scheduleNextTimerTask(resetOffset, DELAY_FOR_A_WHILE);\n                return;\n            }\n\n            long nextOffset = this.offset;\n            try {\n                int i = 0;\n                ConsumeQueueExt.CqExtUnit cqExtUnit = new ConsumeQueueExt.CqExtUnit();\n                for (; i < bufferCQ.getSize() && isStarted(); i += ConsumeQueue.CQ_STORE_UNIT_SIZE) {\n                    long offsetPy = bufferCQ.getByteBuffer().getLong();\n                    int sizePy = bufferCQ.getByteBuffer().getInt();\n                    long tagsCode = bufferCQ.getByteBuffer().getLong();\n\n                    if (cq.isExtAddr(tagsCode)) {\n                        if (cq.getExt(tagsCode, cqExtUnit)) {\n                            tagsCode = cqExtUnit.getTagsCode();\n                        } else {\n                            //can't find ext content.So re compute tags code.\n                            log.error(\"[BUG] can't find consume queue extend file content!addr={}, offsetPy={}, sizePy={}\",\n                                tagsCode, offsetPy, sizePy);\n                            long msgStoreTime = defaultMessageStore.getCommitLog().pickupStoreTimestamp(offsetPy, sizePy);\n                            tagsCode = computeDeliverTimestamp(delayLevel, msgStoreTime);\n                        }\n                    }\n\n                    long now = System.currentTimeMillis();\n                    long deliverTimestamp = this.correctDeliverTimestamp(now, tagsCode);\n                    nextOffset = offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);\n\n                    long countdown = deliverTimestamp - now;\n                    if (countdown > 0) {\n                        this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n                        return;\n                    }\n\n                    MessageExt msgExt = ScheduleMessageService.this.defaultMessageStore.lookMessageByOffset(offsetPy, sizePy);\n                    if (msgExt == null) {\n                        continue;\n                    }\n\n                    MessageExtBrokerInner msgInner = ScheduleMessageService.this.messageTimeup(msgExt);\n                    if (TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC.equals(msgInner.getTopic())) {\n                        log.error(\"[BUG] the real topic of schedule msg is {}, discard the msg. msg={}\",\n                            msgInner.getTopic(), msgInner);\n                        continue;\n                    }\n\n                    boolean deliverSuc;\n                    if (ScheduleMessageService.this.enableAsyncDeliver) {\n                        deliverSuc = this.asyncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);\n                    } else {\n                        deliverSuc = this.syncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);\n                    }\n\n                    if (!deliverSuc) {\n                        this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n                        return;\n                    }\n                }\n\n                nextOffset = this.offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);\n            } catch (Exception e) {\n                log.error(\"ScheduleMessageService, messageTimeup execute error, offset = {}\", nextOffset, e);\n            } finally {\n                bufferCQ.release();\n            }\n\n            this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n        }\n\n        public void scheduleNextTimerTask(long offset, long delay) {\n            ScheduleMessageService.this.deliverExecutorService.schedule(new DeliverDelayedMessageTimerTask(\n                this.delayLevel, offset), delay, TimeUnit.MILLISECONDS);\n        }\n\n        private boolean syncDeliver(MessageExtBrokerInner msgInner, String msgId, long offset, long offsetPy,\n            int sizePy) {\n            PutResultProcess resultProcess = deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, false);\n            PutMessageResult result = resultProcess.get();\n            boolean sendStatus = result != null && result.getPutMessageStatus() == PutMessageStatus.PUT_OK;\n            if (sendStatus) {\n                ScheduleMessageService.this.updateOffset(this.delayLevel, resultProcess.getNextOffset());\n            }\n            return sendStatus;\n        }\n\n        private boolean asyncDeliver(MessageExtBrokerInner msgInner, String msgId, long offset, long offsetPy,\n            int sizePy) {\n            Queue<PutResultProcess> processesQueue = ScheduleMessageService.this.deliverPendingTable.get(this.delayLevel);\n\n            //Flow Control\n            int currentPendingNum = processesQueue.size();\n            int maxPendingLimit = ScheduleMessageService.this.defaultMessageStore.getMessageStoreConfig()\n                .getScheduleAsyncDeliverMaxPendingLimit();\n            if (currentPendingNum > maxPendingLimit) {\n                log.warn(\"Asynchronous deliver triggers flow control, \" +\n                    \"currentPendingNum={}, maxPendingLimit={}\", currentPendingNum, maxPendingLimit);\n                return false;\n            }\n\n            //Blocked\n            PutResultProcess firstProcess = processesQueue.peek();\n            if (firstProcess != null && firstProcess.need2Blocked()) {\n                log.warn(\"Asynchronous deliver block. info={}\", firstProcess.toString());\n                return false;\n            }\n\n            PutResultProcess resultProcess = deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, true);\n            processesQueue.add(resultProcess);\n            return true;\n        }\n\n        private PutResultProcess deliverMessage(MessageExtBrokerInner msgInner, String msgId, long offset,\n            long offsetPy, int sizePy, boolean autoResend) {\n            CompletableFuture<PutMessageResult> future =\n                ScheduleMessageService.this.writeMessageStore.asyncPutMessage(msgInner);\n            return new PutResultProcess()\n                .setTopic(msgInner.getTopic())\n                .setDelayLevel(this.delayLevel)\n                .setOffset(offset)\n                .setPhysicOffset(offsetPy)\n                .setPhysicSize(sizePy)\n                .setMsgId(msgId)\n                .setAutoResend(autoResend)\n                .setFuture(future)\n                .thenProcess();\n        }\n    }\n```\n## [RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-5.x-now-title)<a id=\"rocketmq-5.x-now\"></a> [å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage/)\n- å­—æ®µmessage.deliveryTimestamp\n- å¯ä»¥é¢„å®šè§¦å‘çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯å»¶æ—¶æ—¶é•¿\n- æ”¯æŒä»¥æ ¼å¼ä¸ºæ¯«ç§’çº§unixæ—¶é—´æˆ³ï¼ˆé»˜è®¤1000æ¯«ç§’çš„ç²¾åº¦ä¹Ÿå°±æ˜¯1ç§’ï¼‰\n- æ”¯æŒæœ€é•¿24å°æ—¶ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹ï¼Œè¶…è¿‡24å°æ—¶å»¶æ—¶ä¸ç”Ÿæ•ˆï¼ŒæœåŠ¡ç«¯ä¼šç«‹å³æŠ•é€’\n- å®šæ—¶ä»»åŠ¡ä»…æ”¯æŒå‘é€åˆ°MessageTypeä¸ºDelayçš„Topicä¸­\n## [RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-5.x-principle-title)<a id=\"rocketmq-5.x-principle\"></a>\n## [RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-5.x-code-title)<a id=\"rocketmq-5.x-code\"></a>\n## [å†™åœ¨æœ€å](#end-title)<a id=\"end\"></a>\n&nbsp;&nbsp;&nbsp;&nbsp;åœ¨2025å¹´09æœˆ18æ—¥ï¼Œå¿ƒè¡€æ¥æ½®åœ¨githubä¸Šæœç´¢rocketMQçš„å»¶è¿Ÿmqï¼Œå‘ç°äº†2018å¹´çš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;æœ‰è‡ªå·±ä¸ºäº†å­¦ä¹ aiå¹¶ä½œä¸ºæ¯•è®¾çš„ä»“åº“ï¼Œæœ‰åŒå­¦å¸¦æˆ‘ç©çš„hexo + githubå®ç°çš„ç®€å•ä¸ªäººåšå®¢ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;åœ¨çœ‹å®Œæ–‡æ¡£å’Œä»£ç ä¹‹åç™¾æ„Ÿäº¤é›†ï¼Œç»ˆäºæ‰“ç®—é‡æ–°å¼€å§‹å†™åšå®¢ã€‚ä¸çŸ¥é“è¿™æ¬¡è¿˜èƒ½åšæŒå¤šä¹…ï¼Œä½†æ˜¯æ—¢ç„¶è‡ªå·±èƒ½ä¸€å£æ°”å‡è‚¥æ‰äº†43æ–¤ï¼ˆæˆªè‡³ç›®å‰ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆä¸èƒ½çš„å‘¢ï¼Ÿ\n&nbsp;&nbsp;&nbsp;&nbsp;åŠ æ²¹å§è‡ªå·±ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡çš„æ—¶å€™å¥½å¥½ç§¯ç´¯ï¼Œåšç§¯è–„å‘ã€‚","source":"_posts/RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯».md","raw":"---\ntitle: RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯»\ndate: 2025-09-19 11:44:41\ntags: [Java, RocketMQ, åˆ†å¸ƒå¼, æ¶ˆæ¯é˜Ÿåˆ—, æ¶æ„, æºç ] \ncategories: [æŠ€æœ¯åˆ†äº«, å­¦ä¹ è®°å½•]\n---\nstatus: draft\ncreateDate: 2025-09-19 11:44:41\nendDate:\n\n## ç›®å½•\n- [RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-4.x-now)<a id=\"rocketmq-4.x-now-title\"></a>â˜‘ï¸\n- [RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-4.x-principle)<a id=\"rocketmq-4.x-principle-title\"></a>â˜‘ï¸\n- [RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-4.x-code)<a id=\"rocketmq-4.x-code-title\"></a>â˜‘ï¸\n- [RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-5.x-now)<a id=\"rocketmq-5.x-now-title\"></a>â˜‘ï¸\n- [RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-5.x-principle)<a id=\"rocketmq-5.x-principle-title\"></a>â¬œ\n- [RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-5.x-code)<a id=\"rocketmq-5.x-code-title\"></a>â¬œ\n- [å†™åœ¨æœ€å](#end)<a id=\"end-title\"></a>\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-4.x-now-title)<a id=\"rocketmq-4.x-now\"></a> [å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/zh/docs/4.x/producer/04message3/)\n- å­—æ®µmessage.delayTimeLevel\n- æšä¸¾ä¸ºæ•°å­—1-18ï¼Œåªæ”¯æŒ18ä¸ªå›ºå®šå»¶æ—¶ç­‰çº§ï¼ˆ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hï¼‰\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-4.x-principle-title)<a id=\"rocketmq-4.x-principle\"></a>\nåº•å±‚å®ç°ä¸»è¦æ˜¯åŸºäºBrokeç«¯ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š\n\n**1. CommitLog å†™å…¥å¤„**\nå½“æ¶ˆæ¯å¸¦æœ‰delayTimeLevel > 0æ—¶ï¼Œåœ¨CommitLog#asyncPutMessageæ–¹æ³•ä¸­ä¼šè¿›è¡Œç‰¹æ®Šå¤„ç†(è€ç‰ˆæœ¬æ˜¯CommitLog#putMessage)\n- å°†åŸå§‹çš„topicå’ŒqueueIdä¿å­˜åˆ°æ¶ˆæ¯å±æ€§ä¸­(REAL_TOPICã€REAL_QUEUE_ID)\n- ä¿®æ”¹æ¶ˆæ¯çš„topicä¸ºç³»ç»Ÿé¢„è®¾çš„å»¶è¿Ÿtopic(SCHEDULE_TOPIC_XXXX)\n- æ ¹æ®å»¶è¿Ÿçº§åˆ«è®¡ç®—å‡ºå¯¹åº”çš„queueId [ScheduleMessageService#delayLevel2QueueId](https://github.com/apache/rocketmq/blob/4.9.x/store/src/main/java/org/apache/rocketmq/store/schedule/ScheduleMessageService.java#L91)å¹¶æŠ•æ”¾åˆ°å¯¹åº”çš„queueä¸­\n\n**2. å®šæ—¶è°ƒåº¦æœåŠ¡ScheduleMessageService**\nè¯¥æœåŠ¡è´Ÿè´£æ‰«æå»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨åˆ°æœŸåå°†å…¶é‡æ–°æŠ•é€’åˆ°åŸå§‹çš„topic\n- å¯åŠ¨æ—¶ä¸ºæ¯ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«çš„queueåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡\n- å®šæœŸæ£€æŸ¥æ¯ä¸ªå»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯å¦åˆ°æœŸ(ä¸Šä¸€æ­¥ä¼šè®¡ç®—å½“å‰æ—¶é—´ï¼Œå¹¶æ ¹æ®å»¶è¿Ÿç­‰çº§è®¡ç®—å‡ºåˆ°æœŸæ—¶é—´ï¼Œæ³¨æ„è¶…å‡º18ä¼šé»˜è®¤18)\n- åˆ°æœŸåï¼Œæ¢å¤åŸå§‹topicå’ŒqueueIdï¼Œé‡æ–°æ„å»ºæ¶ˆæ¯å¹¶å†™å…¥CommitLogï¼Œè¿›å…¥æ­£å¸¸æ¶ˆè´¹æµç¨‹ã€‚\n\n**3.å…³é”®æºç **\n- [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest](#rocketmSendMessageProcessor#asyncProcessRequest)<a id=\"rocketmSendMessageProcessor#asyncProcessRequest-title\"></a>\n- [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage](#SendMessageProcessor#asyncSendMessage)<a id=\"SendMessageProcessor#asyncSendMessage-title\"></a>\n- [org.apache.rocketmq.store.CommitLog#asyncPutMessage](#CommitLog#asyncPutMessage)<a id=\"CommitLog#asyncPutMessage-title\"></a>\n- [org.apache.rocketmq.store.schedule.ScheduleMessageService#start](#ScheduleMessageService#start)<a id=\"ScheduleMessageService#start-title\"></a>\n- [org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask](#ScheduleMessageService.DeliverDelayedMessageTimerTask)<a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask-title\"></a>\n\n## [RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-4.x-code-title)<a id=\"rocketmq-4.x-code\"></a>\n### [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest](#rocketmSendMessageProcessor#asyncProcessRequest-title) <a id=\"rocketmSendMessageProcessor#asyncProcessRequest\"></a>\né¦–å…ˆæ˜¯æ”¶åˆ°çš„æ¶ˆæ¯å…ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬å‘å¤„ç†ï¼Œä¸»è¦æ˜¯ç¬¬17è¡Œä»£ç æä¾›å…¥å£ã€‚\n``` Java\npublic CompletableFuture<RemotingCommand> asyncProcessRequest(ChannelHandlerContext ctx,\n                                                                  RemotingCommand request) throws RemotingCommandException {\n        final SendMessageContext mqtraceContext;\n        switch (request.getCode()) {\n            case RequestCode.CONSUMER_SEND_MSG_BACK:\n                return this.asyncConsumerSendMsgBack(ctx, request);\n            default:\n                SendMessageRequestHeader requestHeader = parseRequestHeader(request);\n                if (requestHeader == null) {\n                    return CompletableFuture.completedFuture(null);\n                }\n                mqtraceContext = buildMsgContext(ctx, requestHeader);\n                this.executeSendMessageHookBefore(ctx, request, mqtraceContext);\n                if (requestHeader.isBatch()) {\n                    return this.asyncSendBatchMessage(ctx, request, mqtraceContext, requestHeader);\n                } else {\n                    return this.asyncSendMessage(ctx, request, mqtraceContext, requestHeader);\n                }\n        }\n    }\n```\n### [org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage](#SendMessageProcessor#asyncSendMessage-title) <a id=\"SendMessageProcessor#asyncSendMessage\"></a>\nè¿™é‡Œä¸»è¦çš„æ˜¯å…³æ³¨ç¬¬61è¡Œä»£ç ï¼Œè¿›å…¥åˆ°Stroreï¼Œè¿è¡ŒasyncPutMessageã€‚\n``` Java\nprivate CompletableFuture<RemotingCommand> asyncSendMessage(ChannelHandlerContext ctx, RemotingCommand request,\n                                                                SendMessageContext mqtraceContext,\n                                                                SendMessageRequestHeader requestHeader) {\n        final RemotingCommand response = preSend(ctx, request, requestHeader);\n        final SendMessageResponseHeader responseHeader = (SendMessageResponseHeader)response.readCustomHeader();\n\n        if (response.getCode() != -1) {\n            return CompletableFuture.completedFuture(response);\n        }\n\n        final byte[] body = request.getBody();\n\n        int queueIdInt = requestHeader.getQueueId();\n        TopicConfig topicConfig = this.brokerController.getTopicConfigManager().selectTopicConfig(requestHeader.getTopic());\n\n        if (queueIdInt < 0) {\n            queueIdInt = randomQueueId(topicConfig.getWriteQueueNums());\n        }\n\n        MessageExtBrokerInner msgInner = new MessageExtBrokerInner();\n        msgInner.setTopic(requestHeader.getTopic());\n        msgInner.setQueueId(queueIdInt);\n\n        if (!handleRetryAndDLQ(requestHeader, response, request, msgInner, topicConfig)) {\n            return CompletableFuture.completedFuture(response);\n        }\n\n        msgInner.setBody(body);\n        msgInner.setFlag(requestHeader.getFlag());\n        Map<String, String> origProps = MessageDecoder.string2messageProperties(requestHeader.getProperties());\n        MessageAccessor.setProperties(msgInner, origProps);\n        msgInner.setBornTimestamp(requestHeader.getBornTimestamp());\n        msgInner.setBornHost(ctx.channel().remoteAddress());\n        msgInner.setStoreHost(this.getStoreHost());\n        msgInner.setReconsumeTimes(requestHeader.getReconsumeTimes() == null ? 0 : requestHeader.getReconsumeTimes());\n        String clusterName = this.brokerController.getBrokerConfig().getBrokerClusterName();\n        MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_CLUSTER, clusterName);\n        if (origProps.containsKey(MessageConst.PROPERTY_WAIT_STORE_MSG_OK)) {\n            // There is no need to store \"WAIT=true\", remove it from propertiesString to save 9 bytes for each message.\n            // It works for most case. In some cases msgInner.setPropertiesString invoked later and replace it.\n            String waitStoreMsgOKValue = origProps.remove(MessageConst.PROPERTY_WAIT_STORE_MSG_OK);\n            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));\n            // Reput to properties, since msgInner.isWaitStoreMsgOK() will be invoked later\n            origProps.put(MessageConst.PROPERTY_WAIT_STORE_MSG_OK, waitStoreMsgOKValue);\n        } else {\n            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));\n        }\n\n        CompletableFuture<PutMessageResult> putMessageResult = null;\n        String transFlag = origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);\n        if (Boolean.parseBoolean(transFlag)) {\n            if (this.brokerController.getBrokerConfig().isRejectTransactionMessage()) {\n                response.setCode(ResponseCode.NO_PERMISSION);\n                response.setRemark(\n                        \"the broker[\" + this.brokerController.getBrokerConfig().getBrokerIP1()\n                                + \"] sending transaction message is forbidden\");\n                return CompletableFuture.completedFuture(response);\n            }\n            putMessageResult = this.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);\n        } else {\n            putMessageResult = this.brokerController.getMessageStore().asyncPutMessage(msgInner);\n        }\n        return handlePutMessageResultFuture(putMessageResult, response, request, msgInner, responseHeader, mqtraceContext, ctx, queueIdInt);\n    }\n```\n### [org.apache.rocketmq.store.CommitLog#asyncPutMessage](#CommitLog#asyncPutMessage-title) <a id=\"CommitLog#asyncPutMessage\"></a>\nputMessageçš„è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œä¸»è¦çœ‹ç¬¬åå…«è¡Œå¼€å§‹ï¼Œå¦‚æœæ˜¯å»¶è¿Ÿmqï¼Œåˆ™ä¼šå°†æ¶ˆæ¯æ”¾å…¥åˆ°topic=SCHEDULE_TOPIC_XXXX,queueId=delayLevel-1ä¸­\n``` java\npublic CompletableFuture<PutMessageResult> asyncPutMessage(final MessageExtBrokerInner msg) {\n        // Set the storage time\n        msg.setStoreTimestamp(System.currentTimeMillis());\n        // Set the message body BODY CRC (consider the most appropriate setting\n        // on the client)\n        msg.setBodyCRC(UtilAll.crc32(msg.getBody()));\n        // Back to Results\n        AppendMessageResult result = null;\n\n        StoreStatsService storeStatsService = this.defaultMessageStore.getStoreStatsService();\n\n        String topic = msg.getTopic();\n//        int queueId msg.getQueueId();\n        final int tranType = MessageSysFlag.getTransactionValue(msg.getSysFlag());\n        if (tranType == MessageSysFlag.TRANSACTION_NOT_TYPE\n                || tranType == MessageSysFlag.TRANSACTION_COMMIT_TYPE) {\n            // Delay Delivery\n            if (msg.getDelayTimeLevel() > 0) {\n                if (msg.getDelayTimeLevel() > this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) {\n                    msg.setDelayTimeLevel(this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel());\n                }\n\n                topic = TopicValidator.RMQ_SYS_SCHEDULE_TOPIC;\n                int queueId = ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel());\n\n                // Backup real topic, queueId\n                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic());\n                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId()));\n                msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties()));\n\n                msg.setTopic(topic);\n                msg.setQueueId(queueId);\n            }\n        }\n\n        InetSocketAddress bornSocketAddress = (InetSocketAddress) msg.getBornHost();\n        if (bornSocketAddress.getAddress() instanceof Inet6Address) {\n            msg.setBornHostV6Flag();\n        }\n\n        InetSocketAddress storeSocketAddress = (InetSocketAddress) msg.getStoreHost();\n        if (storeSocketAddress.getAddress() instanceof Inet6Address) {\n            msg.setStoreHostAddressV6Flag();\n        }\n\n        PutMessageThreadLocal putMessageThreadLocal = this.putMessageThreadLocal.get();\n        updateMaxMessageSize(putMessageThreadLocal);\n        if (!multiDispatch.isMultiDispatchMsg(msg)) {\n            PutMessageResult encodeResult = putMessageThreadLocal.getEncoder().encode(msg);\n            if (encodeResult != null) {\n                return CompletableFuture.completedFuture(encodeResult);\n            }\n            msg.setEncodedBuff(putMessageThreadLocal.getEncoder().getEncoderBuffer());\n        }\n        PutMessageContext putMessageContext = new PutMessageContext(generateKey(putMessageThreadLocal.getKeyBuilder(), msg));\n\n        long elapsedTimeInLock = 0;\n        MappedFile unlockMappedFile = null;\n\n        putMessageLock.lock(); //spin or ReentrantLock ,depending on store config\n        try {\n            MappedFile mappedFile = this.mappedFileQueue.getLastMappedFile();\n            long beginLockTimestamp = this.defaultMessageStore.getSystemClock().now();\n            this.beginTimeInLock = beginLockTimestamp;\n\n            // Here settings are stored timestamp, in order to ensure an orderly\n            // global\n            msg.setStoreTimestamp(beginLockTimestamp);\n\n            if (null == mappedFile || mappedFile.isFull()) {\n                mappedFile = this.mappedFileQueue.getLastMappedFile(0); // Mark: NewFile may be cause noise\n            }\n            if (null == mappedFile) {\n                log.error(\"create mapped file1 error, topic: \" + msg.getTopic() + \" clientAddr: \" + msg.getBornHostString());\n                return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.CREATE_MAPEDFILE_FAILED, null));\n            }\n\n            result = mappedFile.appendMessage(msg, this.appendMessageCallback, putMessageContext);\n            switch (result.getStatus()) {\n                case PUT_OK:\n                    break;\n                case END_OF_FILE:\n                    unlockMappedFile = mappedFile;\n                    // Create a new file, re-write the message\n                    mappedFile = this.mappedFileQueue.getLastMappedFile(0);\n                    if (null == mappedFile) {\n                        // XXX: warn and notify me\n                        log.error(\"create mapped file2 error, topic: \" + msg.getTopic() + \" clientAddr: \" + msg.getBornHostString());\n                        return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.CREATE_MAPEDFILE_FAILED, result));\n                    }\n                    result = mappedFile.appendMessage(msg, this.appendMessageCallback, putMessageContext);\n                    break;\n                case MESSAGE_SIZE_EXCEEDED:\n                case PROPERTIES_SIZE_EXCEEDED:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.MESSAGE_ILLEGAL, result));\n                case UNKNOWN_ERROR:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.UNKNOWN_ERROR, result));\n                default:\n                    return CompletableFuture.completedFuture(new PutMessageResult(PutMessageStatus.UNKNOWN_ERROR, result));\n            }\n\n            elapsedTimeInLock = this.defaultMessageStore.getSystemClock().now() - beginLockTimestamp;\n        } finally {\n            beginTimeInLock = 0;\n            putMessageLock.unlock();\n        }\n\n        if (elapsedTimeInLock > 500) {\n            log.warn(\"[NOTIFYME]putMessage in lock cost time(ms)={}, bodyLength={} AppendMessageResult={}\", elapsedTimeInLock, msg.getBody().length, result);\n        }\n\n        if (null != unlockMappedFile && this.defaultMessageStore.getMessageStoreConfig().isWarmMapedFileEnable()) {\n            this.defaultMessageStore.unlockMappedFile(unlockMappedFile);\n        }\n\n        PutMessageResult putMessageResult = new PutMessageResult(PutMessageStatus.PUT_OK, result);\n\n        // Statistics\n        storeStatsService.getSinglePutMessageTopicTimesTotal(msg.getTopic()).add(1);\n        storeStatsService.getSinglePutMessageTopicSizeTotal(topic).add(result.getWroteBytes());\n\n        CompletableFuture<PutMessageStatus> flushResultFuture = submitFlushRequest(result, msg);\n        CompletableFuture<PutMessageStatus> replicaResultFuture = submitReplicaRequest(result, msg);\n        return flushResultFuture.thenCombine(replicaResultFuture, (flushStatus, replicaStatus) -> {\n            if (flushStatus != PutMessageStatus.PUT_OK) {\n                putMessageResult.setPutMessageStatus(flushStatus);\n            }\n            if (replicaStatus != PutMessageStatus.PUT_OK) {\n                putMessageResult.setPutMessageStatus(replicaStatus);\n            }\n            return putMessageResult;\n        });\n    }\n```\n### [org.apache.rocketmq.store.schedule.ScheduleMessageService#start](#ScheduleMessageService#start-title) <a id=\"ScheduleMessageService#start\"></a>\nè¿™é‡Œä¸»è¦æ˜¯è§£é‡Šscheduleå¯¹æ¯ä¸€ä¸ªdelayLeveléƒ½å¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹ï¼Œæ‰§è¡Œé¢‘ç‡æ ¹æ®ä¸åŒdelayLevelå¯¹åº”çš„deladeliveryTimeå†³å®šã€‚\n``` java\npublic void start() {\n        if (started.compareAndSet(false, true)) {\n            this.load();\n            this.deliverExecutorService = new ScheduledThreadPoolExecutor(this.maxDelayLevel, new ThreadFactoryImpl(\"ScheduleMessageTimerThread_\"));\n            if (this.enableAsyncDeliver) {\n                this.handleExecutorService = new ScheduledThreadPoolExecutor(this.maxDelayLevel, new ThreadFactoryImpl(\"ScheduleMessageExecutorHandleThread_\"));\n            }\n            for (Map.Entry<Integer, Long> entry : this.delayLevelTable.entrySet()) {\n                Integer level = entry.getKey();\n                Long timeDelay = entry.getValue();\n                Long offset = this.offsetTable.get(level);\n                if (null == offset) {\n                    offset = 0L;\n                }\n\n                if (timeDelay != null) {\n                    if (this.enableAsyncDeliver) {\n                        this.handleExecutorService.schedule(new HandlePutResultTask(level), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);\n                    }\n                    this.deliverExecutorService.schedule(new DeliverDelayedMessageTimerTask(level, offset), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);\n                }\n            }\n\n            this.deliverExecutorService.scheduleAtFixedRate(new Runnable() {\n\n                @Override\n                public void run() {\n                    try {\n                        if (started.get()) {\n                            ScheduleMessageService.this.persist();\n                        }\n                    } catch (Throwable e) {\n                        log.error(\"scheduleAtFixedRate flush exception\", e);\n                    }\n                }\n            }, 10000, this.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(), TimeUnit.MILLISECONDS);\n        }\n    }\n```\n### [org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask](#ScheduleMessageService.DeliverDelayedMessageTimerTask-title) <a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask\"></a>\ntaskä¸»è¦çš„ä»»åŠ¡å°±æ˜¯101è¡Œï¼Œè°ƒç”¨org.apache.rocketmq.store.schedule.ScheduleMessageService#messageTimeupï¼Œå°†å¯¹è±¡è½¬æ¢æˆMessageExtBrokerInnerå¯¹è±¡ï¼ˆå¹¶åœ¨æ­¤æ—¶å°†topicå’ŒqueueIdé‡ç½®æˆåŸæ¥çš„ï¼‰ï¼Œç„¶åè°ƒç”¨org.apache.rocketmq.store.DefaultMessageStore#putMessageï¼Œå°†æ¶ˆæ¯æ”¾å…¥åˆ°commitLogä¸­ã€‚\n``` java\nclass DeliverDelayedMessageTimerTask implements Runnable {\n        private final int delayLevel;\n        private final long offset;\n\n        public DeliverDelayedMessageTimerTask(int delayLevel, long offset) {\n            this.delayLevel = delayLevel;\n            this.offset = offset;\n        }\n\n        @Override\n        public void run() {\n            try {\n                if (isStarted()) {\n                    this.executeOnTimeup();\n                }\n            } catch (Exception e) {\n                // XXX: warn and notify me\n                log.error(\"ScheduleMessageService, executeOnTimeup exception\", e);\n                this.scheduleNextTimerTask(this.offset, DELAY_FOR_A_PERIOD);\n            }\n        }\n\n        /**\n         * @return\n         */\n        private long correctDeliverTimestamp(final long now, final long deliverTimestamp) {\n\n            long result = deliverTimestamp;\n\n            long maxTimestamp = now + ScheduleMessageService.this.delayLevelTable.get(this.delayLevel);\n            if (deliverTimestamp > maxTimestamp) {\n                result = now;\n            }\n\n            return result;\n        }\n\n        public void executeOnTimeup() {\n            ConsumeQueue cq =\n                ScheduleMessageService.this.defaultMessageStore.findConsumeQueue(TopicValidator.RMQ_SYS_SCHEDULE_TOPIC,\n                    delayLevel2QueueId(delayLevel));\n\n            if (cq == null) {\n                this.scheduleNextTimerTask(this.offset, DELAY_FOR_A_WHILE);\n                return;\n            }\n\n            SelectMappedBufferResult bufferCQ = cq.getIndexBuffer(this.offset);\n            if (bufferCQ == null) {\n                long resetOffset;\n                if ((resetOffset = cq.getMinOffsetInQueue()) > this.offset) {\n                    log.error(\"schedule CQ offset invalid. offset={}, cqMinOffset={}, queueId={}\",\n                        this.offset, resetOffset, cq.getQueueId());\n                } else if ((resetOffset = cq.getMaxOffsetInQueue()) < this.offset) {\n                    log.error(\"schedule CQ offset invalid. offset={}, cqMaxOffset={}, queueId={}\",\n                        this.offset, resetOffset, cq.getQueueId());\n                } else {\n                    resetOffset = this.offset;\n                }\n\n                this.scheduleNextTimerTask(resetOffset, DELAY_FOR_A_WHILE);\n                return;\n            }\n\n            long nextOffset = this.offset;\n            try {\n                int i = 0;\n                ConsumeQueueExt.CqExtUnit cqExtUnit = new ConsumeQueueExt.CqExtUnit();\n                for (; i < bufferCQ.getSize() && isStarted(); i += ConsumeQueue.CQ_STORE_UNIT_SIZE) {\n                    long offsetPy = bufferCQ.getByteBuffer().getLong();\n                    int sizePy = bufferCQ.getByteBuffer().getInt();\n                    long tagsCode = bufferCQ.getByteBuffer().getLong();\n\n                    if (cq.isExtAddr(tagsCode)) {\n                        if (cq.getExt(tagsCode, cqExtUnit)) {\n                            tagsCode = cqExtUnit.getTagsCode();\n                        } else {\n                            //can't find ext content.So re compute tags code.\n                            log.error(\"[BUG] can't find consume queue extend file content!addr={}, offsetPy={}, sizePy={}\",\n                                tagsCode, offsetPy, sizePy);\n                            long msgStoreTime = defaultMessageStore.getCommitLog().pickupStoreTimestamp(offsetPy, sizePy);\n                            tagsCode = computeDeliverTimestamp(delayLevel, msgStoreTime);\n                        }\n                    }\n\n                    long now = System.currentTimeMillis();\n                    long deliverTimestamp = this.correctDeliverTimestamp(now, tagsCode);\n                    nextOffset = offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);\n\n                    long countdown = deliverTimestamp - now;\n                    if (countdown > 0) {\n                        this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n                        return;\n                    }\n\n                    MessageExt msgExt = ScheduleMessageService.this.defaultMessageStore.lookMessageByOffset(offsetPy, sizePy);\n                    if (msgExt == null) {\n                        continue;\n                    }\n\n                    MessageExtBrokerInner msgInner = ScheduleMessageService.this.messageTimeup(msgExt);\n                    if (TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC.equals(msgInner.getTopic())) {\n                        log.error(\"[BUG] the real topic of schedule msg is {}, discard the msg. msg={}\",\n                            msgInner.getTopic(), msgInner);\n                        continue;\n                    }\n\n                    boolean deliverSuc;\n                    if (ScheduleMessageService.this.enableAsyncDeliver) {\n                        deliverSuc = this.asyncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);\n                    } else {\n                        deliverSuc = this.syncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);\n                    }\n\n                    if (!deliverSuc) {\n                        this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n                        return;\n                    }\n                }\n\n                nextOffset = this.offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);\n            } catch (Exception e) {\n                log.error(\"ScheduleMessageService, messageTimeup execute error, offset = {}\", nextOffset, e);\n            } finally {\n                bufferCQ.release();\n            }\n\n            this.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);\n        }\n\n        public void scheduleNextTimerTask(long offset, long delay) {\n            ScheduleMessageService.this.deliverExecutorService.schedule(new DeliverDelayedMessageTimerTask(\n                this.delayLevel, offset), delay, TimeUnit.MILLISECONDS);\n        }\n\n        private boolean syncDeliver(MessageExtBrokerInner msgInner, String msgId, long offset, long offsetPy,\n            int sizePy) {\n            PutResultProcess resultProcess = deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, false);\n            PutMessageResult result = resultProcess.get();\n            boolean sendStatus = result != null && result.getPutMessageStatus() == PutMessageStatus.PUT_OK;\n            if (sendStatus) {\n                ScheduleMessageService.this.updateOffset(this.delayLevel, resultProcess.getNextOffset());\n            }\n            return sendStatus;\n        }\n\n        private boolean asyncDeliver(MessageExtBrokerInner msgInner, String msgId, long offset, long offsetPy,\n            int sizePy) {\n            Queue<PutResultProcess> processesQueue = ScheduleMessageService.this.deliverPendingTable.get(this.delayLevel);\n\n            //Flow Control\n            int currentPendingNum = processesQueue.size();\n            int maxPendingLimit = ScheduleMessageService.this.defaultMessageStore.getMessageStoreConfig()\n                .getScheduleAsyncDeliverMaxPendingLimit();\n            if (currentPendingNum > maxPendingLimit) {\n                log.warn(\"Asynchronous deliver triggers flow control, \" +\n                    \"currentPendingNum={}, maxPendingLimit={}\", currentPendingNum, maxPendingLimit);\n                return false;\n            }\n\n            //Blocked\n            PutResultProcess firstProcess = processesQueue.peek();\n            if (firstProcess != null && firstProcess.need2Blocked()) {\n                log.warn(\"Asynchronous deliver block. info={}\", firstProcess.toString());\n                return false;\n            }\n\n            PutResultProcess resultProcess = deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, true);\n            processesQueue.add(resultProcess);\n            return true;\n        }\n\n        private PutResultProcess deliverMessage(MessageExtBrokerInner msgInner, String msgId, long offset,\n            long offsetPy, int sizePy, boolean autoResend) {\n            CompletableFuture<PutMessageResult> future =\n                ScheduleMessageService.this.writeMessageStore.asyncPutMessage(msgInner);\n            return new PutResultProcess()\n                .setTopic(msgInner.getTopic())\n                .setDelayLevel(this.delayLevel)\n                .setOffset(offset)\n                .setPhysicOffset(offsetPy)\n                .setPhysicSize(sizePy)\n                .setMsgId(msgId)\n                .setAutoResend(autoResend)\n                .setFuture(future)\n                .thenProcess();\n        }\n    }\n```\n## [RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶](#rocketmq-5.x-now-title)<a id=\"rocketmq-5.x-now\"></a> [å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage/)\n- å­—æ®µmessage.deliveryTimestamp\n- å¯ä»¥é¢„å®šè§¦å‘çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯å»¶æ—¶æ—¶é•¿\n- æ”¯æŒä»¥æ ¼å¼ä¸ºæ¯«ç§’çº§unixæ—¶é—´æˆ³ï¼ˆé»˜è®¤1000æ¯«ç§’çš„ç²¾åº¦ä¹Ÿå°±æ˜¯1ç§’ï¼‰\n- æ”¯æŒæœ€é•¿24å°æ—¶ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹ï¼Œè¶…è¿‡24å°æ—¶å»¶æ—¶ä¸ç”Ÿæ•ˆï¼ŒæœåŠ¡ç«¯ä¼šç«‹å³æŠ•é€’\n- å®šæ—¶ä»»åŠ¡ä»…æ”¯æŒå‘é€åˆ°MessageTypeä¸ºDelayçš„Topicä¸­\n## [RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ](#rocketmq-5.x-principle-title)<a id=\"rocketmq-5.x-principle\"></a>\n## [RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ](#rocketmq-5.x-code-title)<a id=\"rocketmq-5.x-code\"></a>\n## [å†™åœ¨æœ€å](#end-title)<a id=\"end\"></a>\n&nbsp;&nbsp;&nbsp;&nbsp;åœ¨2025å¹´09æœˆ18æ—¥ï¼Œå¿ƒè¡€æ¥æ½®åœ¨githubä¸Šæœç´¢rocketMQçš„å»¶è¿Ÿmqï¼Œå‘ç°äº†2018å¹´çš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;æœ‰è‡ªå·±ä¸ºäº†å­¦ä¹ aiå¹¶ä½œä¸ºæ¯•è®¾çš„ä»“åº“ï¼Œæœ‰åŒå­¦å¸¦æˆ‘ç©çš„hexo + githubå®ç°çš„ç®€å•ä¸ªäººåšå®¢ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;åœ¨çœ‹å®Œæ–‡æ¡£å’Œä»£ç ä¹‹åç™¾æ„Ÿäº¤é›†ï¼Œç»ˆäºæ‰“ç®—é‡æ–°å¼€å§‹å†™åšå®¢ã€‚ä¸çŸ¥é“è¿™æ¬¡è¿˜èƒ½åšæŒå¤šä¹…ï¼Œä½†æ˜¯æ—¢ç„¶è‡ªå·±èƒ½ä¸€å£æ°”å‡è‚¥æ‰äº†43æ–¤ï¼ˆæˆªè‡³ç›®å‰ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆä¸èƒ½çš„å‘¢ï¼Ÿ\n&nbsp;&nbsp;&nbsp;&nbsp;åŠ æ²¹å§è‡ªå·±ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡çš„æ—¶å€™å¥½å¥½ç§¯ç´¯ï¼Œåšç§¯è–„å‘ã€‚","slug":"RocketMQå»¶æ—¶MQçš„åŸç†é˜…è¯»","published":1,"updated":"2025-09-24T06:09:21.204Z","_id":"cmfqf6qtj0000kgu7a8n8a6iz","comments":1,"layout":"post","photos":[],"content":"<p>status: draft<br>createDate: 2025-09-19 11:44:41<br>endDate:</p>\n<h2 id=\"ç›®å½•\"><a href=\"#ç›®å½•\" class=\"headerlink\" title=\"ç›®å½•\"></a>ç›®å½•</h2><ul>\n<li><a href=\"#rocketmq-4.x-now\">RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-4.x-now-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-4.x-principle\">RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-4.x-principle-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-4.x-code\">RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-4.x-code-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-5.x-now\">RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-5.x-now-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-5.x-principle\">RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-5.x-principle-title\"></a>â¬œ</li>\n<li><a href=\"#rocketmq-5.x-code\">RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-5.x-code-title\"></a>â¬œ</li>\n<li><a href=\"#end\">å†™åœ¨æœ€å</a><a id=\"end-title\"></a></li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶ å®˜æ–¹æ–‡æ¡£\"></a><a href=\"#rocketmq-4.x-now-title\">RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-4.x-now\"></a> <a href=\"https://rocketmq.apache.org/zh/docs/4.x/producer/04message3/\">å®˜æ–¹æ–‡æ¡£</a></h2><ul>\n<li>å­—æ®µmessage.delayTimeLevel</li>\n<li>æšä¸¾ä¸ºæ•°å­—1-18ï¼Œåªæ”¯æŒ18ä¸ªå›ºå®šå»¶æ—¶ç­‰çº§ï¼ˆ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hï¼‰</li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQåŸç†è§£æ\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQåŸç†è§£æ\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ\"></a><a href=\"#rocketmq-4.x-principle-title\">RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-4.x-principle\"></a></h2><p>åº•å±‚å®ç°ä¸»è¦æ˜¯åŸºäºBrokeç«¯ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š</p>\n<p><strong>1. CommitLog å†™å…¥å¤„</strong><br>å½“æ¶ˆæ¯å¸¦æœ‰delayTimeLevel &gt; 0æ—¶ï¼Œåœ¨CommitLog#asyncPutMessageæ–¹æ³•ä¸­ä¼šè¿›è¡Œç‰¹æ®Šå¤„ç†(è€ç‰ˆæœ¬æ˜¯CommitLog#putMessage)</p>\n<ul>\n<li>å°†åŸå§‹çš„topicå’ŒqueueIdä¿å­˜åˆ°æ¶ˆæ¯å±æ€§ä¸­(REAL_TOPICã€REAL_QUEUE_ID)</li>\n<li>ä¿®æ”¹æ¶ˆæ¯çš„topicä¸ºç³»ç»Ÿé¢„è®¾çš„å»¶è¿Ÿtopic(SCHEDULE_TOPIC_XXXX)</li>\n<li>æ ¹æ®å»¶è¿Ÿçº§åˆ«è®¡ç®—å‡ºå¯¹åº”çš„queueId <a href=\"https://github.com/apache/rocketmq/blob/4.9.x/store/src/main/java/org/apache/rocketmq/store/schedule/ScheduleMessageService.java#L91\">ScheduleMessageService#delayLevel2QueueId</a>å¹¶æŠ•æ”¾åˆ°å¯¹åº”çš„queueä¸­</li>\n</ul>\n<p><strong>2. å®šæ—¶è°ƒåº¦æœåŠ¡ScheduleMessageService</strong><br>è¯¥æœåŠ¡è´Ÿè´£æ‰«æå»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨åˆ°æœŸåå°†å…¶é‡æ–°æŠ•é€’åˆ°åŸå§‹çš„topic</p>\n<ul>\n<li>å¯åŠ¨æ—¶ä¸ºæ¯ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«çš„queueåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡</li>\n<li>å®šæœŸæ£€æŸ¥æ¯ä¸ªå»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯å¦åˆ°æœŸ(ä¸Šä¸€æ­¥ä¼šè®¡ç®—å½“å‰æ—¶é—´ï¼Œå¹¶æ ¹æ®å»¶è¿Ÿç­‰çº§è®¡ç®—å‡ºåˆ°æœŸæ—¶é—´ï¼Œæ³¨æ„è¶…å‡º18ä¼šé»˜è®¤18)</li>\n<li>åˆ°æœŸåï¼Œæ¢å¤åŸå§‹topicå’ŒqueueIdï¼Œé‡æ–°æ„å»ºæ¶ˆæ¯å¹¶å†™å…¥CommitLogï¼Œè¿›å…¥æ­£å¸¸æ¶ˆè´¹æµç¨‹ã€‚</li>\n</ul>\n<p><strong>3.å…³é”®æºç </strong></p>\n<ul>\n<li><a href=\"#rocketmSendMessageProcessor#asyncProcessRequest\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest</a><a id=\"rocketmSendMessageProcessor#asyncProcessRequest-title\"></a></li>\n<li><a href=\"#SendMessageProcessor#asyncSendMessage\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage</a><a id=\"SendMessageProcessor#asyncSendMessage-title\"></a></li>\n<li><a href=\"#CommitLog#asyncPutMessage\">org.apache.rocketmq.store.CommitLog#asyncPutMessage</a><a id=\"CommitLog#asyncPutMessage-title\"></a></li>\n<li><a href=\"#ScheduleMessageService#start\">org.apache.rocketmq.store.schedule.ScheduleMessageService#start</a><a id=\"ScheduleMessageService#start-title\"></a></li>\n<li><a href=\"#ScheduleMessageService.DeliverDelayedMessageTimerTask\">org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask</a><a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask-title\"></a></li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQæºç è§£æ\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQæºç è§£æ\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ\"></a><a href=\"#rocketmq-4.x-code-title\">RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-4.x-code\"></a></h2><h3 id=\"org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncProcessRequest\"><a href=\"#org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncProcessRequest\" class=\"headerlink\" title=\"org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest \"></a><a href=\"#rocketmSendMessageProcessor#asyncProcessRequest-title\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest</a> <a id=\"rocketmSendMessageProcessor#asyncProcessRequest\"></a></h3><p>é¦–å…ˆæ˜¯æ”¶åˆ°çš„æ¶ˆæ¯å…ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬å‘å¤„ç†ï¼Œä¸»è¦æ˜¯ç¬¬17è¡Œä»£ç æä¾›å…¥å£ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> CompletableFuture&lt;RemotingCommand&gt; <span class=\"title function_\">asyncProcessRequest</span><span class=\"params\">(ChannelHandlerContext ctx,</span></span><br><span class=\"line\"><span class=\"params\">                                                                  RemotingCommand request)</span> <span class=\"keyword\">throws</span> RemotingCommandException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> SendMessageContext mqtraceContext;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (request.getCode()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> RequestCode.CONSUMER_SEND_MSG_BACK:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncConsumerSendMsgBack(ctx, request);</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"type\">SendMessageRequestHeader</span> <span class=\"variable\">requestHeader</span> <span class=\"operator\">=</span> parseRequestHeader(request);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"literal\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                mqtraceContext = buildMsgContext(ctx, requestHeader);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.executeSendMessageHookBefore(ctx, request, mqtraceContext);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader.isBatch()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncSendBatchMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncSendMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncSendMessage\"><a href=\"#org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncSendMessage\" class=\"headerlink\" title=\"org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage \"></a><a href=\"#SendMessageProcessor#asyncSendMessage-title\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage</a> <a id=\"SendMessageProcessor#asyncSendMessage\"></a></h3><p>è¿™é‡Œä¸»è¦çš„æ˜¯å…³æ³¨ç¬¬61è¡Œä»£ç ï¼Œè¿›å…¥åˆ°Stroreï¼Œè¿è¡ŒasyncPutMessageã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> CompletableFuture&lt;RemotingCommand&gt; <span class=\"title function_\">asyncSendMessage</span><span class=\"params\">(ChannelHandlerContext ctx, RemotingCommand request,</span></span><br><span class=\"line\"><span class=\"params\">                                                                SendMessageContext mqtraceContext,</span></span><br><span class=\"line\"><span class=\"params\">                                                                SendMessageRequestHeader requestHeader)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">RemotingCommand</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> preSend(ctx, request, requestHeader);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">SendMessageResponseHeader</span> <span class=\"variable\">responseHeader</span> <span class=\"operator\">=</span> (SendMessageResponseHeader)response.readCustomHeader();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (response.getCode() != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">byte</span>[] body = request.getBody();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">queueIdInt</span> <span class=\"operator\">=</span> requestHeader.getQueueId();</span><br><span class=\"line\">        <span class=\"type\">TopicConfig</span> <span class=\"variable\">topicConfig</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.brokerController.getTopicConfigManager().selectTopicConfig(requestHeader.getTopic());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (queueIdInt &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            queueIdInt = randomQueueId(topicConfig.getWriteQueueNums());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">MessageExtBrokerInner</span> <span class=\"variable\">msgInner</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MessageExtBrokerInner</span>();</span><br><span class=\"line\">        msgInner.setTopic(requestHeader.getTopic());</span><br><span class=\"line\">        msgInner.setQueueId(queueIdInt);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!handleRetryAndDLQ(requestHeader, response, request, msgInner, topicConfig)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        msgInner.setBody(body);</span><br><span class=\"line\">        msgInner.setFlag(requestHeader.getFlag());</span><br><span class=\"line\">        Map&lt;String, String&gt; origProps = MessageDecoder.string2messageProperties(requestHeader.getProperties());</span><br><span class=\"line\">        MessageAccessor.setProperties(msgInner, origProps);</span><br><span class=\"line\">        msgInner.setBornTimestamp(requestHeader.getBornTimestamp());</span><br><span class=\"line\">        msgInner.setBornHost(ctx.channel().remoteAddress());</span><br><span class=\"line\">        msgInner.setStoreHost(<span class=\"built_in\">this</span>.getStoreHost());</span><br><span class=\"line\">        msgInner.setReconsumeTimes(requestHeader.getReconsumeTimes() == <span class=\"literal\">null</span> ? <span class=\"number\">0</span> : requestHeader.getReconsumeTimes());</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">clusterName</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.brokerController.getBrokerConfig().getBrokerClusterName();</span><br><span class=\"line\">        MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_CLUSTER, clusterName);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (origProps.containsKey(MessageConst.PROPERTY_WAIT_STORE_MSG_OK)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// There is no need to store &quot;WAIT=true&quot;, remove it from propertiesString to save 9 bytes for each message.</span></span><br><span class=\"line\">            <span class=\"comment\">// It works for most case. In some cases msgInner.setPropertiesString invoked later and replace it.</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">waitStoreMsgOKValue</span> <span class=\"operator\">=</span> origProps.remove(MessageConst.PROPERTY_WAIT_STORE_MSG_OK);</span><br><span class=\"line\">            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));</span><br><span class=\"line\">            <span class=\"comment\">// Reput to properties, since msgInner.isWaitStoreMsgOK() will be invoked later</span></span><br><span class=\"line\">            origProps.put(MessageConst.PROPERTY_WAIT_STORE_MSG_OK, waitStoreMsgOKValue);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        CompletableFuture&lt;PutMessageResult&gt; putMessageResult = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">transFlag</span> <span class=\"operator\">=</span> origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Boolean.parseBoolean(transFlag)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.brokerController.getBrokerConfig().isRejectTransactionMessage()) &#123;</span><br><span class=\"line\">                response.setCode(ResponseCode.NO_PERMISSION);</span><br><span class=\"line\">                response.setRemark(</span><br><span class=\"line\">                        <span class=\"string\">&quot;the broker[&quot;</span> + <span class=\"built_in\">this</span>.brokerController.getBrokerConfig().getBrokerIP1()</span><br><span class=\"line\">                                + <span class=\"string\">&quot;] sending transaction message is forbidden&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            putMessageResult = <span class=\"built_in\">this</span>.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            putMessageResult = <span class=\"built_in\">this</span>.brokerController.getMessageStore().asyncPutMessage(msgInner);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> handlePutMessageResultFuture(putMessageResult, response, request, msgInner, responseHeader, mqtraceContext, ctx, queueIdInt);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-CommitLog-asyncPutMessage\"><a href=\"#org-apache-rocketmq-store-CommitLog-asyncPutMessage\" class=\"headerlink\" title=\"org.apache.rocketmq.store.CommitLog#asyncPutMessage \"></a><a href=\"#CommitLog#asyncPutMessage-title\">org.apache.rocketmq.store.CommitLog#asyncPutMessage</a> <a id=\"CommitLog#asyncPutMessage\"></a></h3><p>putMessageçš„è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œä¸»è¦çœ‹ç¬¬åå…«è¡Œå¼€å§‹ï¼Œå¦‚æœæ˜¯å»¶è¿Ÿmqï¼Œåˆ™ä¼šå°†æ¶ˆæ¯æ”¾å…¥åˆ°topic&#x3D;SCHEDULE_TOPIC_XXXX,queueId&#x3D;delayLevel-1ä¸­</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> CompletableFuture&lt;PutMessageResult&gt; <span class=\"title function_\">asyncPutMessage</span><span class=\"params\">(<span class=\"keyword\">final</span> MessageExtBrokerInner msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Set the storage time</span></span><br><span class=\"line\">        msg.setStoreTimestamp(System.currentTimeMillis());</span><br><span class=\"line\">        <span class=\"comment\">// Set the message body BODY CRC (consider the most appropriate setting</span></span><br><span class=\"line\">        <span class=\"comment\">// on the client)</span></span><br><span class=\"line\">        msg.setBodyCRC(UtilAll.crc32(msg.getBody()));</span><br><span class=\"line\">        <span class=\"comment\">// Back to Results</span></span><br><span class=\"line\">        <span class=\"type\">AppendMessageResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">StoreStatsService</span> <span class=\"variable\">storeStatsService</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.defaultMessageStore.getStoreStatsService();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">topic</span> <span class=\"operator\">=</span> msg.getTopic();</span><br><span class=\"line\"><span class=\"comment\">//        int queueId msg.getQueueId();</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">tranType</span> <span class=\"operator\">=</span> MessageSysFlag.getTransactionValue(msg.getSysFlag());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tranType == MessageSysFlag.TRANSACTION_NOT_TYPE</span><br><span class=\"line\">                || tranType == MessageSysFlag.TRANSACTION_COMMIT_TYPE) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Delay Delivery</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (msg.getDelayTimeLevel() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (msg.getDelayTimeLevel() &gt; <span class=\"built_in\">this</span>.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) &#123;</span><br><span class=\"line\">                    msg.setDelayTimeLevel(<span class=\"built_in\">this</span>.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                topic = TopicValidator.RMQ_SYS_SCHEDULE_TOPIC;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">queueId</span> <span class=\"operator\">=</span> ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel());</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// Backup real topic, queueId</span></span><br><span class=\"line\">                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic());</span><br><span class=\"line\">                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId()));</span><br><span class=\"line\">                msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties()));</span><br><span class=\"line\"></span><br><span class=\"line\">                msg.setTopic(topic);</span><br><span class=\"line\">                msg.setQueueId(queueId);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">InetSocketAddress</span> <span class=\"variable\">bornSocketAddress</span> <span class=\"operator\">=</span> (InetSocketAddress) msg.getBornHost();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bornSocketAddress.getAddress() <span class=\"keyword\">instanceof</span> Inet6Address) &#123;</span><br><span class=\"line\">            msg.setBornHostV6Flag();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">InetSocketAddress</span> <span class=\"variable\">storeSocketAddress</span> <span class=\"operator\">=</span> (InetSocketAddress) msg.getStoreHost();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (storeSocketAddress.getAddress() <span class=\"keyword\">instanceof</span> Inet6Address) &#123;</span><br><span class=\"line\">            msg.setStoreHostAddressV6Flag();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">PutMessageThreadLocal</span> <span class=\"variable\">putMessageThreadLocal</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.putMessageThreadLocal.get();</span><br><span class=\"line\">        updateMaxMessageSize(putMessageThreadLocal);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!multiDispatch.isMultiDispatchMsg(msg)) &#123;</span><br><span class=\"line\">            <span class=\"type\">PutMessageResult</span> <span class=\"variable\">encodeResult</span> <span class=\"operator\">=</span> putMessageThreadLocal.getEncoder().encode(msg);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (encodeResult != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(encodeResult);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            msg.setEncodedBuff(putMessageThreadLocal.getEncoder().getEncoderBuffer());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">PutMessageContext</span> <span class=\"variable\">putMessageContext</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageContext</span>(generateKey(putMessageThreadLocal.getKeyBuilder(), msg));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">elapsedTimeInLock</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">MappedFile</span> <span class=\"variable\">unlockMappedFile</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        putMessageLock.lock(); <span class=\"comment\">//spin or ReentrantLock ,depending on store config</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">MappedFile</span> <span class=\"variable\">mappedFile</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile();</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">beginLockTimestamp</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.defaultMessageStore.getSystemClock().now();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.beginTimeInLock = beginLockTimestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Here settings are stored timestamp, in order to ensure an orderly</span></span><br><span class=\"line\">            <span class=\"comment\">// global</span></span><br><span class=\"line\">            msg.setStoreTimestamp(beginLockTimestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile || mappedFile.isFull()) &#123;</span><br><span class=\"line\">                mappedFile = <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile(<span class=\"number\">0</span>); <span class=\"comment\">// Mark: NewFile may be cause noise</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;create mapped file1 error, topic: &quot;</span> + msg.getTopic() + <span class=\"string\">&quot; clientAddr: &quot;</span> + msg.getBornHostString());</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.CREATE_MAPEDFILE_FAILED, <span class=\"literal\">null</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            result = mappedFile.appendMessage(msg, <span class=\"built_in\">this</span>.appendMessageCallback, putMessageContext);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (result.getStatus()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PUT_OK:</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> END_OF_FILE:</span><br><span class=\"line\">                    unlockMappedFile = mappedFile;</span><br><span class=\"line\">                    <span class=\"comment\">// Create a new file, re-write the message</span></span><br><span class=\"line\">                    mappedFile = <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile(<span class=\"number\">0</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// <span class=\"doctag\">XXX:</span> warn and notify me</span></span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;create mapped file2 error, topic: &quot;</span> + msg.getTopic() + <span class=\"string\">&quot; clientAddr: &quot;</span> + msg.getBornHostString());</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.CREATE_MAPEDFILE_FAILED, result));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    result = mappedFile.appendMessage(msg, <span class=\"built_in\">this</span>.appendMessageCallback, putMessageContext);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> MESSAGE_SIZE_EXCEEDED:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PROPERTIES_SIZE_EXCEEDED:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.MESSAGE_ILLEGAL, result));</span><br><span class=\"line\">                <span class=\"keyword\">case</span> UNKNOWN_ERROR:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.UNKNOWN_ERROR, result));</span><br><span class=\"line\">                <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.UNKNOWN_ERROR, result));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            elapsedTimeInLock = <span class=\"built_in\">this</span>.defaultMessageStore.getSystemClock().now() - beginLockTimestamp;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            beginTimeInLock = <span class=\"number\">0</span>;</span><br><span class=\"line\">            putMessageLock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elapsedTimeInLock &gt; <span class=\"number\">500</span>) &#123;</span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot;[NOTIFYME]putMessage in lock cost time(ms)=&#123;&#125;, bodyLength=&#123;&#125; AppendMessageResult=&#123;&#125;&quot;</span>, elapsedTimeInLock, msg.getBody().length, result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != unlockMappedFile &amp;&amp; <span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig().isWarmMapedFileEnable()) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.defaultMessageStore.unlockMappedFile(unlockMappedFile);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">PutMessageResult</span> <span class=\"variable\">putMessageResult</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.PUT_OK, result);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Statistics</span></span><br><span class=\"line\">        storeStatsService.getSinglePutMessageTopicTimesTotal(msg.getTopic()).add(<span class=\"number\">1</span>);</span><br><span class=\"line\">        storeStatsService.getSinglePutMessageTopicSizeTotal(topic).add(result.getWroteBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        CompletableFuture&lt;PutMessageStatus&gt; flushResultFuture = submitFlushRequest(result, msg);</span><br><span class=\"line\">        CompletableFuture&lt;PutMessageStatus&gt; replicaResultFuture = submitReplicaRequest(result, msg);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> flushResultFuture.thenCombine(replicaResultFuture, (flushStatus, replicaStatus) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (flushStatus != PutMessageStatus.PUT_OK) &#123;</span><br><span class=\"line\">                putMessageResult.setPutMessageStatus(flushStatus);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (replicaStatus != PutMessageStatus.PUT_OK) &#123;</span><br><span class=\"line\">                putMessageResult.setPutMessageStatus(replicaStatus);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> putMessageResult;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-schedule-ScheduleMessageService-start\"><a href=\"#org-apache-rocketmq-store-schedule-ScheduleMessageService-start\" class=\"headerlink\" title=\"org.apache.rocketmq.store.schedule.ScheduleMessageService#start \"></a><a href=\"#ScheduleMessageService#start-title\">org.apache.rocketmq.store.schedule.ScheduleMessageService#start</a> <a id=\"ScheduleMessageService#start\"></a></h3><p>è¿™é‡Œä¸»è¦æ˜¯è§£é‡Šscheduleå¯¹æ¯ä¸€ä¸ªdelayLeveléƒ½å¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹ï¼Œæ‰§è¡Œé¢‘ç‡æ ¹æ®ä¸åŒdelayLevelå¯¹åº”çš„deladeliveryTimeå†³å®šã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">start</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (started.compareAndSet(<span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.load();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.deliverExecutorService = <span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(<span class=\"built_in\">this</span>.maxDelayLevel, <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadFactoryImpl</span>(<span class=\"string\">&quot;ScheduleMessageTimerThread_&quot;</span>));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.handleExecutorService = <span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(<span class=\"built_in\">this</span>.maxDelayLevel, <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadFactoryImpl</span>(<span class=\"string\">&quot;ScheduleMessageExecutorHandleThread_&quot;</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;Integer, Long&gt; entry : <span class=\"built_in\">this</span>.delayLevelTable.entrySet()) &#123;</span><br><span class=\"line\">                <span class=\"type\">Integer</span> <span class=\"variable\">level</span> <span class=\"operator\">=</span> entry.getKey();</span><br><span class=\"line\">                <span class=\"type\">Long</span> <span class=\"variable\">timeDelay</span> <span class=\"operator\">=</span> entry.getValue();</span><br><span class=\"line\">                <span class=\"type\">Long</span> <span class=\"variable\">offset</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.offsetTable.get(level);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == offset) &#123;</span><br><span class=\"line\">                    offset = <span class=\"number\">0L</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (timeDelay != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.handleExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">HandlePutResultTask</span>(level), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.deliverExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span>(level, offset), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.deliverExecutorService.scheduleAtFixedRate(<span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (started.get()) &#123;</span><br><span class=\"line\">                            ScheduleMessageService.<span class=\"built_in\">this</span>.persist();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;scheduleAtFixedRate flush exception&quot;</span>, e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;, <span class=\"number\">10000</span>, <span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(), TimeUnit.MILLISECONDS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-schedule-ScheduleMessageService-DeliverDelayedMessageTimerTask\"><a href=\"#org-apache-rocketmq-store-schedule-ScheduleMessageService-DeliverDelayedMessageTimerTask\" class=\"headerlink\" title=\"org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask \"></a><a href=\"#ScheduleMessageService.DeliverDelayedMessageTimerTask-title\">org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask</a> <a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask\"></a></h3><p>taskä¸»è¦çš„ä»»åŠ¡å°±æ˜¯101è¡Œï¼Œè°ƒç”¨org.apache.rocketmq.store.schedule.ScheduleMessageService#messageTimeupï¼Œå°†å¯¹è±¡è½¬æ¢æˆMessageExtBrokerInnerå¯¹è±¡ï¼ˆå¹¶åœ¨æ­¤æ—¶å°†topicå’ŒqueueIdé‡ç½®æˆåŸæ¥çš„ï¼‰ï¼Œç„¶åè°ƒç”¨org.apache.rocketmq.store.DefaultMessageStore#putMessageï¼Œå°†æ¶ˆæ¯æ”¾å…¥åˆ°commitLogä¸­ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayLevel;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> offset;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">DeliverDelayedMessageTimerTask</span><span class=\"params\">(<span class=\"type\">int</span> delayLevel, <span class=\"type\">long</span> offset)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.delayLevel = delayLevel;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.offset = offset;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isStarted()) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.executeOnTimeup();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// <span class=\"doctag\">XXX:</span> warn and notify me</span></span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;ScheduleMessageService, executeOnTimeup exception&quot;</span>, e);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(<span class=\"built_in\">this</span>.offset, DELAY_FOR_A_PERIOD);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">correctDeliverTimestamp</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"type\">long</span> now, <span class=\"keyword\">final</span> <span class=\"type\">long</span> deliverTimestamp)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> deliverTimestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">maxTimestamp</span> <span class=\"operator\">=</span> now + ScheduleMessageService.<span class=\"built_in\">this</span>.delayLevelTable.get(<span class=\"built_in\">this</span>.delayLevel);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deliverTimestamp &gt; maxTimestamp) &#123;</span><br><span class=\"line\">                result = now;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">executeOnTimeup</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ConsumeQueue</span> <span class=\"variable\">cq</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.findConsumeQueue(TopicValidator.RMQ_SYS_SCHEDULE_TOPIC,</span><br><span class=\"line\">                    delayLevel2QueueId(delayLevel));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cq == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(<span class=\"built_in\">this</span>.offset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">SelectMappedBufferResult</span> <span class=\"variable\">bufferCQ</span> <span class=\"operator\">=</span> cq.getIndexBuffer(<span class=\"built_in\">this</span>.offset);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bufferCQ == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">long</span> resetOffset;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((resetOffset = cq.getMinOffsetInQueue()) &gt; <span class=\"built_in\">this</span>.offset) &#123;</span><br><span class=\"line\">                    log.error(<span class=\"string\">&quot;schedule CQ offset invalid. offset=&#123;&#125;, cqMinOffset=&#123;&#125;, queueId=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.offset, resetOffset, cq.getQueueId());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((resetOffset = cq.getMaxOffsetInQueue()) &lt; <span class=\"built_in\">this</span>.offset) &#123;</span><br><span class=\"line\">                    log.error(<span class=\"string\">&quot;schedule CQ offset invalid. offset=&#123;&#125;, cqMaxOffset=&#123;&#125;, queueId=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.offset, resetOffset, cq.getQueueId());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    resetOffset = <span class=\"built_in\">this</span>.offset;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(resetOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">nextOffset</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.offset;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">                ConsumeQueueExt.<span class=\"type\">CqExtUnit</span> <span class=\"variable\">cqExtUnit</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConsumeQueueExt</span>.CqExtUnit();</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (; i &lt; bufferCQ.getSize() &amp;&amp; isStarted(); i += ConsumeQueue.CQ_STORE_UNIT_SIZE) &#123;</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">offsetPy</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getLong();</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">sizePy</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getInt();</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">tagsCode</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getLong();</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cq.isExtAddr(tagsCode)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (cq.getExt(tagsCode, cqExtUnit)) &#123;</span><br><span class=\"line\">                            tagsCode = cqExtUnit.getTagsCode();</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"comment\">//can&#x27;t find ext content.So re compute tags code.</span></span><br><span class=\"line\">                            log.error(<span class=\"string\">&quot;[BUG] can&#x27;t find consume queue extend file content!addr=&#123;&#125;, offsetPy=&#123;&#125;, sizePy=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                                tagsCode, offsetPy, sizePy);</span><br><span class=\"line\">                            <span class=\"type\">long</span> <span class=\"variable\">msgStoreTime</span> <span class=\"operator\">=</span> defaultMessageStore.getCommitLog().pickupStoreTimestamp(offsetPy, sizePy);</span><br><span class=\"line\">                            tagsCode = computeDeliverTimestamp(delayLevel, msgStoreTime);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">deliverTimestamp</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.correctDeliverTimestamp(now, tagsCode);</span><br><span class=\"line\">                    nextOffset = offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">countdown</span> <span class=\"operator\">=</span> deliverTimestamp - now;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (countdown &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">MessageExt</span> <span class=\"variable\">msgExt</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.lookMessageByOffset(offsetPy, sizePy);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (msgExt == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">MessageExtBrokerInner</span> <span class=\"variable\">msgInner</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.messageTimeup(msgExt);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC.equals(msgInner.getTopic())) &#123;</span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;[BUG] the real topic of schedule msg is &#123;&#125;, discard the msg. msg=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                            msgInner.getTopic(), msgInner);</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">boolean</span> deliverSuc;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (ScheduleMessageService.<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                        deliverSuc = <span class=\"built_in\">this</span>.asyncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        deliverSuc = <span class=\"built_in\">this</span>.syncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!deliverSuc) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                nextOffset = <span class=\"built_in\">this</span>.offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;ScheduleMessageService, messageTimeup execute error, offset = &#123;&#125;&quot;</span>, nextOffset, e);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                bufferCQ.release();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">scheduleNextTimerTask</span><span class=\"params\">(<span class=\"type\">long</span> offset, <span class=\"type\">long</span> delay)</span> &#123;</span><br><span class=\"line\">            ScheduleMessageService.<span class=\"built_in\">this</span>.deliverExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span>(</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.delayLevel, offset), delay, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">syncDeliver</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset, <span class=\"type\">long</span> offsetPy,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">int</span> sizePy)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">resultProcess</span> <span class=\"operator\">=</span> deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, <span class=\"literal\">false</span>);</span><br><span class=\"line\">            <span class=\"type\">PutMessageResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> resultProcess.get();</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">sendStatus</span> <span class=\"operator\">=</span> result != <span class=\"literal\">null</span> &amp;&amp; result.getPutMessageStatus() == PutMessageStatus.PUT_OK;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sendStatus) &#123;</span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.updateOffset(<span class=\"built_in\">this</span>.delayLevel, resultProcess.getNextOffset());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sendStatus;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">asyncDeliver</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset, <span class=\"type\">long</span> offsetPy,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">int</span> sizePy)</span> &#123;</span><br><span class=\"line\">            Queue&lt;PutResultProcess&gt; processesQueue = ScheduleMessageService.<span class=\"built_in\">this</span>.deliverPendingTable.get(<span class=\"built_in\">this</span>.delayLevel);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Flow Control</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">currentPendingNum</span> <span class=\"operator\">=</span> processesQueue.size();</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">maxPendingLimit</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig()</span><br><span class=\"line\">                .getScheduleAsyncDeliverMaxPendingLimit();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (currentPendingNum &gt; maxPendingLimit) &#123;</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;Asynchronous deliver triggers flow control, &quot;</span> +</span><br><span class=\"line\">                    <span class=\"string\">&quot;currentPendingNum=&#123;&#125;, maxPendingLimit=&#123;&#125;&quot;</span>, currentPendingNum, maxPendingLimit);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Blocked</span></span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">firstProcess</span> <span class=\"operator\">=</span> processesQueue.peek();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (firstProcess != <span class=\"literal\">null</span> &amp;&amp; firstProcess.need2Blocked()) &#123;</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;Asynchronous deliver block. info=&#123;&#125;&quot;</span>, firstProcess.toString());</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">resultProcess</span> <span class=\"operator\">=</span> deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, <span class=\"literal\">true</span>);</span><br><span class=\"line\">            processesQueue.add(resultProcess);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> PutResultProcess <span class=\"title function_\">deliverMessage</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">long</span> offsetPy, <span class=\"type\">int</span> sizePy, <span class=\"type\">boolean</span> autoResend)</span> &#123;</span><br><span class=\"line\">            CompletableFuture&lt;PutMessageResult&gt; future =</span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.writeMessageStore.asyncPutMessage(msgInner);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutResultProcess</span>()</span><br><span class=\"line\">                .setTopic(msgInner.getTopic())</span><br><span class=\"line\">                .setDelayLevel(<span class=\"built_in\">this</span>.delayLevel)</span><br><span class=\"line\">                .setOffset(offset)</span><br><span class=\"line\">                .setPhysicOffset(offsetPy)</span><br><span class=\"line\">                .setPhysicSize(sizePy)</span><br><span class=\"line\">                .setMsgId(msgId)</span><br><span class=\"line\">                .setAutoResend(autoResend)</span><br><span class=\"line\">                .setFuture(future)</span><br><span class=\"line\">                .thenProcess();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶ å®˜æ–¹æ–‡æ¡£\"></a><a href=\"#rocketmq-5.x-now-title\">RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-5.x-now\"></a> <a href=\"https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage/\">å®˜æ–¹æ–‡æ¡£</a></h2><ul>\n<li>å­—æ®µmessage.deliveryTimestamp</li>\n<li>å¯ä»¥é¢„å®šè§¦å‘çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯å»¶æ—¶æ—¶é•¿</li>\n<li>æ”¯æŒä»¥æ ¼å¼ä¸ºæ¯«ç§’çº§unixæ—¶é—´æˆ³ï¼ˆé»˜è®¤1000æ¯«ç§’çš„ç²¾åº¦ä¹Ÿå°±æ˜¯1ç§’ï¼‰</li>\n<li>æ”¯æŒæœ€é•¿24å°æ—¶ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹ï¼Œè¶…è¿‡24å°æ—¶å»¶æ—¶ä¸ç”Ÿæ•ˆï¼ŒæœåŠ¡ç«¯ä¼šç«‹å³æŠ•é€’</li>\n<li>å®šæ—¶ä»»åŠ¡ä»…æ”¯æŒå‘é€åˆ°MessageTypeä¸ºDelayçš„Topicä¸­</li>\n</ul>\n<h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQåŸç†è§£æ\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQåŸç†è§£æ\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ\"></a><a href=\"#rocketmq-5.x-principle-title\">RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-5.x-principle\"></a></h2><h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQæºç è§£æ\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQæºç è§£æ\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ\"></a><a href=\"#rocketmq-5.x-code-title\">RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-5.x-code\"></a></h2><h2 id=\"å†™åœ¨æœ€å\"><a href=\"#å†™åœ¨æœ€å\" class=\"headerlink\" title=\"å†™åœ¨æœ€å\"></a><a href=\"#end-title\">å†™åœ¨æœ€å</a><a id=\"end\"></a></h2><p>&nbsp;&nbsp;&nbsp;&nbsp;åœ¨2025å¹´09æœˆ18æ—¥ï¼Œå¿ƒè¡€æ¥æ½®åœ¨githubä¸Šæœç´¢rocketMQçš„å»¶è¿Ÿmqï¼Œå‘ç°äº†2018å¹´çš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;æœ‰è‡ªå·±ä¸ºäº†å­¦ä¹ aiå¹¶ä½œä¸ºæ¯•è®¾çš„ä»“åº“ï¼Œæœ‰åŒå­¦å¸¦æˆ‘ç©çš„hexo + githubå®ç°çš„ç®€å•ä¸ªäººåšå®¢ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;åœ¨çœ‹å®Œæ–‡æ¡£å’Œä»£ç ä¹‹åç™¾æ„Ÿäº¤é›†ï¼Œç»ˆäºæ‰“ç®—é‡æ–°å¼€å§‹å†™åšå®¢ã€‚ä¸çŸ¥é“è¿™æ¬¡è¿˜èƒ½åšæŒå¤šä¹…ï¼Œä½†æ˜¯æ—¢ç„¶è‡ªå·±èƒ½ä¸€å£æ°”å‡è‚¥æ‰äº†43æ–¤ï¼ˆæˆªè‡³ç›®å‰ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆä¸èƒ½çš„å‘¢ï¼Ÿ<br>&nbsp;&nbsp;&nbsp;&nbsp;åŠ æ²¹å§è‡ªå·±ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡çš„æ—¶å€™å¥½å¥½ç§¯ç´¯ï¼Œåšç§¯è–„å‘ã€‚</p>\n","excerpt":"","more":"<p>status: draft<br>createDate: 2025-09-19 11:44:41<br>endDate:</p>\n<h2 id=\"ç›®å½•\"><a href=\"#ç›®å½•\" class=\"headerlink\" title=\"ç›®å½•\"></a>ç›®å½•</h2><ul>\n<li><a href=\"#rocketmq-4.x-now\">RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-4.x-now-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-4.x-principle\">RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-4.x-principle-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-4.x-code\">RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-4.x-code-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-5.x-now\">RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-5.x-now-title\"></a>â˜‘ï¸</li>\n<li><a href=\"#rocketmq-5.x-principle\">RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-5.x-principle-title\"></a>â¬œ</li>\n<li><a href=\"#rocketmq-5.x-code\">RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-5.x-code-title\"></a>â¬œ</li>\n<li><a href=\"#end\">å†™åœ¨æœ€å</a><a id=\"end-title\"></a></li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶ å®˜æ–¹æ–‡æ¡£\"></a><a href=\"#rocketmq-4.x-now-title\">RocketMQ 4.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-4.x-now\"></a> <a href=\"https://rocketmq.apache.org/zh/docs/4.x/producer/04message3/\">å®˜æ–¹æ–‡æ¡£</a></h2><ul>\n<li>å­—æ®µmessage.delayTimeLevel</li>\n<li>æšä¸¾ä¸ºæ•°å­—1-18ï¼Œåªæ”¯æŒ18ä¸ªå›ºå®šå»¶æ—¶ç­‰çº§ï¼ˆ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hï¼‰</li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQåŸç†è§£æ\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQåŸç†è§£æ\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ\"></a><a href=\"#rocketmq-4.x-principle-title\">RocketMQ 4.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-4.x-principle\"></a></h2><p>åº•å±‚å®ç°ä¸»è¦æ˜¯åŸºäºBrokeç«¯ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š</p>\n<p><strong>1. CommitLog å†™å…¥å¤„</strong><br>å½“æ¶ˆæ¯å¸¦æœ‰delayTimeLevel &gt; 0æ—¶ï¼Œåœ¨CommitLog#asyncPutMessageæ–¹æ³•ä¸­ä¼šè¿›è¡Œç‰¹æ®Šå¤„ç†(è€ç‰ˆæœ¬æ˜¯CommitLog#putMessage)</p>\n<ul>\n<li>å°†åŸå§‹çš„topicå’ŒqueueIdä¿å­˜åˆ°æ¶ˆæ¯å±æ€§ä¸­(REAL_TOPICã€REAL_QUEUE_ID)</li>\n<li>ä¿®æ”¹æ¶ˆæ¯çš„topicä¸ºç³»ç»Ÿé¢„è®¾çš„å»¶è¿Ÿtopic(SCHEDULE_TOPIC_XXXX)</li>\n<li>æ ¹æ®å»¶è¿Ÿçº§åˆ«è®¡ç®—å‡ºå¯¹åº”çš„queueId <a href=\"https://github.com/apache/rocketmq/blob/4.9.x/store/src/main/java/org/apache/rocketmq/store/schedule/ScheduleMessageService.java#L91\">ScheduleMessageService#delayLevel2QueueId</a>å¹¶æŠ•æ”¾åˆ°å¯¹åº”çš„queueä¸­</li>\n</ul>\n<p><strong>2. å®šæ—¶è°ƒåº¦æœåŠ¡ScheduleMessageService</strong><br>è¯¥æœåŠ¡è´Ÿè´£æ‰«æå»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨åˆ°æœŸåå°†å…¶é‡æ–°æŠ•é€’åˆ°åŸå§‹çš„topic</p>\n<ul>\n<li>å¯åŠ¨æ—¶ä¸ºæ¯ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«çš„queueåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡</li>\n<li>å®šæœŸæ£€æŸ¥æ¯ä¸ªå»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯å¦åˆ°æœŸ(ä¸Šä¸€æ­¥ä¼šè®¡ç®—å½“å‰æ—¶é—´ï¼Œå¹¶æ ¹æ®å»¶è¿Ÿç­‰çº§è®¡ç®—å‡ºåˆ°æœŸæ—¶é—´ï¼Œæ³¨æ„è¶…å‡º18ä¼šé»˜è®¤18)</li>\n<li>åˆ°æœŸåï¼Œæ¢å¤åŸå§‹topicå’ŒqueueIdï¼Œé‡æ–°æ„å»ºæ¶ˆæ¯å¹¶å†™å…¥CommitLogï¼Œè¿›å…¥æ­£å¸¸æ¶ˆè´¹æµç¨‹ã€‚</li>\n</ul>\n<p><strong>3.å…³é”®æºç </strong></p>\n<ul>\n<li><a href=\"#rocketmSendMessageProcessor#asyncProcessRequest\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest</a><a id=\"rocketmSendMessageProcessor#asyncProcessRequest-title\"></a></li>\n<li><a href=\"#SendMessageProcessor#asyncSendMessage\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage</a><a id=\"SendMessageProcessor#asyncSendMessage-title\"></a></li>\n<li><a href=\"#CommitLog#asyncPutMessage\">org.apache.rocketmq.store.CommitLog#asyncPutMessage</a><a id=\"CommitLog#asyncPutMessage-title\"></a></li>\n<li><a href=\"#ScheduleMessageService#start\">org.apache.rocketmq.store.schedule.ScheduleMessageService#start</a><a id=\"ScheduleMessageService#start-title\"></a></li>\n<li><a href=\"#ScheduleMessageService.DeliverDelayedMessageTimerTask\">org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask</a><a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask-title\"></a></li>\n</ul>\n<h2 id=\"RocketMQ-4-Xçš„å»¶æ—¶MQæºç è§£æ\"><a href=\"#RocketMQ-4-Xçš„å»¶æ—¶MQæºç è§£æ\" class=\"headerlink\" title=\"RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ\"></a><a href=\"#rocketmq-4.x-code-title\">RocketMQ 4.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-4.x-code\"></a></h2><h3 id=\"org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncProcessRequest\"><a href=\"#org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncProcessRequest\" class=\"headerlink\" title=\"org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest \"></a><a href=\"#rocketmSendMessageProcessor#asyncProcessRequest-title\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncProcessRequest</a> <a id=\"rocketmSendMessageProcessor#asyncProcessRequest\"></a></h3><p>é¦–å…ˆæ˜¯æ”¶åˆ°çš„æ¶ˆæ¯å…ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬å‘å¤„ç†ï¼Œä¸»è¦æ˜¯ç¬¬17è¡Œä»£ç æä¾›å…¥å£ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> CompletableFuture&lt;RemotingCommand&gt; <span class=\"title function_\">asyncProcessRequest</span><span class=\"params\">(ChannelHandlerContext ctx,</span></span><br><span class=\"line\"><span class=\"params\">                                                                  RemotingCommand request)</span> <span class=\"keyword\">throws</span> RemotingCommandException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> SendMessageContext mqtraceContext;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (request.getCode()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> RequestCode.CONSUMER_SEND_MSG_BACK:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncConsumerSendMsgBack(ctx, request);</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"type\">SendMessageRequestHeader</span> <span class=\"variable\">requestHeader</span> <span class=\"operator\">=</span> parseRequestHeader(request);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"literal\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                mqtraceContext = buildMsgContext(ctx, requestHeader);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.executeSendMessageHookBefore(ctx, request, mqtraceContext);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader.isBatch()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncSendBatchMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.asyncSendMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncSendMessage\"><a href=\"#org-apache-rocketmq-broker-processor-SendMessageProcessor-asyncSendMessage\" class=\"headerlink\" title=\"org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage \"></a><a href=\"#SendMessageProcessor#asyncSendMessage-title\">org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncSendMessage</a> <a id=\"SendMessageProcessor#asyncSendMessage\"></a></h3><p>è¿™é‡Œä¸»è¦çš„æ˜¯å…³æ³¨ç¬¬61è¡Œä»£ç ï¼Œè¿›å…¥åˆ°Stroreï¼Œè¿è¡ŒasyncPutMessageã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> CompletableFuture&lt;RemotingCommand&gt; <span class=\"title function_\">asyncSendMessage</span><span class=\"params\">(ChannelHandlerContext ctx, RemotingCommand request,</span></span><br><span class=\"line\"><span class=\"params\">                                                                SendMessageContext mqtraceContext,</span></span><br><span class=\"line\"><span class=\"params\">                                                                SendMessageRequestHeader requestHeader)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">RemotingCommand</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> preSend(ctx, request, requestHeader);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">SendMessageResponseHeader</span> <span class=\"variable\">responseHeader</span> <span class=\"operator\">=</span> (SendMessageResponseHeader)response.readCustomHeader();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (response.getCode() != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">byte</span>[] body = request.getBody();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">queueIdInt</span> <span class=\"operator\">=</span> requestHeader.getQueueId();</span><br><span class=\"line\">        <span class=\"type\">TopicConfig</span> <span class=\"variable\">topicConfig</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.brokerController.getTopicConfigManager().selectTopicConfig(requestHeader.getTopic());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (queueIdInt &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            queueIdInt = randomQueueId(topicConfig.getWriteQueueNums());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">MessageExtBrokerInner</span> <span class=\"variable\">msgInner</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MessageExtBrokerInner</span>();</span><br><span class=\"line\">        msgInner.setTopic(requestHeader.getTopic());</span><br><span class=\"line\">        msgInner.setQueueId(queueIdInt);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!handleRetryAndDLQ(requestHeader, response, request, msgInner, topicConfig)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        msgInner.setBody(body);</span><br><span class=\"line\">        msgInner.setFlag(requestHeader.getFlag());</span><br><span class=\"line\">        Map&lt;String, String&gt; origProps = MessageDecoder.string2messageProperties(requestHeader.getProperties());</span><br><span class=\"line\">        MessageAccessor.setProperties(msgInner, origProps);</span><br><span class=\"line\">        msgInner.setBornTimestamp(requestHeader.getBornTimestamp());</span><br><span class=\"line\">        msgInner.setBornHost(ctx.channel().remoteAddress());</span><br><span class=\"line\">        msgInner.setStoreHost(<span class=\"built_in\">this</span>.getStoreHost());</span><br><span class=\"line\">        msgInner.setReconsumeTimes(requestHeader.getReconsumeTimes() == <span class=\"literal\">null</span> ? <span class=\"number\">0</span> : requestHeader.getReconsumeTimes());</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">clusterName</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.brokerController.getBrokerConfig().getBrokerClusterName();</span><br><span class=\"line\">        MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_CLUSTER, clusterName);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (origProps.containsKey(MessageConst.PROPERTY_WAIT_STORE_MSG_OK)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// There is no need to store &quot;WAIT=true&quot;, remove it from propertiesString to save 9 bytes for each message.</span></span><br><span class=\"line\">            <span class=\"comment\">// It works for most case. In some cases msgInner.setPropertiesString invoked later and replace it.</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">waitStoreMsgOKValue</span> <span class=\"operator\">=</span> origProps.remove(MessageConst.PROPERTY_WAIT_STORE_MSG_OK);</span><br><span class=\"line\">            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));</span><br><span class=\"line\">            <span class=\"comment\">// Reput to properties, since msgInner.isWaitStoreMsgOK() will be invoked later</span></span><br><span class=\"line\">            origProps.put(MessageConst.PROPERTY_WAIT_STORE_MSG_OK, waitStoreMsgOKValue);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        CompletableFuture&lt;PutMessageResult&gt; putMessageResult = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">transFlag</span> <span class=\"operator\">=</span> origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Boolean.parseBoolean(transFlag)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.brokerController.getBrokerConfig().isRejectTransactionMessage()) &#123;</span><br><span class=\"line\">                response.setCode(ResponseCode.NO_PERMISSION);</span><br><span class=\"line\">                response.setRemark(</span><br><span class=\"line\">                        <span class=\"string\">&quot;the broker[&quot;</span> + <span class=\"built_in\">this</span>.brokerController.getBrokerConfig().getBrokerIP1()</span><br><span class=\"line\">                                + <span class=\"string\">&quot;] sending transaction message is forbidden&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(response);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            putMessageResult = <span class=\"built_in\">this</span>.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            putMessageResult = <span class=\"built_in\">this</span>.brokerController.getMessageStore().asyncPutMessage(msgInner);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> handlePutMessageResultFuture(putMessageResult, response, request, msgInner, responseHeader, mqtraceContext, ctx, queueIdInt);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-CommitLog-asyncPutMessage\"><a href=\"#org-apache-rocketmq-store-CommitLog-asyncPutMessage\" class=\"headerlink\" title=\"org.apache.rocketmq.store.CommitLog#asyncPutMessage \"></a><a href=\"#CommitLog#asyncPutMessage-title\">org.apache.rocketmq.store.CommitLog#asyncPutMessage</a> <a id=\"CommitLog#asyncPutMessage\"></a></h3><p>putMessageçš„è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œä¸»è¦çœ‹ç¬¬åå…«è¡Œå¼€å§‹ï¼Œå¦‚æœæ˜¯å»¶è¿Ÿmqï¼Œåˆ™ä¼šå°†æ¶ˆæ¯æ”¾å…¥åˆ°topic&#x3D;SCHEDULE_TOPIC_XXXX,queueId&#x3D;delayLevel-1ä¸­</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> CompletableFuture&lt;PutMessageResult&gt; <span class=\"title function_\">asyncPutMessage</span><span class=\"params\">(<span class=\"keyword\">final</span> MessageExtBrokerInner msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Set the storage time</span></span><br><span class=\"line\">        msg.setStoreTimestamp(System.currentTimeMillis());</span><br><span class=\"line\">        <span class=\"comment\">// Set the message body BODY CRC (consider the most appropriate setting</span></span><br><span class=\"line\">        <span class=\"comment\">// on the client)</span></span><br><span class=\"line\">        msg.setBodyCRC(UtilAll.crc32(msg.getBody()));</span><br><span class=\"line\">        <span class=\"comment\">// Back to Results</span></span><br><span class=\"line\">        <span class=\"type\">AppendMessageResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">StoreStatsService</span> <span class=\"variable\">storeStatsService</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.defaultMessageStore.getStoreStatsService();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">topic</span> <span class=\"operator\">=</span> msg.getTopic();</span><br><span class=\"line\"><span class=\"comment\">//        int queueId msg.getQueueId();</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">tranType</span> <span class=\"operator\">=</span> MessageSysFlag.getTransactionValue(msg.getSysFlag());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tranType == MessageSysFlag.TRANSACTION_NOT_TYPE</span><br><span class=\"line\">                || tranType == MessageSysFlag.TRANSACTION_COMMIT_TYPE) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Delay Delivery</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (msg.getDelayTimeLevel() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (msg.getDelayTimeLevel() &gt; <span class=\"built_in\">this</span>.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) &#123;</span><br><span class=\"line\">                    msg.setDelayTimeLevel(<span class=\"built_in\">this</span>.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                topic = TopicValidator.RMQ_SYS_SCHEDULE_TOPIC;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">queueId</span> <span class=\"operator\">=</span> ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel());</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// Backup real topic, queueId</span></span><br><span class=\"line\">                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic());</span><br><span class=\"line\">                MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId()));</span><br><span class=\"line\">                msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties()));</span><br><span class=\"line\"></span><br><span class=\"line\">                msg.setTopic(topic);</span><br><span class=\"line\">                msg.setQueueId(queueId);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">InetSocketAddress</span> <span class=\"variable\">bornSocketAddress</span> <span class=\"operator\">=</span> (InetSocketAddress) msg.getBornHost();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bornSocketAddress.getAddress() <span class=\"keyword\">instanceof</span> Inet6Address) &#123;</span><br><span class=\"line\">            msg.setBornHostV6Flag();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">InetSocketAddress</span> <span class=\"variable\">storeSocketAddress</span> <span class=\"operator\">=</span> (InetSocketAddress) msg.getStoreHost();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (storeSocketAddress.getAddress() <span class=\"keyword\">instanceof</span> Inet6Address) &#123;</span><br><span class=\"line\">            msg.setStoreHostAddressV6Flag();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">PutMessageThreadLocal</span> <span class=\"variable\">putMessageThreadLocal</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.putMessageThreadLocal.get();</span><br><span class=\"line\">        updateMaxMessageSize(putMessageThreadLocal);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!multiDispatch.isMultiDispatchMsg(msg)) &#123;</span><br><span class=\"line\">            <span class=\"type\">PutMessageResult</span> <span class=\"variable\">encodeResult</span> <span class=\"operator\">=</span> putMessageThreadLocal.getEncoder().encode(msg);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (encodeResult != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(encodeResult);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            msg.setEncodedBuff(putMessageThreadLocal.getEncoder().getEncoderBuffer());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">PutMessageContext</span> <span class=\"variable\">putMessageContext</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageContext</span>(generateKey(putMessageThreadLocal.getKeyBuilder(), msg));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">elapsedTimeInLock</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">MappedFile</span> <span class=\"variable\">unlockMappedFile</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        putMessageLock.lock(); <span class=\"comment\">//spin or ReentrantLock ,depending on store config</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">MappedFile</span> <span class=\"variable\">mappedFile</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile();</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">beginLockTimestamp</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.defaultMessageStore.getSystemClock().now();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.beginTimeInLock = beginLockTimestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Here settings are stored timestamp, in order to ensure an orderly</span></span><br><span class=\"line\">            <span class=\"comment\">// global</span></span><br><span class=\"line\">            msg.setStoreTimestamp(beginLockTimestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile || mappedFile.isFull()) &#123;</span><br><span class=\"line\">                mappedFile = <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile(<span class=\"number\">0</span>); <span class=\"comment\">// Mark: NewFile may be cause noise</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;create mapped file1 error, topic: &quot;</span> + msg.getTopic() + <span class=\"string\">&quot; clientAddr: &quot;</span> + msg.getBornHostString());</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.CREATE_MAPEDFILE_FAILED, <span class=\"literal\">null</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            result = mappedFile.appendMessage(msg, <span class=\"built_in\">this</span>.appendMessageCallback, putMessageContext);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (result.getStatus()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PUT_OK:</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> END_OF_FILE:</span><br><span class=\"line\">                    unlockMappedFile = mappedFile;</span><br><span class=\"line\">                    <span class=\"comment\">// Create a new file, re-write the message</span></span><br><span class=\"line\">                    mappedFile = <span class=\"built_in\">this</span>.mappedFileQueue.getLastMappedFile(<span class=\"number\">0</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == mappedFile) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// <span class=\"doctag\">XXX:</span> warn and notify me</span></span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;create mapped file2 error, topic: &quot;</span> + msg.getTopic() + <span class=\"string\">&quot; clientAddr: &quot;</span> + msg.getBornHostString());</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.CREATE_MAPEDFILE_FAILED, result));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    result = mappedFile.appendMessage(msg, <span class=\"built_in\">this</span>.appendMessageCallback, putMessageContext);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> MESSAGE_SIZE_EXCEEDED:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PROPERTIES_SIZE_EXCEEDED:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.MESSAGE_ILLEGAL, result));</span><br><span class=\"line\">                <span class=\"keyword\">case</span> UNKNOWN_ERROR:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.UNKNOWN_ERROR, result));</span><br><span class=\"line\">                <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.UNKNOWN_ERROR, result));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            elapsedTimeInLock = <span class=\"built_in\">this</span>.defaultMessageStore.getSystemClock().now() - beginLockTimestamp;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            beginTimeInLock = <span class=\"number\">0</span>;</span><br><span class=\"line\">            putMessageLock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elapsedTimeInLock &gt; <span class=\"number\">500</span>) &#123;</span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot;[NOTIFYME]putMessage in lock cost time(ms)=&#123;&#125;, bodyLength=&#123;&#125; AppendMessageResult=&#123;&#125;&quot;</span>, elapsedTimeInLock, msg.getBody().length, result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> != unlockMappedFile &amp;&amp; <span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig().isWarmMapedFileEnable()) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.defaultMessageStore.unlockMappedFile(unlockMappedFile);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">PutMessageResult</span> <span class=\"variable\">putMessageResult</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutMessageResult</span>(PutMessageStatus.PUT_OK, result);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Statistics</span></span><br><span class=\"line\">        storeStatsService.getSinglePutMessageTopicTimesTotal(msg.getTopic()).add(<span class=\"number\">1</span>);</span><br><span class=\"line\">        storeStatsService.getSinglePutMessageTopicSizeTotal(topic).add(result.getWroteBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        CompletableFuture&lt;PutMessageStatus&gt; flushResultFuture = submitFlushRequest(result, msg);</span><br><span class=\"line\">        CompletableFuture&lt;PutMessageStatus&gt; replicaResultFuture = submitReplicaRequest(result, msg);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> flushResultFuture.thenCombine(replicaResultFuture, (flushStatus, replicaStatus) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (flushStatus != PutMessageStatus.PUT_OK) &#123;</span><br><span class=\"line\">                putMessageResult.setPutMessageStatus(flushStatus);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (replicaStatus != PutMessageStatus.PUT_OK) &#123;</span><br><span class=\"line\">                putMessageResult.setPutMessageStatus(replicaStatus);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> putMessageResult;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-schedule-ScheduleMessageService-start\"><a href=\"#org-apache-rocketmq-store-schedule-ScheduleMessageService-start\" class=\"headerlink\" title=\"org.apache.rocketmq.store.schedule.ScheduleMessageService#start \"></a><a href=\"#ScheduleMessageService#start-title\">org.apache.rocketmq.store.schedule.ScheduleMessageService#start</a> <a id=\"ScheduleMessageService#start\"></a></h3><p>è¿™é‡Œä¸»è¦æ˜¯è§£é‡Šscheduleå¯¹æ¯ä¸€ä¸ªdelayLeveléƒ½å¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹ï¼Œæ‰§è¡Œé¢‘ç‡æ ¹æ®ä¸åŒdelayLevelå¯¹åº”çš„deladeliveryTimeå†³å®šã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">start</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (started.compareAndSet(<span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.load();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.deliverExecutorService = <span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(<span class=\"built_in\">this</span>.maxDelayLevel, <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadFactoryImpl</span>(<span class=\"string\">&quot;ScheduleMessageTimerThread_&quot;</span>));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.handleExecutorService = <span class=\"keyword\">new</span> <span class=\"title class_\">ScheduledThreadPoolExecutor</span>(<span class=\"built_in\">this</span>.maxDelayLevel, <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadFactoryImpl</span>(<span class=\"string\">&quot;ScheduleMessageExecutorHandleThread_&quot;</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;Integer, Long&gt; entry : <span class=\"built_in\">this</span>.delayLevelTable.entrySet()) &#123;</span><br><span class=\"line\">                <span class=\"type\">Integer</span> <span class=\"variable\">level</span> <span class=\"operator\">=</span> entry.getKey();</span><br><span class=\"line\">                <span class=\"type\">Long</span> <span class=\"variable\">timeDelay</span> <span class=\"operator\">=</span> entry.getValue();</span><br><span class=\"line\">                <span class=\"type\">Long</span> <span class=\"variable\">offset</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.offsetTable.get(level);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == offset) &#123;</span><br><span class=\"line\">                    offset = <span class=\"number\">0L</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (timeDelay != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.handleExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">HandlePutResultTask</span>(level), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.deliverExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span>(level, offset), FIRST_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.deliverExecutorService.scheduleAtFixedRate(<span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (started.get()) &#123;</span><br><span class=\"line\">                            ScheduleMessageService.<span class=\"built_in\">this</span>.persist();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;scheduleAtFixedRate flush exception&quot;</span>, e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;, <span class=\"number\">10000</span>, <span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(), TimeUnit.MILLISECONDS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"org-apache-rocketmq-store-schedule-ScheduleMessageService-DeliverDelayedMessageTimerTask\"><a href=\"#org-apache-rocketmq-store-schedule-ScheduleMessageService-DeliverDelayedMessageTimerTask\" class=\"headerlink\" title=\"org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask \"></a><a href=\"#ScheduleMessageService.DeliverDelayedMessageTimerTask-title\">org.apache.rocketmq.store.schedule.ScheduleMessageService.DeliverDelayedMessageTimerTask</a> <a id=\"ScheduleMessageService.DeliverDelayedMessageTimerTask\"></a></h3><p>taskä¸»è¦çš„ä»»åŠ¡å°±æ˜¯101è¡Œï¼Œè°ƒç”¨org.apache.rocketmq.store.schedule.ScheduleMessageService#messageTimeupï¼Œå°†å¯¹è±¡è½¬æ¢æˆMessageExtBrokerInnerå¯¹è±¡ï¼ˆå¹¶åœ¨æ­¤æ—¶å°†topicå’ŒqueueIdé‡ç½®æˆåŸæ¥çš„ï¼‰ï¼Œç„¶åè°ƒç”¨org.apache.rocketmq.store.DefaultMessageStore#putMessageï¼Œå°†æ¶ˆæ¯æ”¾å…¥åˆ°commitLogä¸­ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayLevel;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> offset;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">DeliverDelayedMessageTimerTask</span><span class=\"params\">(<span class=\"type\">int</span> delayLevel, <span class=\"type\">long</span> offset)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.delayLevel = delayLevel;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.offset = offset;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isStarted()) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.executeOnTimeup();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// <span class=\"doctag\">XXX:</span> warn and notify me</span></span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;ScheduleMessageService, executeOnTimeup exception&quot;</span>, e);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(<span class=\"built_in\">this</span>.offset, DELAY_FOR_A_PERIOD);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">correctDeliverTimestamp</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"type\">long</span> now, <span class=\"keyword\">final</span> <span class=\"type\">long</span> deliverTimestamp)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> deliverTimestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">maxTimestamp</span> <span class=\"operator\">=</span> now + ScheduleMessageService.<span class=\"built_in\">this</span>.delayLevelTable.get(<span class=\"built_in\">this</span>.delayLevel);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deliverTimestamp &gt; maxTimestamp) &#123;</span><br><span class=\"line\">                result = now;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">executeOnTimeup</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ConsumeQueue</span> <span class=\"variable\">cq</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.findConsumeQueue(TopicValidator.RMQ_SYS_SCHEDULE_TOPIC,</span><br><span class=\"line\">                    delayLevel2QueueId(delayLevel));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cq == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(<span class=\"built_in\">this</span>.offset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">SelectMappedBufferResult</span> <span class=\"variable\">bufferCQ</span> <span class=\"operator\">=</span> cq.getIndexBuffer(<span class=\"built_in\">this</span>.offset);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bufferCQ == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">long</span> resetOffset;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((resetOffset = cq.getMinOffsetInQueue()) &gt; <span class=\"built_in\">this</span>.offset) &#123;</span><br><span class=\"line\">                    log.error(<span class=\"string\">&quot;schedule CQ offset invalid. offset=&#123;&#125;, cqMinOffset=&#123;&#125;, queueId=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.offset, resetOffset, cq.getQueueId());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((resetOffset = cq.getMaxOffsetInQueue()) &lt; <span class=\"built_in\">this</span>.offset) &#123;</span><br><span class=\"line\">                    log.error(<span class=\"string\">&quot;schedule CQ offset invalid. offset=&#123;&#125;, cqMaxOffset=&#123;&#125;, queueId=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.offset, resetOffset, cq.getQueueId());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    resetOffset = <span class=\"built_in\">this</span>.offset;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleNextTimerTask(resetOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">nextOffset</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.offset;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">                ConsumeQueueExt.<span class=\"type\">CqExtUnit</span> <span class=\"variable\">cqExtUnit</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConsumeQueueExt</span>.CqExtUnit();</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (; i &lt; bufferCQ.getSize() &amp;&amp; isStarted(); i += ConsumeQueue.CQ_STORE_UNIT_SIZE) &#123;</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">offsetPy</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getLong();</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">sizePy</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getInt();</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">tagsCode</span> <span class=\"operator\">=</span> bufferCQ.getByteBuffer().getLong();</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cq.isExtAddr(tagsCode)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (cq.getExt(tagsCode, cqExtUnit)) &#123;</span><br><span class=\"line\">                            tagsCode = cqExtUnit.getTagsCode();</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"comment\">//can&#x27;t find ext content.So re compute tags code.</span></span><br><span class=\"line\">                            log.error(<span class=\"string\">&quot;[BUG] can&#x27;t find consume queue extend file content!addr=&#123;&#125;, offsetPy=&#123;&#125;, sizePy=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                                tagsCode, offsetPy, sizePy);</span><br><span class=\"line\">                            <span class=\"type\">long</span> <span class=\"variable\">msgStoreTime</span> <span class=\"operator\">=</span> defaultMessageStore.getCommitLog().pickupStoreTimestamp(offsetPy, sizePy);</span><br><span class=\"line\">                            tagsCode = computeDeliverTimestamp(delayLevel, msgStoreTime);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">deliverTimestamp</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.correctDeliverTimestamp(now, tagsCode);</span><br><span class=\"line\">                    nextOffset = offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">countdown</span> <span class=\"operator\">=</span> deliverTimestamp - now;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (countdown &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">MessageExt</span> <span class=\"variable\">msgExt</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.lookMessageByOffset(offsetPy, sizePy);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (msgExt == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">MessageExtBrokerInner</span> <span class=\"variable\">msgInner</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.messageTimeup(msgExt);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC.equals(msgInner.getTopic())) &#123;</span><br><span class=\"line\">                        log.error(<span class=\"string\">&quot;[BUG] the real topic of schedule msg is &#123;&#125;, discard the msg. msg=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">                            msgInner.getTopic(), msgInner);</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">boolean</span> deliverSuc;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (ScheduleMessageService.<span class=\"built_in\">this</span>.enableAsyncDeliver) &#123;</span><br><span class=\"line\">                        deliverSuc = <span class=\"built_in\">this</span>.asyncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        deliverSuc = <span class=\"built_in\">this</span>.syncDeliver(msgInner, msgExt.getMsgId(), nextOffset, offsetPy, sizePy);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!deliverSuc) &#123;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                nextOffset = <span class=\"built_in\">this</span>.offset + (i / ConsumeQueue.CQ_STORE_UNIT_SIZE);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;ScheduleMessageService, messageTimeup execute error, offset = &#123;&#125;&quot;</span>, nextOffset, e);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                bufferCQ.release();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scheduleNextTimerTask(nextOffset, DELAY_FOR_A_WHILE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">scheduleNextTimerTask</span><span class=\"params\">(<span class=\"type\">long</span> offset, <span class=\"type\">long</span> delay)</span> &#123;</span><br><span class=\"line\">            ScheduleMessageService.<span class=\"built_in\">this</span>.deliverExecutorService.schedule(<span class=\"keyword\">new</span> <span class=\"title class_\">DeliverDelayedMessageTimerTask</span>(</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.delayLevel, offset), delay, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">syncDeliver</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset, <span class=\"type\">long</span> offsetPy,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">int</span> sizePy)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">resultProcess</span> <span class=\"operator\">=</span> deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, <span class=\"literal\">false</span>);</span><br><span class=\"line\">            <span class=\"type\">PutMessageResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> resultProcess.get();</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">sendStatus</span> <span class=\"operator\">=</span> result != <span class=\"literal\">null</span> &amp;&amp; result.getPutMessageStatus() == PutMessageStatus.PUT_OK;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sendStatus) &#123;</span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.updateOffset(<span class=\"built_in\">this</span>.delayLevel, resultProcess.getNextOffset());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sendStatus;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">asyncDeliver</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset, <span class=\"type\">long</span> offsetPy,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">int</span> sizePy)</span> &#123;</span><br><span class=\"line\">            Queue&lt;PutResultProcess&gt; processesQueue = ScheduleMessageService.<span class=\"built_in\">this</span>.deliverPendingTable.get(<span class=\"built_in\">this</span>.delayLevel);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Flow Control</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">currentPendingNum</span> <span class=\"operator\">=</span> processesQueue.size();</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">maxPendingLimit</span> <span class=\"operator\">=</span> ScheduleMessageService.<span class=\"built_in\">this</span>.defaultMessageStore.getMessageStoreConfig()</span><br><span class=\"line\">                .getScheduleAsyncDeliverMaxPendingLimit();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (currentPendingNum &gt; maxPendingLimit) &#123;</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;Asynchronous deliver triggers flow control, &quot;</span> +</span><br><span class=\"line\">                    <span class=\"string\">&quot;currentPendingNum=&#123;&#125;, maxPendingLimit=&#123;&#125;&quot;</span>, currentPendingNum, maxPendingLimit);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Blocked</span></span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">firstProcess</span> <span class=\"operator\">=</span> processesQueue.peek();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (firstProcess != <span class=\"literal\">null</span> &amp;&amp; firstProcess.need2Blocked()) &#123;</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;Asynchronous deliver block. info=&#123;&#125;&quot;</span>, firstProcess.toString());</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">PutResultProcess</span> <span class=\"variable\">resultProcess</span> <span class=\"operator\">=</span> deliverMessage(msgInner, msgId, offset, offsetPy, sizePy, <span class=\"literal\">true</span>);</span><br><span class=\"line\">            processesQueue.add(resultProcess);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> PutResultProcess <span class=\"title function_\">deliverMessage</span><span class=\"params\">(MessageExtBrokerInner msgInner, String msgId, <span class=\"type\">long</span> offset,</span></span><br><span class=\"line\"><span class=\"params\">            <span class=\"type\">long</span> offsetPy, <span class=\"type\">int</span> sizePy, <span class=\"type\">boolean</span> autoResend)</span> &#123;</span><br><span class=\"line\">            CompletableFuture&lt;PutMessageResult&gt; future =</span><br><span class=\"line\">                ScheduleMessageService.<span class=\"built_in\">this</span>.writeMessageStore.asyncPutMessage(msgInner);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PutResultProcess</span>()</span><br><span class=\"line\">                .setTopic(msgInner.getTopic())</span><br><span class=\"line\">                .setDelayLevel(<span class=\"built_in\">this</span>.delayLevel)</span><br><span class=\"line\">                .setOffset(offset)</span><br><span class=\"line\">                .setPhysicOffset(offsetPy)</span><br><span class=\"line\">                .setPhysicSize(sizePy)</span><br><span class=\"line\">                .setMsgId(msgId)</span><br><span class=\"line\">                .setAutoResend(autoResend)</span><br><span class=\"line\">                .setFuture(future)</span><br><span class=\"line\">                .thenProcess();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQç°çŠ¶-å®˜æ–¹æ–‡æ¡£\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶ å®˜æ–¹æ–‡æ¡£\"></a><a href=\"#rocketmq-5.x-now-title\">RocketMQ 5.Xçš„å»¶æ—¶MQç°çŠ¶</a><a id=\"rocketmq-5.x-now\"></a> <a href=\"https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage/\">å®˜æ–¹æ–‡æ¡£</a></h2><ul>\n<li>å­—æ®µmessage.deliveryTimestamp</li>\n<li>å¯ä»¥é¢„å®šè§¦å‘çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯å»¶æ—¶æ—¶é•¿</li>\n<li>æ”¯æŒä»¥æ ¼å¼ä¸ºæ¯«ç§’çº§unixæ—¶é—´æˆ³ï¼ˆé»˜è®¤1000æ¯«ç§’çš„ç²¾åº¦ä¹Ÿå°±æ˜¯1ç§’ï¼‰</li>\n<li>æ”¯æŒæœ€é•¿24å°æ—¶ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹ï¼Œè¶…è¿‡24å°æ—¶å»¶æ—¶ä¸ç”Ÿæ•ˆï¼ŒæœåŠ¡ç«¯ä¼šç«‹å³æŠ•é€’</li>\n<li>å®šæ—¶ä»»åŠ¡ä»…æ”¯æŒå‘é€åˆ°MessageTypeä¸ºDelayçš„Topicä¸­</li>\n</ul>\n<h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQåŸç†è§£æ\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQåŸç†è§£æ\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ\"></a><a href=\"#rocketmq-5.x-principle-title\">RocketMQ 5.Xçš„å»¶æ—¶MQåŸç†è§£æ</a><a id=\"rocketmq-5.x-principle\"></a></h2><h2 id=\"RocketMQ-5-Xçš„å»¶æ—¶MQæºç è§£æ\"><a href=\"#RocketMQ-5-Xçš„å»¶æ—¶MQæºç è§£æ\" class=\"headerlink\" title=\"RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ\"></a><a href=\"#rocketmq-5.x-code-title\">RocketMQ 5.Xçš„å»¶æ—¶MQæºç è§£æ</a><a id=\"rocketmq-5.x-code\"></a></h2><h2 id=\"å†™åœ¨æœ€å\"><a href=\"#å†™åœ¨æœ€å\" class=\"headerlink\" title=\"å†™åœ¨æœ€å\"></a><a href=\"#end-title\">å†™åœ¨æœ€å</a><a id=\"end\"></a></h2><p>&nbsp;&nbsp;&nbsp;&nbsp;åœ¨2025å¹´09æœˆ18æ—¥ï¼Œå¿ƒè¡€æ¥æ½®åœ¨githubä¸Šæœç´¢rocketMQçš„å»¶è¿Ÿmqï¼Œå‘ç°äº†2018å¹´çš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;æœ‰è‡ªå·±ä¸ºäº†å­¦ä¹ aiå¹¶ä½œä¸ºæ¯•è®¾çš„ä»“åº“ï¼Œæœ‰åŒå­¦å¸¦æˆ‘ç©çš„hexo + githubå®ç°çš„ç®€å•ä¸ªäººåšå®¢ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;åœ¨çœ‹å®Œæ–‡æ¡£å’Œä»£ç ä¹‹åç™¾æ„Ÿäº¤é›†ï¼Œç»ˆäºæ‰“ç®—é‡æ–°å¼€å§‹å†™åšå®¢ã€‚ä¸çŸ¥é“è¿™æ¬¡è¿˜èƒ½åšæŒå¤šä¹…ï¼Œä½†æ˜¯æ—¢ç„¶è‡ªå·±èƒ½ä¸€å£æ°”å‡è‚¥æ‰äº†43æ–¤ï¼ˆæˆªè‡³ç›®å‰ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆä¸èƒ½çš„å‘¢ï¼Ÿ<br>&nbsp;&nbsp;&nbsp;&nbsp;åŠ æ²¹å§è‡ªå·±ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡çš„æ—¶å€™å¥½å¥½ç§¯ç´¯ï¼Œåšç§¯è–„å‘ã€‚</p>\n"},{"title":"todo-list","date":"2025-09-19T03:35:38.000Z","_content":"\n### [RocketMQ](/tags/RocketMQ/)\n1.æ™®é€šæ¶ˆæ¯\n2.å®šæ—¶/å»¶è¿Ÿæ¶ˆæ¯\n3.é¡ºåºæ¶ˆæ¯\n4.äº‹åŠ¡æ¶ˆæ¯\n5.æ‰¹é‡æ¶ˆæ¯\n6.pushæ¶ˆè´¹\n7.pullæ¶ˆè´¹\n8.mqtt\n9.stream\n10.æ¶ˆæ¯é‡è¯•å’Œæµæ§åˆ¶(5.xæ–‡æ¡£)\n11.æ¶ˆè´¹è€…åˆ†ç±»(5.xæ–‡æ¡£)\n12.æ¶ˆæ¯è¿‡æ»¤(5.xæ–‡æ¡£)\n13.æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡(5.xæ–‡æ¡£)\n14.æ¶ˆè´¹é‡è¯•(5.xæ–‡æ¡£)\n15.æ¶ˆæ¯å­˜å‚¨å’Œæ¸…ç†æœºåˆ¶(5.xæ–‡æ¡£)\n\n### [Dubbo](/tags/Dubbo/)\n1.Dubbo SPI\n2.æœåŠ¡è·¯ç”±\n3.SPI è‡ªé€‚åº”æ‹“å±•\n4.æœåŠ¡å¯¼å‡º\n5.æœåŠ¡å¼•ç”¨\n6.æœåŠ¡è°ƒç”¨è¿‡ç¨‹\n7.æœåŠ¡ç›®å½•\n8.é›†ç¾¤\n9.è´Ÿè½½å‡è¡¡\n\n### [Seate](/tags/Seate/)\n1.å„äº‹åŠ¡æ¨¡å¼\n- ATæ¨¡å¼\n- TCCæ¨¡å¼\n- SAGAæ¨¡å¼\n- XAæ¨¡å¼\n2.äº‹åŠ¡åˆ†ç»„\n3.é¢†åŸŸæ¨¡å‹\n\n\n### other\n1.è¥å…»å¸ˆ\n- å…¬å…±è¥å…»å¸ˆ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œåœ¨èƒ½è€ƒèŒƒå›´å†…å«é‡‘é‡æœ€å¤§ï¼‰\n    å°±ä¸šï¼šå¥åº·å’¨è¯¢ã€é¤é¥®ç®¡ç†ã€åŸºç¡€è¥å…»æŒ‡å¯¼\n    å¿…é¡»é€šè¿‡ä¸­å›½è¥å…»å­¦ä¼šæˆæƒæœºæ„æŠ¥åï¼ˆå¦‚ä¼˜è·¯æ•™è‚²ã€å­¦æ…§ç½‘ï¼‰ã€‚\n    è´¹ç”¨ï¼šåŸ¹è®­è´¹çº¦2000-4000å…ƒï¼Œè€ƒè¯•è´¹300-380å…ƒã€‚\n    é‡ç‚¹ç§‘ç›®â€‹â€‹ï¼šè¥å…»å­¦åŸºç¡€ã€è†³é£Ÿè®¾è®¡ï¼ˆå¦‚ç³–å°¿ç—…é£Ÿè°±ï¼‰ã€é£Ÿå“å®‰å…¨ã€‚\n    èµ„æºâ€‹â€‹ï¼šç”¨æœºæ„æä¾›çš„é¢˜åº“å¼ºåŒ–å®æ“æ¡ˆä¾‹ï¼ˆå¦‚å¥åº·è¯„ä¼°ã€é£Ÿè°±è®¾è®¡ï¼‰\n- æ³¨å†Œè¥å…»æŠ€å¸ˆ ï¼ˆéœ€è¦ä¸€å¹´ä»ä¸šç»éªŒï¼‰\n    å°±ä¸šï¼šå¥åº·ç®¡ç†æœºæ„ã€é£Ÿå“ä¼ä¸šã€ç¤¾åŒºæœåŠ¡\n- æ³¨å†Œè¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€é«˜ï¼Œéœ€è¦äº”å¹´ä»ä¸šç»éªŒï¼‰\n    å°±ä¸šï¼šåŒ»é™¢ã€ç§‘ç ”æœºæ„ã€é«˜ç«¯å¥åº·ç®¡ç†\n- å›½é™…æ³¨å†Œè¥å…»å¸ˆï¼ˆå›½å†…ä¸è®¤å¯ï¼Œå¤šä¸ºåŒ…è£…ï¼Œå«é‡‘é‡ä½ï¼‰\n    æ— å›½å†…å®˜æ–¹è®¤å¯\n- å¥åº·è¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€ä½ï¼Œæ°´åˆ†æœ€å¤§ï¼Œä¸è€ƒè™‘ï¼‰\n\n2.å¥èº« ï¼ˆç­‰å‡è‚¥å‡çš„å·®ä¸å¤šäº†å†æ‰¾ç§æ•™orä¸€æ¶µäº†è§£ï¼‰\n- â€‹â€‹CBBAä¸­å›½å¥ç¾åä¼šè¯ä¹¦â€‹\n    å¥ç¾æ¯”èµ›æŒ‡å¯¼/å…¼èŒæ•™ç»ƒ\n- å¥èº«æ•™ç»ƒèŒä¸šèƒ½åŠ›åŸ¹è®­è¯ä¹¦ï¼ˆæ–°å›½èŒï¼‰â€‹\n    å›½å†…å¥èº«æˆ¿å…¥èŒé—¨æ§›\n    é›¶åŸºç¡€å¯è€ƒï¼Œå›½å†…å°±ä¸šå¿…å¤‡ï¼Œå‰3ä¸ªæœˆå¼ºåŒ–è®­ç»ƒï¼ˆç”·ï¼š40ä¿¯å§æ’‘/60æ·±è¹²ï¼›å¥³ï¼š15ä¿¯å§æ’‘/40æ·±è¹²ï¼‰\n- â€‹â€‹NSCA-CPT\n    é«˜ç«¯å¥èº«æˆ¿/ç«æŠ€ä½“è‚²æ–¹å‘\n- â€‹â€‹ACE-CPT\n    å›½é™…è¿é”å¥èº«æˆ¿/ç§æ•™å·¥ä½œå®¤\n- NASMçŸ«æ­£è®­ç»ƒè®¤è¯\n    åº·å¤æ–¹å‘æº¢ä»·é«˜","source":"_posts/todo-list.md","raw":"---\ntitle: todo-list\ndate: 2025-09-19 11:35:38\ntags: [study]\ncategories: [æŠ€æœ¯åˆ†äº«, å­¦ä¹ ç›®å½•]\n---\n\n### [RocketMQ](/tags/RocketMQ/)\n1.æ™®é€šæ¶ˆæ¯\n2.å®šæ—¶/å»¶è¿Ÿæ¶ˆæ¯\n3.é¡ºåºæ¶ˆæ¯\n4.äº‹åŠ¡æ¶ˆæ¯\n5.æ‰¹é‡æ¶ˆæ¯\n6.pushæ¶ˆè´¹\n7.pullæ¶ˆè´¹\n8.mqtt\n9.stream\n10.æ¶ˆæ¯é‡è¯•å’Œæµæ§åˆ¶(5.xæ–‡æ¡£)\n11.æ¶ˆè´¹è€…åˆ†ç±»(5.xæ–‡æ¡£)\n12.æ¶ˆæ¯è¿‡æ»¤(5.xæ–‡æ¡£)\n13.æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡(5.xæ–‡æ¡£)\n14.æ¶ˆè´¹é‡è¯•(5.xæ–‡æ¡£)\n15.æ¶ˆæ¯å­˜å‚¨å’Œæ¸…ç†æœºåˆ¶(5.xæ–‡æ¡£)\n\n### [Dubbo](/tags/Dubbo/)\n1.Dubbo SPI\n2.æœåŠ¡è·¯ç”±\n3.SPI è‡ªé€‚åº”æ‹“å±•\n4.æœåŠ¡å¯¼å‡º\n5.æœåŠ¡å¼•ç”¨\n6.æœåŠ¡è°ƒç”¨è¿‡ç¨‹\n7.æœåŠ¡ç›®å½•\n8.é›†ç¾¤\n9.è´Ÿè½½å‡è¡¡\n\n### [Seate](/tags/Seate/)\n1.å„äº‹åŠ¡æ¨¡å¼\n- ATæ¨¡å¼\n- TCCæ¨¡å¼\n- SAGAæ¨¡å¼\n- XAæ¨¡å¼\n2.äº‹åŠ¡åˆ†ç»„\n3.é¢†åŸŸæ¨¡å‹\n\n\n### other\n1.è¥å…»å¸ˆ\n- å…¬å…±è¥å…»å¸ˆ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œåœ¨èƒ½è€ƒèŒƒå›´å†…å«é‡‘é‡æœ€å¤§ï¼‰\n    å°±ä¸šï¼šå¥åº·å’¨è¯¢ã€é¤é¥®ç®¡ç†ã€åŸºç¡€è¥å…»æŒ‡å¯¼\n    å¿…é¡»é€šè¿‡ä¸­å›½è¥å…»å­¦ä¼šæˆæƒæœºæ„æŠ¥åï¼ˆå¦‚ä¼˜è·¯æ•™è‚²ã€å­¦æ…§ç½‘ï¼‰ã€‚\n    è´¹ç”¨ï¼šåŸ¹è®­è´¹çº¦2000-4000å…ƒï¼Œè€ƒè¯•è´¹300-380å…ƒã€‚\n    é‡ç‚¹ç§‘ç›®â€‹â€‹ï¼šè¥å…»å­¦åŸºç¡€ã€è†³é£Ÿè®¾è®¡ï¼ˆå¦‚ç³–å°¿ç—…é£Ÿè°±ï¼‰ã€é£Ÿå“å®‰å…¨ã€‚\n    èµ„æºâ€‹â€‹ï¼šç”¨æœºæ„æä¾›çš„é¢˜åº“å¼ºåŒ–å®æ“æ¡ˆä¾‹ï¼ˆå¦‚å¥åº·è¯„ä¼°ã€é£Ÿè°±è®¾è®¡ï¼‰\n- æ³¨å†Œè¥å…»æŠ€å¸ˆ ï¼ˆéœ€è¦ä¸€å¹´ä»ä¸šç»éªŒï¼‰\n    å°±ä¸šï¼šå¥åº·ç®¡ç†æœºæ„ã€é£Ÿå“ä¼ä¸šã€ç¤¾åŒºæœåŠ¡\n- æ³¨å†Œè¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€é«˜ï¼Œéœ€è¦äº”å¹´ä»ä¸šç»éªŒï¼‰\n    å°±ä¸šï¼šåŒ»é™¢ã€ç§‘ç ”æœºæ„ã€é«˜ç«¯å¥åº·ç®¡ç†\n- å›½é™…æ³¨å†Œè¥å…»å¸ˆï¼ˆå›½å†…ä¸è®¤å¯ï¼Œå¤šä¸ºåŒ…è£…ï¼Œå«é‡‘é‡ä½ï¼‰\n    æ— å›½å†…å®˜æ–¹è®¤å¯\n- å¥åº·è¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€ä½ï¼Œæ°´åˆ†æœ€å¤§ï¼Œä¸è€ƒè™‘ï¼‰\n\n2.å¥èº« ï¼ˆç­‰å‡è‚¥å‡çš„å·®ä¸å¤šäº†å†æ‰¾ç§æ•™orä¸€æ¶µäº†è§£ï¼‰\n- â€‹â€‹CBBAä¸­å›½å¥ç¾åä¼šè¯ä¹¦â€‹\n    å¥ç¾æ¯”èµ›æŒ‡å¯¼/å…¼èŒæ•™ç»ƒ\n- å¥èº«æ•™ç»ƒèŒä¸šèƒ½åŠ›åŸ¹è®­è¯ä¹¦ï¼ˆæ–°å›½èŒï¼‰â€‹\n    å›½å†…å¥èº«æˆ¿å…¥èŒé—¨æ§›\n    é›¶åŸºç¡€å¯è€ƒï¼Œå›½å†…å°±ä¸šå¿…å¤‡ï¼Œå‰3ä¸ªæœˆå¼ºåŒ–è®­ç»ƒï¼ˆç”·ï¼š40ä¿¯å§æ’‘/60æ·±è¹²ï¼›å¥³ï¼š15ä¿¯å§æ’‘/40æ·±è¹²ï¼‰\n- â€‹â€‹NSCA-CPT\n    é«˜ç«¯å¥èº«æˆ¿/ç«æŠ€ä½“è‚²æ–¹å‘\n- â€‹â€‹ACE-CPT\n    å›½é™…è¿é”å¥èº«æˆ¿/ç§æ•™å·¥ä½œå®¤\n- NASMçŸ«æ­£è®­ç»ƒè®¤è¯\n    åº·å¤æ–¹å‘æº¢ä»·é«˜","slug":"todo-list","published":1,"updated":"2025-09-25T05:48:29.512Z","_id":"cmfxl35cu0001mwu79ia69gpd","comments":1,"layout":"post","photos":[],"content":"<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a><a href=\"/tags/RocketMQ/\">RocketMQ</a></h3><p>1.æ™®é€šæ¶ˆæ¯<br>2.å®šæ—¶&#x2F;å»¶è¿Ÿæ¶ˆæ¯<br>3.é¡ºåºæ¶ˆæ¯<br>4.äº‹åŠ¡æ¶ˆæ¯<br>5.æ‰¹é‡æ¶ˆæ¯<br>6.pushæ¶ˆè´¹<br>7.pullæ¶ˆè´¹<br>8.mqtt<br>9.stream<br>10.æ¶ˆæ¯é‡è¯•å’Œæµæ§åˆ¶(5.xæ–‡æ¡£)<br>11.æ¶ˆè´¹è€…åˆ†ç±»(5.xæ–‡æ¡£)<br>12.æ¶ˆæ¯è¿‡æ»¤(5.xæ–‡æ¡£)<br>13.æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡(5.xæ–‡æ¡£)<br>14.æ¶ˆè´¹é‡è¯•(5.xæ–‡æ¡£)<br>15.æ¶ˆæ¯å­˜å‚¨å’Œæ¸…ç†æœºåˆ¶(5.xæ–‡æ¡£)</p>\n<h3 id=\"Dubbo\"><a href=\"#Dubbo\" class=\"headerlink\" title=\"Dubbo\"></a><a href=\"/tags/Dubbo/\">Dubbo</a></h3><p>1.Dubbo SPI<br>2.æœåŠ¡è·¯ç”±<br>3.SPI è‡ªé€‚åº”æ‹“å±•<br>4.æœåŠ¡å¯¼å‡º<br>5.æœåŠ¡å¼•ç”¨<br>6.æœåŠ¡è°ƒç”¨è¿‡ç¨‹<br>7.æœåŠ¡ç›®å½•<br>8.é›†ç¾¤<br>9.è´Ÿè½½å‡è¡¡</p>\n<h3 id=\"Seate\"><a href=\"#Seate\" class=\"headerlink\" title=\"Seate\"></a><a href=\"/tags/Seate/\">Seate</a></h3><p>1.å„äº‹åŠ¡æ¨¡å¼</p>\n<ul>\n<li>ATæ¨¡å¼</li>\n<li>TCCæ¨¡å¼</li>\n<li>SAGAæ¨¡å¼</li>\n<li>XAæ¨¡å¼<br>2.äº‹åŠ¡åˆ†ç»„<br>3.é¢†åŸŸæ¨¡å‹</li>\n</ul>\n<h3 id=\"other\"><a href=\"#other\" class=\"headerlink\" title=\"other\"></a>other</h3><p>1.è¥å…»å¸ˆ</p>\n<ul>\n<li>å…¬å…±è¥å…»å¸ˆ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œåœ¨èƒ½è€ƒèŒƒå›´å†…å«é‡‘é‡æœ€å¤§ï¼‰<br>  å°±ä¸šï¼šå¥åº·å’¨è¯¢ã€é¤é¥®ç®¡ç†ã€åŸºç¡€è¥å…»æŒ‡å¯¼<br>  å¿…é¡»é€šè¿‡ä¸­å›½è¥å…»å­¦ä¼šæˆæƒæœºæ„æŠ¥åï¼ˆå¦‚ä¼˜è·¯æ•™è‚²ã€å­¦æ…§ç½‘ï¼‰ã€‚<br>  è´¹ç”¨ï¼šåŸ¹è®­è´¹çº¦2000-4000å…ƒï¼Œè€ƒè¯•è´¹300-380å…ƒã€‚<br>  é‡ç‚¹ç§‘ç›®â€‹â€‹ï¼šè¥å…»å­¦åŸºç¡€ã€è†³é£Ÿè®¾è®¡ï¼ˆå¦‚ç³–å°¿ç—…é£Ÿè°±ï¼‰ã€é£Ÿå“å®‰å…¨ã€‚<br>  èµ„æºâ€‹â€‹ï¼šç”¨æœºæ„æä¾›çš„é¢˜åº“å¼ºåŒ–å®æ“æ¡ˆä¾‹ï¼ˆå¦‚å¥åº·è¯„ä¼°ã€é£Ÿè°±è®¾è®¡ï¼‰</li>\n<li>æ³¨å†Œè¥å…»æŠ€å¸ˆ ï¼ˆéœ€è¦ä¸€å¹´ä»ä¸šç»éªŒï¼‰<br>  å°±ä¸šï¼šå¥åº·ç®¡ç†æœºæ„ã€é£Ÿå“ä¼ä¸šã€ç¤¾åŒºæœåŠ¡</li>\n<li>æ³¨å†Œè¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€é«˜ï¼Œéœ€è¦äº”å¹´ä»ä¸šç»éªŒï¼‰<br>  å°±ä¸šï¼šåŒ»é™¢ã€ç§‘ç ”æœºæ„ã€é«˜ç«¯å¥åº·ç®¡ç†</li>\n<li>å›½é™…æ³¨å†Œè¥å…»å¸ˆï¼ˆå›½å†…ä¸è®¤å¯ï¼Œå¤šä¸ºåŒ…è£…ï¼Œå«é‡‘é‡ä½ï¼‰<br>  æ— å›½å†…å®˜æ–¹è®¤å¯</li>\n<li>å¥åº·è¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€ä½ï¼Œæ°´åˆ†æœ€å¤§ï¼Œä¸è€ƒè™‘ï¼‰</li>\n</ul>\n<p>2.å¥èº« ï¼ˆç­‰å‡è‚¥å‡çš„å·®ä¸å¤šäº†å†æ‰¾ç§æ•™orä¸€æ¶µäº†è§£ï¼‰</p>\n<ul>\n<li>â€‹â€‹CBBAä¸­å›½å¥ç¾åä¼šè¯ä¹¦â€‹<br>  å¥ç¾æ¯”èµ›æŒ‡å¯¼&#x2F;å…¼èŒæ•™ç»ƒ</li>\n<li>å¥èº«æ•™ç»ƒèŒä¸šèƒ½åŠ›åŸ¹è®­è¯ä¹¦ï¼ˆæ–°å›½èŒï¼‰â€‹<br>  å›½å†…å¥èº«æˆ¿å…¥èŒé—¨æ§›<br>  é›¶åŸºç¡€å¯è€ƒï¼Œå›½å†…å°±ä¸šå¿…å¤‡ï¼Œå‰3ä¸ªæœˆå¼ºåŒ–è®­ç»ƒï¼ˆç”·ï¼š40ä¿¯å§æ’‘&#x2F;60æ·±è¹²ï¼›å¥³ï¼š15ä¿¯å§æ’‘&#x2F;40æ·±è¹²ï¼‰</li>\n<li>â€‹â€‹NSCA-CPT<br>  é«˜ç«¯å¥èº«æˆ¿&#x2F;ç«æŠ€ä½“è‚²æ–¹å‘</li>\n<li>â€‹â€‹ACE-CPT<br>  å›½é™…è¿é”å¥èº«æˆ¿&#x2F;ç§æ•™å·¥ä½œå®¤</li>\n<li>NASMçŸ«æ­£è®­ç»ƒè®¤è¯<br>  åº·å¤æ–¹å‘æº¢ä»·é«˜</li>\n</ul>\n","excerpt":"","more":"<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a><a href=\"/tags/RocketMQ/\">RocketMQ</a></h3><p>1.æ™®é€šæ¶ˆæ¯<br>2.å®šæ—¶&#x2F;å»¶è¿Ÿæ¶ˆæ¯<br>3.é¡ºåºæ¶ˆæ¯<br>4.äº‹åŠ¡æ¶ˆæ¯<br>5.æ‰¹é‡æ¶ˆæ¯<br>6.pushæ¶ˆè´¹<br>7.pullæ¶ˆè´¹<br>8.mqtt<br>9.stream<br>10.æ¶ˆæ¯é‡è¯•å’Œæµæ§åˆ¶(5.xæ–‡æ¡£)<br>11.æ¶ˆè´¹è€…åˆ†ç±»(5.xæ–‡æ¡£)<br>12.æ¶ˆæ¯è¿‡æ»¤(5.xæ–‡æ¡£)<br>13.æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡(5.xæ–‡æ¡£)<br>14.æ¶ˆè´¹é‡è¯•(5.xæ–‡æ¡£)<br>15.æ¶ˆæ¯å­˜å‚¨å’Œæ¸…ç†æœºåˆ¶(5.xæ–‡æ¡£)</p>\n<h3 id=\"Dubbo\"><a href=\"#Dubbo\" class=\"headerlink\" title=\"Dubbo\"></a><a href=\"/tags/Dubbo/\">Dubbo</a></h3><p>1.Dubbo SPI<br>2.æœåŠ¡è·¯ç”±<br>3.SPI è‡ªé€‚åº”æ‹“å±•<br>4.æœåŠ¡å¯¼å‡º<br>5.æœåŠ¡å¼•ç”¨<br>6.æœåŠ¡è°ƒç”¨è¿‡ç¨‹<br>7.æœåŠ¡ç›®å½•<br>8.é›†ç¾¤<br>9.è´Ÿè½½å‡è¡¡</p>\n<h3 id=\"Seate\"><a href=\"#Seate\" class=\"headerlink\" title=\"Seate\"></a><a href=\"/tags/Seate/\">Seate</a></h3><p>1.å„äº‹åŠ¡æ¨¡å¼</p>\n<ul>\n<li>ATæ¨¡å¼</li>\n<li>TCCæ¨¡å¼</li>\n<li>SAGAæ¨¡å¼</li>\n<li>XAæ¨¡å¼<br>2.äº‹åŠ¡åˆ†ç»„<br>3.é¢†åŸŸæ¨¡å‹</li>\n</ul>\n<h3 id=\"other\"><a href=\"#other\" class=\"headerlink\" title=\"other\"></a>other</h3><p>1.è¥å…»å¸ˆ</p>\n<ul>\n<li>å…¬å…±è¥å…»å¸ˆ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œåœ¨èƒ½è€ƒèŒƒå›´å†…å«é‡‘é‡æœ€å¤§ï¼‰<br>  å°±ä¸šï¼šå¥åº·å’¨è¯¢ã€é¤é¥®ç®¡ç†ã€åŸºç¡€è¥å…»æŒ‡å¯¼<br>  å¿…é¡»é€šè¿‡ä¸­å›½è¥å…»å­¦ä¼šæˆæƒæœºæ„æŠ¥åï¼ˆå¦‚ä¼˜è·¯æ•™è‚²ã€å­¦æ…§ç½‘ï¼‰ã€‚<br>  è´¹ç”¨ï¼šåŸ¹è®­è´¹çº¦2000-4000å…ƒï¼Œè€ƒè¯•è´¹300-380å…ƒã€‚<br>  é‡ç‚¹ç§‘ç›®â€‹â€‹ï¼šè¥å…»å­¦åŸºç¡€ã€è†³é£Ÿè®¾è®¡ï¼ˆå¦‚ç³–å°¿ç—…é£Ÿè°±ï¼‰ã€é£Ÿå“å®‰å…¨ã€‚<br>  èµ„æºâ€‹â€‹ï¼šç”¨æœºæ„æä¾›çš„é¢˜åº“å¼ºåŒ–å®æ“æ¡ˆä¾‹ï¼ˆå¦‚å¥åº·è¯„ä¼°ã€é£Ÿè°±è®¾è®¡ï¼‰</li>\n<li>æ³¨å†Œè¥å…»æŠ€å¸ˆ ï¼ˆéœ€è¦ä¸€å¹´ä»ä¸šç»éªŒï¼‰<br>  å°±ä¸šï¼šå¥åº·ç®¡ç†æœºæ„ã€é£Ÿå“ä¼ä¸šã€ç¤¾åŒºæœåŠ¡</li>\n<li>æ³¨å†Œè¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€é«˜ï¼Œéœ€è¦äº”å¹´ä»ä¸šç»éªŒï¼‰<br>  å°±ä¸šï¼šåŒ»é™¢ã€ç§‘ç ”æœºæ„ã€é«˜ç«¯å¥åº·ç®¡ç†</li>\n<li>å›½é™…æ³¨å†Œè¥å…»å¸ˆï¼ˆå›½å†…ä¸è®¤å¯ï¼Œå¤šä¸ºåŒ…è£…ï¼Œå«é‡‘é‡ä½ï¼‰<br>  æ— å›½å†…å®˜æ–¹è®¤å¯</li>\n<li>å¥åº·è¥å…»å¸ˆ ï¼ˆå«é‡‘é‡æœ€ä½ï¼Œæ°´åˆ†æœ€å¤§ï¼Œä¸è€ƒè™‘ï¼‰</li>\n</ul>\n<p>2.å¥èº« ï¼ˆç­‰å‡è‚¥å‡çš„å·®ä¸å¤šäº†å†æ‰¾ç§æ•™orä¸€æ¶µäº†è§£ï¼‰</p>\n<ul>\n<li>â€‹â€‹CBBAä¸­å›½å¥ç¾åä¼šè¯ä¹¦â€‹<br>  å¥ç¾æ¯”èµ›æŒ‡å¯¼&#x2F;å…¼èŒæ•™ç»ƒ</li>\n<li>å¥èº«æ•™ç»ƒèŒä¸šèƒ½åŠ›åŸ¹è®­è¯ä¹¦ï¼ˆæ–°å›½èŒï¼‰â€‹<br>  å›½å†…å¥èº«æˆ¿å…¥èŒé—¨æ§›<br>  é›¶åŸºç¡€å¯è€ƒï¼Œå›½å†…å°±ä¸šå¿…å¤‡ï¼Œå‰3ä¸ªæœˆå¼ºåŒ–è®­ç»ƒï¼ˆç”·ï¼š40ä¿¯å§æ’‘&#x2F;60æ·±è¹²ï¼›å¥³ï¼š15ä¿¯å§æ’‘&#x2F;40æ·±è¹²ï¼‰</li>\n<li>â€‹â€‹NSCA-CPT<br>  é«˜ç«¯å¥èº«æˆ¿&#x2F;ç«æŠ€ä½“è‚²æ–¹å‘</li>\n<li>â€‹â€‹ACE-CPT<br>  å›½é™…è¿é”å¥èº«æˆ¿&#x2F;ç§æ•™å·¥ä½œå®¤</li>\n<li>NASMçŸ«æ­£è®­ç»ƒè®¤è¯<br>  åº·å¤æ–¹å‘æº¢ä»·é«˜</li>\n</ul>\n"},{"title":"è¥å…»å­¦è¯•å¬è¯¾-1","date":"2025-09-25T06:38:34.000Z","_content":"[è¯•å¬](https://www.youlu.com/ggyys/audition/COLUMN20231213000000000002)\n### æœ¬ç« é‡éš¾ç‚¹åˆ†æ\n1. æŒæ¡è¥å…»åŠè¥å…»ç´ çš„æ¦‚å¿µåŠè¥å…»ç´ çš„åˆ†ç±»\n2. æŒæ¡è†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡çš„åº”ç”¨\n3. æŒæ¡èƒ½é‡çš„æ¢ç®—ã€èƒ½é‡ç³»æ•°ã€ä»¥åŠèƒ½é‡çš„æ¶ˆè€—\n4. æŒæ¡ä¸‰å¤§å®é‡è¥å…»ç´ çš„ç»„æˆã€åˆ†ç±»ã€åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€è†³é£Ÿæ¥æºï¼Œç¼ºä¹æˆ–è¿‡é‡å¯¹æœºä½“çš„å½±å“\n5. æŒæ¡çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ çš„åˆ†ç±»ã€ç”Ÿç†åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€æ¥æºã€ç¼ºä¹æˆ–è¿‡é‡çš„ä¸è‰¯å½±å“\n6. æŒæ¡æ°´ã€è†³é£Ÿçº¤ç»´çš„ä¸»è¦ç”Ÿç†åŠŸèƒ½\n\n\n\n### åŸºç¡€æ¦‚å¿µ\n**1. è¥å…»ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;äººä½“ä»å¤–ç¯å¢ƒæ‘„å–é£Ÿç‰©ï¼Œç»è¿‡æ¶ˆåŒ–ã€å¸æ”¶å’Œä»£è°¢ï¼Œåˆ©ç”¨é£Ÿç‰©ä¸­çš„è¥å…»ç´ å’Œå…¶æœ‰ç›Šç‰©è´¨ï¼Œä¾›ç»™èƒ½é‡ï¼Œæ„æˆå’Œæ›´æ–°ç»„ç»‡ï¼Œä»¥è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚\n**2. è¥å…»ç´ ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;é£Ÿç‰©ä¸­å…·æœ‰ç‰¹å®šç”Ÿç†ä½œç”¨ï¼Œèƒ½ç»´æŒæœºä½“ç”Ÿé•¿ã€å‘è‚²ã€æ´»åŠ¨ã€ç”Ÿæ®–ä»¥åŠæ­£å¸¸ä»£è°¢æ‰€éœ€çš„ç‰©è´¨ï¼ŒåŒ…æ‹¬è›‹ç™½è´¨ã€è„‚ç±»ã€ç¢³æ°´åŒ–åˆç‰©ã€çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ ç­‰ã€‚ä¸èƒ½åœ¨ä½“å†…åˆæˆï¼Œå¿…é¡»ä»é£Ÿç‰©ä¸­è·å–ï¼Œç§°ä¸ºâ€œå¿…éœ€è¥å…»ç´ â€ã€‚\n**3. ä¸ƒå¤§å¿…é¡»è¥å…»ç´ ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;æ°´ã€è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ã€è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆæ¤ç‰©åŒ–åˆç‰© å¯ä»¥æ²¡æœ‰ï¼Œæœ‰æ›´å¥½ï¼šèŒ¶å¤šé…šã€èŠ±é’ç´ ã€èƒ¡èåœç´ ã€ç•ªèŒ„çº¢ç´ ã€çš‚è‹·ã€å¤§è’œç´ ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ï¼ˆè„‚è‚ªå’Œç±»è„‚ï¼Œä¸»è¦è¯´è„‚è‚ªï¼‰æ˜¯ä¸»è¦èƒ½é‡æä¾›è€…ï¼Œæ‘„å–é‡æ¯”è¾ƒå¤šï¼Œä¹Ÿå« __å®é‡è¥å…»ç´ __ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨æ˜¯ __å¾®é‡è¥å…»ç´ __ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ä¹Ÿæ˜¯ç¢³æ°´åŒ–åˆç‰©ï¼Œåªæ˜¯å¾ˆéš¾è¢«äººä½“æ‰€å¸æ”¶ï¼Œå¯ä»¥åœ¨è‚ é“ä¸­è¢«èŒç±»é…µè§£å‘æŒ¥ç‰¹æ®Šä½œç”¨ã€‚\n**4. è¥å…»ç´ åˆ†ç±»**\n|  æ°¨åŸºé…¸  |  è„‚è‚ªé…¸  | ç¢³æ°´åŒ–åˆç‰© | å¸¸é‡å…ƒç´  |  å¾®é‡å…ƒç´   |  ç»´ç”Ÿç´   |  æ°´  |\n|---------|----------|-----------|---------|-----------|---------|---------|\n| å¼‚äº®æ°¨é…¸ |  äºšæ²¹é…¸  | ç¢³æ°´åŒ–åˆç‰© |    é’¾    |    ç¢˜    | ç»´ç”Ÿç´ A |    æ°´    |\n|  äº®æ°¨é…¸  | Î±-äºšéº»é…¸ |           |    é’     |    ç¡’     | ç»´ç”Ÿç´ D |\n|  èµ–æ°¨é…¸  |         |           |    é’™    |     é“œ    | ç»´ç”Ÿç´ E |\n|  è›‹æ°¨é…¸  |         |           |    é•    |     é’¼    | ç»´ç”Ÿç´ K |\n|  è‹¯ä¸™æ°¨é…¸  |         |           |    ç¡«    |    é“¬     | ç»´ç”Ÿç´ B1 |\n|  è‹æ°¨é…¸  |         |           |    ç£·    |     é’´    | ç»´ç”Ÿç´ B2 |\n|  è‰²æ°¨é…¸  |         |           |    æ°¯    |     é“    | çƒŸé…¸ |\n|  ç¼¬æ°¨é…¸  |         |           |          |     é”Œ    | ç»´ç”Ÿç´ B6 |\n|  ç»„æ°¨é…¸   |         |           |          |          | å¶é…¸ |\n|          |         |           |          |          | ç»´ç”Ÿç´ B12 |\n|          |         |           |          |          | æ³›é…¸ |\n|          |         |           |          |          | ç”Ÿç‰©ç´  |\n|          |         |           |          |          | èƒ†ç¢± |\n|          |         |           |          |          | ç»´ç”Ÿç´ C |\n\n&nbsp;&nbsp;&nbsp;&nbsp;æ°¨åŸºé…¸(9)ï¼Œè„‚è‚ªé…¸(2)ï¼Œå¸¸é‡å…ƒç´ (7)ï¼Œå¾®é‡å…ƒç´ (8)ï¼Œç»´ç”Ÿç´ (14)ï¼Œå…¶ä¸­**ç»„æ°¨é…¸**æ˜¯é’ˆå¯¹å©´å¹¼å„¿çš„\n\n#### è¥å…»åˆ†ç±»\n- å®é‡è¥å…»ç´ \n    - ä¸‰å¤§äº§èƒ½è¥å…»ç´ \n        - è›‹ç™½è´¨\n        - è„‚ç±»\n        - ç¢³æ°´åŒ–åˆç‰©\n- å¾®é‡è¥å…»ç´ \n    - ç»´ç”Ÿç´ \n        - æ°´æº¶æ€§ç»´ç”Ÿç´ \n            - Bæ—ç»´ç”Ÿç´ \n            - ç»´ç”Ÿç´ C\n        - è„‚æº¶æ€§ç»´ç”Ÿç´ \n            - ç»´ç”Ÿç´ A\n            - ç»´ç”Ÿç´ D\n            - ç»´ç”Ÿç´ E\n            - ç»´ç”Ÿç´ K\n    - çŸ¿ç‰©è´¨\n        - å¸¸é‡å…ƒç´ ï¼ˆå¤§äºä½“é‡0.01%çš„å…ƒç´ ï¼‰\n            - é’™\n            - é•\n            - é’ \n            - é’¾\n            - ç£·\n            - æ°¯\n            - ç¡«\n        - å¾®é‡å…ƒç´ \n            - é“\n            - ç¢˜\n            - é”Œ\n            - ç¡’\n            - é“œ\n            - é’¼\n            - é“¬\n            - é’´\n\n**5.è¥å…»å­¦**\n&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦æ˜¯ç ”ç©¶äººä½“è¥å…»ä¸å¥åº·å…³ç³»çš„ç§‘å­¦ï¼Œç ”ç©¶å†…å®¹åŒ…æ‹¬ï¼š\n1. è¥å…»ç´ åœ¨äººä½“ä¸­æ¶ˆåŒ–/å¸æ”¶/ä»£è°¢è¿‡ç¨‹åŠå¯¹äººä½“å¥åº·çš„ä½œç”¨\n2. è¥å…»ç´ ä¹‹é—´çš„ç›¸äº’ä½œç”¨å’Œå¹³è¡¡\n3. è¥å…»ç´ éœ€è¦é‡å’Œè†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡ï¼ˆDRIsï¼‰\n4. è¥å…»ç´ ç¼ºä¹ç—…å’Œè¥å…»ç›¸å…³æ…¢æ€§ç—…çš„é¢„é˜²å’Œè¥å…»æ²»ç–—\n5. ç‰¹æ®Šäººç¾¤å’Œç‰¹æ®Šç¯å¢ƒä¸‹çš„è¥å…»\n6. é£Ÿç‰©çš„è¥å…»ä»·å€¼\n7. è¥å…»ç´ ä¿å­˜å’Œè¥å…»ç´ å¼ºåŒ–\n8. æ¤ç‰©åŒ–å­¦ç‰©ä¸ä¿å¥é£Ÿå“\n9. ç¤¾åŒºè¥å…»ç®¡ç†å’Œè¥å…»æ•™è‚²\n10. é£Ÿç‰©è¥å…»æ”¿ç­–å’Œè¥å…»æ³•è§„\n&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦å±äºè‡ªç„¶ç§‘å­¦èŒƒç•´ï¼Œæ˜¯é¢„é˜²åŒ»å­¦çš„ç»„æˆéƒ¨åˆ†å…·æœ‰å¾ˆå¼ºçš„å®è·µæ€§ã€‚\n\n**DRIsï¼šä¸ºäº†ä¿è¯äººä½“åˆç†æ‘„å…¥è¥å…»ç´ ï¼Œé¿å…ç¼ºä¹å’Œè¿‡é‡çš„ä¸€ç»„æ¯æ—¥å¹³å‡è†³é£Ÿè¥å…»ç´ æ‘„å…¥é‡çš„å‚è€ƒå€¼ï¼ŒåŒ…æ‹¬ï¼š**\n- å¹³å‡éœ€è¦é‡ï¼ˆEAR, estimated average requirementï¼‰\n  - æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µç¾¤ä½“ä¸­çš„æ‰€æœ‰ä¸ªä½“å¯¹æŸè¥å…»ç´ éœ€è¦é‡çš„å¹³å‡æ°´å¹³ã€‚\n  - æ‘„å…¥é‡è¾¾åˆ°EARæ°´å¹³æ—¶å¯æ»¡è¶³ç¾¤ä½“ä¸­50%ä¸ªä½“å¯¹è¯¥è¥å…»ç´ çš„éœ€è¦ã€‚\n  - é’ˆå¯¹äººç¾¤ï¼ŒEARå¯ç”¨äºè¯„ä¼°ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³çš„å‘ç”Ÿç‡ã€‚é’ˆå¯¹ä¸ªä½“ï¼Œå¯ä»¥æ£€æŸ¥å…¶æ‘„å…¥ä¸è¶³çš„å¯èƒ½æ€§ã€‚\n- æ¨èæ‘„å…¥é‡ï¼ˆRNI, recommended nutrition intakeï¼‰\n  - æ»¡è¶³æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µä¸­ç»å¤§å¤šæ•°ï¼ˆçº¦97%-98%ï¼‰ä¸ªä½“éœ€è¦é‡çš„æ‘„å…¥æ°´å¹³ã€‚\n  - ä¸»è¦ç”¨é€”æ˜¯ä½œä¸ºä¸ªä½“æ¯æ—¥æ‘„å…¥è¯¥è¥å…»ç´ çš„ç›®æ ‡å€¼ã€‚\n  - å·²çŸ¥EARåŠå…¶æ ‡å‡†å·®ï¼Œåˆ™RNI = EAR + 2SDï¼ˆSDä¸ºæ ‡å‡†å·®ï¼‰ï¼Œä¸èƒ½è®¡ç®—æ—¶ï¼Œä¸€èˆ¬è®¾EARçš„å˜å¼‚ç³»æ•°ä¸º10%ï¼Œä¹Ÿå°±æ˜¯RNI = 1.2EARã€‚\n- é€‚å®œæ‘„å…¥é‡ï¼ˆAI, adequate intakeï¼‰\n  - ä¸»è¦ç”¨ä½œä¸ªä½“çš„è¥å…»æ‘„å…¥ç›®æ ‡ï¼Œå½“æŸç¾¤ä½“çš„è¥å…»ç´ å¹³å‡æ‘„å…¥é‡è¾¾åˆ°æˆ–è¶…è¿‡AIå€¼ï¼Œåˆ™è¯¥ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³è€…çš„å±é™©æ€§å¾ˆå°ã€‚\n  - æ˜¯é€šè¿‡è§‚å¯Ÿæˆ–å®éªŒè·å¾—çš„å¥åº·äººç¾¤æŸç§è¥å…»ç´ çš„æ‘„å…¥é‡ã€‚\n- å¯è€å—æœ€é«˜æ‘„å…¥é‡ï¼ˆUL, tolerable upper intake levelï¼‰\n  - æ˜¯è¥å…»ç´ æˆ–é£Ÿç‰©æˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡çš„å®‰å…¨ä¸Šé™ã€‚æ˜¯ä¸€ä¸ªå¥åº·äººç¾¤ä¸­å‡ ä¹æ‰€æœ‰ä¸ªä½“éƒ½ä¸ä¼šäº§ç”Ÿæ¯’å‰¯ä½œç”¨çš„æœ€é«˜æ‘„å…¥é‡ã€‚\n  - å¯¹ä¸€èˆ¬ç¾¤ä½“æ¥è¯´ï¼Œæ‘„å…¥é‡è¾¾åˆ°ULæ°´å¹³å¯¹å‡ ä¹æ‰€æœ‰ä¸ªä½“å‡ä¸è‡´æŸå®³å¥åº·ï¼Œä½†å¹¶ä¸è¡¨ç¤ºè¾¾åˆ°æ­¤æ‘„å…¥æ°´å¹³å¯¹å¥åº·æ˜¯æœ‰ç›Šçš„ã€‚\n- å®é‡è¥å…»ç´ å¯æ¥å—èŒƒå›´ï¼ˆAMDR, acceptable macronutrient distribution rangesï¼‰\n  - æ˜¯æŒ‡è„‚è‚ªã€è›‹ç™½è´¨å’Œç¢³æ°´åŒ–åˆç‰©ç†æƒ³çš„æ‘„å…¥é‡çš„èŒƒå›´ã€‚\n  - å¸¸ç”¨å èƒ½é‡æ‘„å…¥é‡çš„ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚\n  - è¯¥èŒƒå›´å¯ä»¥æä¾›è¿™äº›å¿…éœ€è¥å…»ç´ çš„éœ€è¦ï¼Œå¹¶ä¸”æœ‰åˆ©äºé™ä½æ…¢æ€§ç—…å‘ç”Ÿçš„å±é™©ã€‚\n  - è„‚è‚ªçš„æ¨èæ‘„å…¥é‡èŒƒå›´ä¸º20%~35%ï¼Œè›‹ç™½è´¨ä¸º10%~20%ï¼Œç¢³æ°´åŒ–åˆç‰©ä¸º50%~65%ã€‚\n- é¢„é˜²éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„å»ºè®®æ‘„å…¥é‡ï¼ˆPI-NCD, proposed intakes for preventing non-communicable chronic diseases, ç®€ç§°å»ºè®®æ‘„å…¥é‡, PIï¼‰\n  - æ˜¯ä»¥è†³é£Ÿç›¸å…³éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„ä¸€çº§é¢„é˜²ä¸ºç›®æ ‡ï¼Œçªå‡ºçš„å¿…éœ€è¥å…»ç´ çš„æ¯æ—¥æ‘„å…¥é‡ã€‚\n  - å½“NCDæ˜“æ„Ÿäººç¾¤æŸäº›è¥å…»ç´ çš„æ‘„å…¥è¾¾åˆ°PIï¼Œå¯ä»¥é™ä½ä»–ä»¬å‘ç”ŸNCDçš„é£é™©ã€‚\n  - çœŸæ­£åˆ¶å®šå‡ºæ¥æ˜ç¡®çš„åªæœ‰ï¼šé’¾ã€é’ ã€ç»´ç”Ÿç´ cã€‚\n- ç‰¹å®šå»ºè®®å€¼ï¼ˆSPL, specific proposed levelsï¼‰\n  - æ˜¯ä»¥é™ä½æˆå¹´äººè†³é£Ÿç›¸å…³éä¼ æŸ“æ€§ç–¾ç—…ä¸ºç›®æ ‡ï¼Œæå‡ºçš„å…¶ä»–è†³é£Ÿæˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡ï¼ˆæ°´å¹³ï¼‰ã€‚\n  - å½“è¯¥æˆåˆ†çš„æ‘„å…¥é‡è¾¾åˆ°SPLï¼Œå¯èƒ½æœ‰åˆ©äºé™ä½ç–¾ç—…çš„å‘ç”Ÿé£é™©æˆ–æ­»äº¡ç‡ã€‚\n\n#### è¥å…»ä¸å¥åº·çš„å…³ç³»\n**è¥å…»ç´ çš„ç”Ÿç†åŠŸèƒ½**\n- æä¾›èƒ½é‡\n- æ„æˆç»†èƒç»„ç»‡ã€ä¾›ç»™ç”Ÿé•¿ã€å‘è‚²å’Œè‡ªæˆ‘æ›´æ–°æ‰€éœ€çš„ææ–™\n- è°ƒèŠ‚æœºä½“ç”Ÿç†æ´»åŠ¨\n\n**è¥å…»ç´ è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„ä½“ç°**\n- åŠ¨æ€å¹³è¡¡\n  - èƒ½é‡å¹³è¡¡\n  - è¥å…»ç´ å¹³è¡¡\n  - æ°´ç›å¹³è¡¡\n- å†…ç¯å¢ƒçš„ç¨³æ€\n  - ç¥ç»ç³»ç»Ÿè°ƒèŠ‚\n  - é…¶è°ƒèŠ‚\n  - æ¿€ç´ è°ƒèŠ‚\n  \n**è¥å…»æ˜¯ç»´æŒå¥åº·çš„åŸºç¡€**\n- ç»´æŒäººä½“ç»„ç»‡çš„æ„æˆ\n- ç»´æŒç”Ÿç†åŠŸèƒ½\n- ç»´æŒå¿ƒç†å¥åº·\n- é¢„é˜²ç–¾ç—…å‘ç”Ÿ\n\n**è¥å…»å¯¹äººç¾¤å¥åº·çš„è¥å…»**\n- ä¿è¯å„¿ç«¥æ­£å¸¸ç”Ÿé•¿å‘è‚²å’Œå¿ƒç†å‘è‚²\n- æ»¡è¶³å„ç±»ç‰¹æ®Šäººç¾¤çš„è¥å…»éœ€è¦\n- å¢å¼ºç‰¹æ®Šç¯å¢ƒä¸‹äººç¾¤çš„æŠµæŠ—åŠ›ã€è€å—åŠ›ã€é€‚åº”æ€§\n- é¢„é˜²è¥å…»ç´ çš„ç¼ºä¹ä¸è¿‡å¤šåŠç›¸å…³çš„ç–¾ç—…\n- è¾…åŠ©å„ç§ç–¾ç—…çš„æ²»ç–—","source":"_posts/è¥å…»å­¦è¯•å¬è¯¾-1.md","raw":"---\ntitle: è¥å…»å­¦è¯•å¬è¯¾-1\ndate: 2025-09-25 14:38:34\ntags: [è¥å…»å­¦]\ncategories: [è¥å…»å­¦, è¯•å¬ç¬”è®°]\n---\n[è¯•å¬](https://www.youlu.com/ggyys/audition/COLUMN20231213000000000002)\n### æœ¬ç« é‡éš¾ç‚¹åˆ†æ\n1. æŒæ¡è¥å…»åŠè¥å…»ç´ çš„æ¦‚å¿µåŠè¥å…»ç´ çš„åˆ†ç±»\n2. æŒæ¡è†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡çš„åº”ç”¨\n3. æŒæ¡èƒ½é‡çš„æ¢ç®—ã€èƒ½é‡ç³»æ•°ã€ä»¥åŠèƒ½é‡çš„æ¶ˆè€—\n4. æŒæ¡ä¸‰å¤§å®é‡è¥å…»ç´ çš„ç»„æˆã€åˆ†ç±»ã€åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€è†³é£Ÿæ¥æºï¼Œç¼ºä¹æˆ–è¿‡é‡å¯¹æœºä½“çš„å½±å“\n5. æŒæ¡çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ çš„åˆ†ç±»ã€ç”Ÿç†åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€æ¥æºã€ç¼ºä¹æˆ–è¿‡é‡çš„ä¸è‰¯å½±å“\n6. æŒæ¡æ°´ã€è†³é£Ÿçº¤ç»´çš„ä¸»è¦ç”Ÿç†åŠŸèƒ½\n\n\n\n### åŸºç¡€æ¦‚å¿µ\n**1. è¥å…»ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;äººä½“ä»å¤–ç¯å¢ƒæ‘„å–é£Ÿç‰©ï¼Œç»è¿‡æ¶ˆåŒ–ã€å¸æ”¶å’Œä»£è°¢ï¼Œåˆ©ç”¨é£Ÿç‰©ä¸­çš„è¥å…»ç´ å’Œå…¶æœ‰ç›Šç‰©è´¨ï¼Œä¾›ç»™èƒ½é‡ï¼Œæ„æˆå’Œæ›´æ–°ç»„ç»‡ï¼Œä»¥è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚\n**2. è¥å…»ç´ ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;é£Ÿç‰©ä¸­å…·æœ‰ç‰¹å®šç”Ÿç†ä½œç”¨ï¼Œèƒ½ç»´æŒæœºä½“ç”Ÿé•¿ã€å‘è‚²ã€æ´»åŠ¨ã€ç”Ÿæ®–ä»¥åŠæ­£å¸¸ä»£è°¢æ‰€éœ€çš„ç‰©è´¨ï¼ŒåŒ…æ‹¬è›‹ç™½è´¨ã€è„‚ç±»ã€ç¢³æ°´åŒ–åˆç‰©ã€çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ ç­‰ã€‚ä¸èƒ½åœ¨ä½“å†…åˆæˆï¼Œå¿…é¡»ä»é£Ÿç‰©ä¸­è·å–ï¼Œç§°ä¸ºâ€œå¿…éœ€è¥å…»ç´ â€ã€‚\n**3. ä¸ƒå¤§å¿…é¡»è¥å…»ç´ ï¼š**\n&nbsp;&nbsp;&nbsp;&nbsp;æ°´ã€è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ã€è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆæ¤ç‰©åŒ–åˆç‰© å¯ä»¥æ²¡æœ‰ï¼Œæœ‰æ›´å¥½ï¼šèŒ¶å¤šé…šã€èŠ±é’ç´ ã€èƒ¡èåœç´ ã€ç•ªèŒ„çº¢ç´ ã€çš‚è‹·ã€å¤§è’œç´ ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ï¼ˆè„‚è‚ªå’Œç±»è„‚ï¼Œä¸»è¦è¯´è„‚è‚ªï¼‰æ˜¯ä¸»è¦èƒ½é‡æä¾›è€…ï¼Œæ‘„å–é‡æ¯”è¾ƒå¤šï¼Œä¹Ÿå« __å®é‡è¥å…»ç´ __ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨æ˜¯ __å¾®é‡è¥å…»ç´ __ã€‚\n&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ä¹Ÿæ˜¯ç¢³æ°´åŒ–åˆç‰©ï¼Œåªæ˜¯å¾ˆéš¾è¢«äººä½“æ‰€å¸æ”¶ï¼Œå¯ä»¥åœ¨è‚ é“ä¸­è¢«èŒç±»é…µè§£å‘æŒ¥ç‰¹æ®Šä½œç”¨ã€‚\n**4. è¥å…»ç´ åˆ†ç±»**\n|  æ°¨åŸºé…¸  |  è„‚è‚ªé…¸  | ç¢³æ°´åŒ–åˆç‰© | å¸¸é‡å…ƒç´  |  å¾®é‡å…ƒç´   |  ç»´ç”Ÿç´   |  æ°´  |\n|---------|----------|-----------|---------|-----------|---------|---------|\n| å¼‚äº®æ°¨é…¸ |  äºšæ²¹é…¸  | ç¢³æ°´åŒ–åˆç‰© |    é’¾    |    ç¢˜    | ç»´ç”Ÿç´ A |    æ°´    |\n|  äº®æ°¨é…¸  | Î±-äºšéº»é…¸ |           |    é’     |    ç¡’     | ç»´ç”Ÿç´ D |\n|  èµ–æ°¨é…¸  |         |           |    é’™    |     é“œ    | ç»´ç”Ÿç´ E |\n|  è›‹æ°¨é…¸  |         |           |    é•    |     é’¼    | ç»´ç”Ÿç´ K |\n|  è‹¯ä¸™æ°¨é…¸  |         |           |    ç¡«    |    é“¬     | ç»´ç”Ÿç´ B1 |\n|  è‹æ°¨é…¸  |         |           |    ç£·    |     é’´    | ç»´ç”Ÿç´ B2 |\n|  è‰²æ°¨é…¸  |         |           |    æ°¯    |     é“    | çƒŸé…¸ |\n|  ç¼¬æ°¨é…¸  |         |           |          |     é”Œ    | ç»´ç”Ÿç´ B6 |\n|  ç»„æ°¨é…¸   |         |           |          |          | å¶é…¸ |\n|          |         |           |          |          | ç»´ç”Ÿç´ B12 |\n|          |         |           |          |          | æ³›é…¸ |\n|          |         |           |          |          | ç”Ÿç‰©ç´  |\n|          |         |           |          |          | èƒ†ç¢± |\n|          |         |           |          |          | ç»´ç”Ÿç´ C |\n\n&nbsp;&nbsp;&nbsp;&nbsp;æ°¨åŸºé…¸(9)ï¼Œè„‚è‚ªé…¸(2)ï¼Œå¸¸é‡å…ƒç´ (7)ï¼Œå¾®é‡å…ƒç´ (8)ï¼Œç»´ç”Ÿç´ (14)ï¼Œå…¶ä¸­**ç»„æ°¨é…¸**æ˜¯é’ˆå¯¹å©´å¹¼å„¿çš„\n\n#### è¥å…»åˆ†ç±»\n- å®é‡è¥å…»ç´ \n    - ä¸‰å¤§äº§èƒ½è¥å…»ç´ \n        - è›‹ç™½è´¨\n        - è„‚ç±»\n        - ç¢³æ°´åŒ–åˆç‰©\n- å¾®é‡è¥å…»ç´ \n    - ç»´ç”Ÿç´ \n        - æ°´æº¶æ€§ç»´ç”Ÿç´ \n            - Bæ—ç»´ç”Ÿç´ \n            - ç»´ç”Ÿç´ C\n        - è„‚æº¶æ€§ç»´ç”Ÿç´ \n            - ç»´ç”Ÿç´ A\n            - ç»´ç”Ÿç´ D\n            - ç»´ç”Ÿç´ E\n            - ç»´ç”Ÿç´ K\n    - çŸ¿ç‰©è´¨\n        - å¸¸é‡å…ƒç´ ï¼ˆå¤§äºä½“é‡0.01%çš„å…ƒç´ ï¼‰\n            - é’™\n            - é•\n            - é’ \n            - é’¾\n            - ç£·\n            - æ°¯\n            - ç¡«\n        - å¾®é‡å…ƒç´ \n            - é“\n            - ç¢˜\n            - é”Œ\n            - ç¡’\n            - é“œ\n            - é’¼\n            - é“¬\n            - é’´\n\n**5.è¥å…»å­¦**\n&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦æ˜¯ç ”ç©¶äººä½“è¥å…»ä¸å¥åº·å…³ç³»çš„ç§‘å­¦ï¼Œç ”ç©¶å†…å®¹åŒ…æ‹¬ï¼š\n1. è¥å…»ç´ åœ¨äººä½“ä¸­æ¶ˆåŒ–/å¸æ”¶/ä»£è°¢è¿‡ç¨‹åŠå¯¹äººä½“å¥åº·çš„ä½œç”¨\n2. è¥å…»ç´ ä¹‹é—´çš„ç›¸äº’ä½œç”¨å’Œå¹³è¡¡\n3. è¥å…»ç´ éœ€è¦é‡å’Œè†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡ï¼ˆDRIsï¼‰\n4. è¥å…»ç´ ç¼ºä¹ç—…å’Œè¥å…»ç›¸å…³æ…¢æ€§ç—…çš„é¢„é˜²å’Œè¥å…»æ²»ç–—\n5. ç‰¹æ®Šäººç¾¤å’Œç‰¹æ®Šç¯å¢ƒä¸‹çš„è¥å…»\n6. é£Ÿç‰©çš„è¥å…»ä»·å€¼\n7. è¥å…»ç´ ä¿å­˜å’Œè¥å…»ç´ å¼ºåŒ–\n8. æ¤ç‰©åŒ–å­¦ç‰©ä¸ä¿å¥é£Ÿå“\n9. ç¤¾åŒºè¥å…»ç®¡ç†å’Œè¥å…»æ•™è‚²\n10. é£Ÿç‰©è¥å…»æ”¿ç­–å’Œè¥å…»æ³•è§„\n&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦å±äºè‡ªç„¶ç§‘å­¦èŒƒç•´ï¼Œæ˜¯é¢„é˜²åŒ»å­¦çš„ç»„æˆéƒ¨åˆ†å…·æœ‰å¾ˆå¼ºçš„å®è·µæ€§ã€‚\n\n**DRIsï¼šä¸ºäº†ä¿è¯äººä½“åˆç†æ‘„å…¥è¥å…»ç´ ï¼Œé¿å…ç¼ºä¹å’Œè¿‡é‡çš„ä¸€ç»„æ¯æ—¥å¹³å‡è†³é£Ÿè¥å…»ç´ æ‘„å…¥é‡çš„å‚è€ƒå€¼ï¼ŒåŒ…æ‹¬ï¼š**\n- å¹³å‡éœ€è¦é‡ï¼ˆEAR, estimated average requirementï¼‰\n  - æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µç¾¤ä½“ä¸­çš„æ‰€æœ‰ä¸ªä½“å¯¹æŸè¥å…»ç´ éœ€è¦é‡çš„å¹³å‡æ°´å¹³ã€‚\n  - æ‘„å…¥é‡è¾¾åˆ°EARæ°´å¹³æ—¶å¯æ»¡è¶³ç¾¤ä½“ä¸­50%ä¸ªä½“å¯¹è¯¥è¥å…»ç´ çš„éœ€è¦ã€‚\n  - é’ˆå¯¹äººç¾¤ï¼ŒEARå¯ç”¨äºè¯„ä¼°ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³çš„å‘ç”Ÿç‡ã€‚é’ˆå¯¹ä¸ªä½“ï¼Œå¯ä»¥æ£€æŸ¥å…¶æ‘„å…¥ä¸è¶³çš„å¯èƒ½æ€§ã€‚\n- æ¨èæ‘„å…¥é‡ï¼ˆRNI, recommended nutrition intakeï¼‰\n  - æ»¡è¶³æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µä¸­ç»å¤§å¤šæ•°ï¼ˆçº¦97%-98%ï¼‰ä¸ªä½“éœ€è¦é‡çš„æ‘„å…¥æ°´å¹³ã€‚\n  - ä¸»è¦ç”¨é€”æ˜¯ä½œä¸ºä¸ªä½“æ¯æ—¥æ‘„å…¥è¯¥è¥å…»ç´ çš„ç›®æ ‡å€¼ã€‚\n  - å·²çŸ¥EARåŠå…¶æ ‡å‡†å·®ï¼Œåˆ™RNI = EAR + 2SDï¼ˆSDä¸ºæ ‡å‡†å·®ï¼‰ï¼Œä¸èƒ½è®¡ç®—æ—¶ï¼Œä¸€èˆ¬è®¾EARçš„å˜å¼‚ç³»æ•°ä¸º10%ï¼Œä¹Ÿå°±æ˜¯RNI = 1.2EARã€‚\n- é€‚å®œæ‘„å…¥é‡ï¼ˆAI, adequate intakeï¼‰\n  - ä¸»è¦ç”¨ä½œä¸ªä½“çš„è¥å…»æ‘„å…¥ç›®æ ‡ï¼Œå½“æŸç¾¤ä½“çš„è¥å…»ç´ å¹³å‡æ‘„å…¥é‡è¾¾åˆ°æˆ–è¶…è¿‡AIå€¼ï¼Œåˆ™è¯¥ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³è€…çš„å±é™©æ€§å¾ˆå°ã€‚\n  - æ˜¯é€šè¿‡è§‚å¯Ÿæˆ–å®éªŒè·å¾—çš„å¥åº·äººç¾¤æŸç§è¥å…»ç´ çš„æ‘„å…¥é‡ã€‚\n- å¯è€å—æœ€é«˜æ‘„å…¥é‡ï¼ˆUL, tolerable upper intake levelï¼‰\n  - æ˜¯è¥å…»ç´ æˆ–é£Ÿç‰©æˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡çš„å®‰å…¨ä¸Šé™ã€‚æ˜¯ä¸€ä¸ªå¥åº·äººç¾¤ä¸­å‡ ä¹æ‰€æœ‰ä¸ªä½“éƒ½ä¸ä¼šäº§ç”Ÿæ¯’å‰¯ä½œç”¨çš„æœ€é«˜æ‘„å…¥é‡ã€‚\n  - å¯¹ä¸€èˆ¬ç¾¤ä½“æ¥è¯´ï¼Œæ‘„å…¥é‡è¾¾åˆ°ULæ°´å¹³å¯¹å‡ ä¹æ‰€æœ‰ä¸ªä½“å‡ä¸è‡´æŸå®³å¥åº·ï¼Œä½†å¹¶ä¸è¡¨ç¤ºè¾¾åˆ°æ­¤æ‘„å…¥æ°´å¹³å¯¹å¥åº·æ˜¯æœ‰ç›Šçš„ã€‚\n- å®é‡è¥å…»ç´ å¯æ¥å—èŒƒå›´ï¼ˆAMDR, acceptable macronutrient distribution rangesï¼‰\n  - æ˜¯æŒ‡è„‚è‚ªã€è›‹ç™½è´¨å’Œç¢³æ°´åŒ–åˆç‰©ç†æƒ³çš„æ‘„å…¥é‡çš„èŒƒå›´ã€‚\n  - å¸¸ç”¨å èƒ½é‡æ‘„å…¥é‡çš„ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚\n  - è¯¥èŒƒå›´å¯ä»¥æä¾›è¿™äº›å¿…éœ€è¥å…»ç´ çš„éœ€è¦ï¼Œå¹¶ä¸”æœ‰åˆ©äºé™ä½æ…¢æ€§ç—…å‘ç”Ÿçš„å±é™©ã€‚\n  - è„‚è‚ªçš„æ¨èæ‘„å…¥é‡èŒƒå›´ä¸º20%~35%ï¼Œè›‹ç™½è´¨ä¸º10%~20%ï¼Œç¢³æ°´åŒ–åˆç‰©ä¸º50%~65%ã€‚\n- é¢„é˜²éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„å»ºè®®æ‘„å…¥é‡ï¼ˆPI-NCD, proposed intakes for preventing non-communicable chronic diseases, ç®€ç§°å»ºè®®æ‘„å…¥é‡, PIï¼‰\n  - æ˜¯ä»¥è†³é£Ÿç›¸å…³éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„ä¸€çº§é¢„é˜²ä¸ºç›®æ ‡ï¼Œçªå‡ºçš„å¿…éœ€è¥å…»ç´ çš„æ¯æ—¥æ‘„å…¥é‡ã€‚\n  - å½“NCDæ˜“æ„Ÿäººç¾¤æŸäº›è¥å…»ç´ çš„æ‘„å…¥è¾¾åˆ°PIï¼Œå¯ä»¥é™ä½ä»–ä»¬å‘ç”ŸNCDçš„é£é™©ã€‚\n  - çœŸæ­£åˆ¶å®šå‡ºæ¥æ˜ç¡®çš„åªæœ‰ï¼šé’¾ã€é’ ã€ç»´ç”Ÿç´ cã€‚\n- ç‰¹å®šå»ºè®®å€¼ï¼ˆSPL, specific proposed levelsï¼‰\n  - æ˜¯ä»¥é™ä½æˆå¹´äººè†³é£Ÿç›¸å…³éä¼ æŸ“æ€§ç–¾ç—…ä¸ºç›®æ ‡ï¼Œæå‡ºçš„å…¶ä»–è†³é£Ÿæˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡ï¼ˆæ°´å¹³ï¼‰ã€‚\n  - å½“è¯¥æˆåˆ†çš„æ‘„å…¥é‡è¾¾åˆ°SPLï¼Œå¯èƒ½æœ‰åˆ©äºé™ä½ç–¾ç—…çš„å‘ç”Ÿé£é™©æˆ–æ­»äº¡ç‡ã€‚\n\n#### è¥å…»ä¸å¥åº·çš„å…³ç³»\n**è¥å…»ç´ çš„ç”Ÿç†åŠŸèƒ½**\n- æä¾›èƒ½é‡\n- æ„æˆç»†èƒç»„ç»‡ã€ä¾›ç»™ç”Ÿé•¿ã€å‘è‚²å’Œè‡ªæˆ‘æ›´æ–°æ‰€éœ€çš„ææ–™\n- è°ƒèŠ‚æœºä½“ç”Ÿç†æ´»åŠ¨\n\n**è¥å…»ç´ è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„ä½“ç°**\n- åŠ¨æ€å¹³è¡¡\n  - èƒ½é‡å¹³è¡¡\n  - è¥å…»ç´ å¹³è¡¡\n  - æ°´ç›å¹³è¡¡\n- å†…ç¯å¢ƒçš„ç¨³æ€\n  - ç¥ç»ç³»ç»Ÿè°ƒèŠ‚\n  - é…¶è°ƒèŠ‚\n  - æ¿€ç´ è°ƒèŠ‚\n  \n**è¥å…»æ˜¯ç»´æŒå¥åº·çš„åŸºç¡€**\n- ç»´æŒäººä½“ç»„ç»‡çš„æ„æˆ\n- ç»´æŒç”Ÿç†åŠŸèƒ½\n- ç»´æŒå¿ƒç†å¥åº·\n- é¢„é˜²ç–¾ç—…å‘ç”Ÿ\n\n**è¥å…»å¯¹äººç¾¤å¥åº·çš„è¥å…»**\n- ä¿è¯å„¿ç«¥æ­£å¸¸ç”Ÿé•¿å‘è‚²å’Œå¿ƒç†å‘è‚²\n- æ»¡è¶³å„ç±»ç‰¹æ®Šäººç¾¤çš„è¥å…»éœ€è¦\n- å¢å¼ºç‰¹æ®Šç¯å¢ƒä¸‹äººç¾¤çš„æŠµæŠ—åŠ›ã€è€å—åŠ›ã€é€‚åº”æ€§\n- é¢„é˜²è¥å…»ç´ çš„ç¼ºä¹ä¸è¿‡å¤šåŠç›¸å…³çš„ç–¾ç—…\n- è¾…åŠ©å„ç§ç–¾ç—…çš„æ²»ç–—","slug":"è¥å…»å­¦è¯•å¬è¯¾-1","published":1,"updated":"2025-09-26T07:03:21.282Z","_id":"cmfz1q7ls0000wou79t1q1ek5","comments":1,"layout":"post","photos":[],"content":"<p><a href=\"https://www.youlu.com/ggyys/audition/COLUMN20231213000000000002\">è¯•å¬</a></p>\n<h3 id=\"æœ¬ç« é‡éš¾ç‚¹åˆ†æ\"><a href=\"#æœ¬ç« é‡éš¾ç‚¹åˆ†æ\" class=\"headerlink\" title=\"æœ¬ç« é‡éš¾ç‚¹åˆ†æ\"></a>æœ¬ç« é‡éš¾ç‚¹åˆ†æ</h3><ol>\n<li>æŒæ¡è¥å…»åŠè¥å…»ç´ çš„æ¦‚å¿µåŠè¥å…»ç´ çš„åˆ†ç±»</li>\n<li>æŒæ¡è†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡çš„åº”ç”¨</li>\n<li>æŒæ¡èƒ½é‡çš„æ¢ç®—ã€èƒ½é‡ç³»æ•°ã€ä»¥åŠèƒ½é‡çš„æ¶ˆè€—</li>\n<li>æŒæ¡ä¸‰å¤§å®é‡è¥å…»ç´ çš„ç»„æˆã€åˆ†ç±»ã€åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€è†³é£Ÿæ¥æºï¼Œç¼ºä¹æˆ–è¿‡é‡å¯¹æœºä½“çš„å½±å“</li>\n<li>æŒæ¡çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ çš„åˆ†ç±»ã€ç”Ÿç†åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€æ¥æºã€ç¼ºä¹æˆ–è¿‡é‡çš„ä¸è‰¯å½±å“</li>\n<li>æŒæ¡æ°´ã€è†³é£Ÿçº¤ç»´çš„ä¸»è¦ç”Ÿç†åŠŸèƒ½</li>\n</ol>\n<h3 id=\"åŸºç¡€æ¦‚å¿µ\"><a href=\"#åŸºç¡€æ¦‚å¿µ\" class=\"headerlink\" title=\"åŸºç¡€æ¦‚å¿µ\"></a>åŸºç¡€æ¦‚å¿µ</h3><p><strong>1. è¥å…»ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;äººä½“ä»å¤–ç¯å¢ƒæ‘„å–é£Ÿç‰©ï¼Œç»è¿‡æ¶ˆåŒ–ã€å¸æ”¶å’Œä»£è°¢ï¼Œåˆ©ç”¨é£Ÿç‰©ä¸­çš„è¥å…»ç´ å’Œå…¶æœ‰ç›Šç‰©è´¨ï¼Œä¾›ç»™èƒ½é‡ï¼Œæ„æˆå’Œæ›´æ–°ç»„ç»‡ï¼Œä»¥è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚<br><strong>2. è¥å…»ç´ ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;é£Ÿç‰©ä¸­å…·æœ‰ç‰¹å®šç”Ÿç†ä½œç”¨ï¼Œèƒ½ç»´æŒæœºä½“ç”Ÿé•¿ã€å‘è‚²ã€æ´»åŠ¨ã€ç”Ÿæ®–ä»¥åŠæ­£å¸¸ä»£è°¢æ‰€éœ€çš„ç‰©è´¨ï¼ŒåŒ…æ‹¬è›‹ç™½è´¨ã€è„‚ç±»ã€ç¢³æ°´åŒ–åˆç‰©ã€çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ ç­‰ã€‚ä¸èƒ½åœ¨ä½“å†…åˆæˆï¼Œå¿…é¡»ä»é£Ÿç‰©ä¸­è·å–ï¼Œç§°ä¸ºâ€œå¿…éœ€è¥å…»ç´ â€ã€‚<br><strong>3. ä¸ƒå¤§å¿…é¡»è¥å…»ç´ ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;æ°´ã€è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ã€è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆæ¤ç‰©åŒ–åˆç‰© å¯ä»¥æ²¡æœ‰ï¼Œæœ‰æ›´å¥½ï¼šèŒ¶å¤šé…šã€èŠ±é’ç´ ã€èƒ¡èåœç´ ã€ç•ªèŒ„çº¢ç´ ã€çš‚è‹·ã€å¤§è’œç´ ï¼‰<br>&nbsp;&nbsp;&nbsp;&nbsp;è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ï¼ˆè„‚è‚ªå’Œç±»è„‚ï¼Œä¸»è¦è¯´è„‚è‚ªï¼‰æ˜¯ä¸»è¦èƒ½é‡æä¾›è€…ï¼Œæ‘„å–é‡æ¯”è¾ƒå¤šï¼Œä¹Ÿå« <strong>å®é‡è¥å…»ç´ </strong>ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨æ˜¯ <strong>å¾®é‡è¥å…»ç´ </strong>ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ä¹Ÿæ˜¯ç¢³æ°´åŒ–åˆç‰©ï¼Œåªæ˜¯å¾ˆéš¾è¢«äººä½“æ‰€å¸æ”¶ï¼Œå¯ä»¥åœ¨è‚ é“ä¸­è¢«èŒç±»é…µè§£å‘æŒ¥ç‰¹æ®Šä½œç”¨ã€‚<br><strong>4. è¥å…»ç´ åˆ†ç±»</strong></p>\n<table>\n<thead>\n<tr>\n<th>æ°¨åŸºé…¸</th>\n<th>è„‚è‚ªé…¸</th>\n<th>ç¢³æ°´åŒ–åˆç‰©</th>\n<th>å¸¸é‡å…ƒç´ </th>\n<th>å¾®é‡å…ƒç´ </th>\n<th>ç»´ç”Ÿç´ </th>\n<th>æ°´</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>å¼‚äº®æ°¨é…¸</td>\n<td>äºšæ²¹é…¸</td>\n<td>ç¢³æ°´åŒ–åˆç‰©</td>\n<td>é’¾</td>\n<td>ç¢˜</td>\n<td>ç»´ç”Ÿç´ A</td>\n<td>æ°´</td>\n</tr>\n<tr>\n<td>äº®æ°¨é…¸</td>\n<td>Î±-äºšéº»é…¸</td>\n<td></td>\n<td>é’ </td>\n<td>ç¡’</td>\n<td>ç»´ç”Ÿç´ D</td>\n<td></td>\n</tr>\n<tr>\n<td>èµ–æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>é’™</td>\n<td>é“œ</td>\n<td>ç»´ç”Ÿç´ E</td>\n<td></td>\n</tr>\n<tr>\n<td>è›‹æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>é•</td>\n<td>é’¼</td>\n<td>ç»´ç”Ÿç´ K</td>\n<td></td>\n</tr>\n<tr>\n<td>è‹¯ä¸™æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>ç¡«</td>\n<td>é“¬</td>\n<td>ç»´ç”Ÿç´ B1</td>\n<td></td>\n</tr>\n<tr>\n<td>è‹æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>ç£·</td>\n<td>é’´</td>\n<td>ç»´ç”Ÿç´ B2</td>\n<td></td>\n</tr>\n<tr>\n<td>è‰²æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>æ°¯</td>\n<td>é“</td>\n<td>çƒŸé…¸</td>\n<td></td>\n</tr>\n<tr>\n<td>ç¼¬æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td></td>\n<td>é”Œ</td>\n<td>ç»´ç”Ÿç´ B6</td>\n<td></td>\n</tr>\n<tr>\n<td>ç»„æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>å¶é…¸</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç»´ç”Ÿç´ B12</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>æ³›é…¸</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç”Ÿç‰©ç´ </td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>èƒ†ç¢±</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç»´ç”Ÿç´ C</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;æ°¨åŸºé…¸(9)ï¼Œè„‚è‚ªé…¸(2)ï¼Œå¸¸é‡å…ƒç´ (7)ï¼Œå¾®é‡å…ƒç´ (8)ï¼Œç»´ç”Ÿç´ (14)ï¼Œå…¶ä¸­<strong>ç»„æ°¨é…¸</strong>æ˜¯é’ˆå¯¹å©´å¹¼å„¿çš„</p>\n<h4 id=\"è¥å…»åˆ†ç±»\"><a href=\"#è¥å…»åˆ†ç±»\" class=\"headerlink\" title=\"è¥å…»åˆ†ç±»\"></a>è¥å…»åˆ†ç±»</h4><ul>\n<li>å®é‡è¥å…»ç´ <ul>\n<li>ä¸‰å¤§äº§èƒ½è¥å…»ç´ <ul>\n<li>è›‹ç™½è´¨</li>\n<li>è„‚ç±»</li>\n<li>ç¢³æ°´åŒ–åˆç‰©</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>å¾®é‡è¥å…»ç´ <ul>\n<li>ç»´ç”Ÿç´ <ul>\n<li>æ°´æº¶æ€§ç»´ç”Ÿç´ <ul>\n<li>Bæ—ç»´ç”Ÿç´ </li>\n<li>ç»´ç”Ÿç´ C</li>\n</ul>\n</li>\n<li>è„‚æº¶æ€§ç»´ç”Ÿç´ <ul>\n<li>ç»´ç”Ÿç´ A</li>\n<li>ç»´ç”Ÿç´ D</li>\n<li>ç»´ç”Ÿç´ E</li>\n<li>ç»´ç”Ÿç´ K</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>çŸ¿ç‰©è´¨<ul>\n<li>å¸¸é‡å…ƒç´ ï¼ˆå¤§äºä½“é‡0.01%çš„å…ƒç´ ï¼‰<ul>\n<li>é’™</li>\n<li>é•</li>\n<li>é’ </li>\n<li>é’¾</li>\n<li>ç£·</li>\n<li>æ°¯</li>\n<li>ç¡«</li>\n</ul>\n</li>\n<li>å¾®é‡å…ƒç´ <ul>\n<li>é“</li>\n<li>ç¢˜</li>\n<li>é”Œ</li>\n<li>ç¡’</li>\n<li>é“œ</li>\n<li>é’¼</li>\n<li>é“¬</li>\n<li>é’´</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>5.è¥å…»å­¦</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦æ˜¯ç ”ç©¶äººä½“è¥å…»ä¸å¥åº·å…³ç³»çš„ç§‘å­¦ï¼Œç ”ç©¶å†…å®¹åŒ…æ‹¬ï¼š</p>\n<ol>\n<li>è¥å…»ç´ åœ¨äººä½“ä¸­æ¶ˆåŒ–&#x2F;å¸æ”¶&#x2F;ä»£è°¢è¿‡ç¨‹åŠå¯¹äººä½“å¥åº·çš„ä½œç”¨</li>\n<li>è¥å…»ç´ ä¹‹é—´çš„ç›¸äº’ä½œç”¨å’Œå¹³è¡¡</li>\n<li>è¥å…»ç´ éœ€è¦é‡å’Œè†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡ï¼ˆDRIsï¼‰</li>\n<li>è¥å…»ç´ ç¼ºä¹ç—…å’Œè¥å…»ç›¸å…³æ…¢æ€§ç—…çš„é¢„é˜²å’Œè¥å…»æ²»ç–—</li>\n<li>ç‰¹æ®Šäººç¾¤å’Œç‰¹æ®Šç¯å¢ƒä¸‹çš„è¥å…»</li>\n<li>é£Ÿç‰©çš„è¥å…»ä»·å€¼</li>\n<li>è¥å…»ç´ ä¿å­˜å’Œè¥å…»ç´ å¼ºåŒ–</li>\n<li>æ¤ç‰©åŒ–å­¦ç‰©ä¸ä¿å¥é£Ÿå“</li>\n<li>ç¤¾åŒºè¥å…»ç®¡ç†å’Œè¥å…»æ•™è‚²</li>\n<li>é£Ÿç‰©è¥å…»æ”¿ç­–å’Œè¥å…»æ³•è§„<br>&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦å±äºè‡ªç„¶ç§‘å­¦èŒƒç•´ï¼Œæ˜¯é¢„é˜²åŒ»å­¦çš„ç»„æˆéƒ¨åˆ†å…·æœ‰å¾ˆå¼ºçš„å®è·µæ€§ã€‚</li>\n</ol>\n<p><strong>DRIsï¼šä¸ºäº†ä¿è¯äººä½“åˆç†æ‘„å…¥è¥å…»ç´ ï¼Œé¿å…ç¼ºä¹å’Œè¿‡é‡çš„ä¸€ç»„æ¯æ—¥å¹³å‡è†³é£Ÿè¥å…»ç´ æ‘„å…¥é‡çš„å‚è€ƒå€¼ï¼ŒåŒ…æ‹¬ï¼š</strong></p>\n<ul>\n<li>å¹³å‡éœ€è¦é‡ï¼ˆEAR, estimated average requirementï¼‰<ul>\n<li>æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µç¾¤ä½“ä¸­çš„æ‰€æœ‰ä¸ªä½“å¯¹æŸè¥å…»ç´ éœ€è¦é‡çš„å¹³å‡æ°´å¹³ã€‚</li>\n<li>æ‘„å…¥é‡è¾¾åˆ°EARæ°´å¹³æ—¶å¯æ»¡è¶³ç¾¤ä½“ä¸­50%ä¸ªä½“å¯¹è¯¥è¥å…»ç´ çš„éœ€è¦ã€‚</li>\n<li>é’ˆå¯¹äººç¾¤ï¼ŒEARå¯ç”¨äºè¯„ä¼°ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³çš„å‘ç”Ÿç‡ã€‚é’ˆå¯¹ä¸ªä½“ï¼Œå¯ä»¥æ£€æŸ¥å…¶æ‘„å…¥ä¸è¶³çš„å¯èƒ½æ€§ã€‚</li>\n</ul>\n</li>\n<li>æ¨èæ‘„å…¥é‡ï¼ˆRNI, recommended nutrition intakeï¼‰<ul>\n<li>æ»¡è¶³æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µä¸­ç»å¤§å¤šæ•°ï¼ˆçº¦97%-98%ï¼‰ä¸ªä½“éœ€è¦é‡çš„æ‘„å…¥æ°´å¹³ã€‚</li>\n<li>ä¸»è¦ç”¨é€”æ˜¯ä½œä¸ºä¸ªä½“æ¯æ—¥æ‘„å…¥è¯¥è¥å…»ç´ çš„ç›®æ ‡å€¼ã€‚</li>\n<li>å·²çŸ¥EARåŠå…¶æ ‡å‡†å·®ï¼Œåˆ™RNI &#x3D; EAR + 2SDï¼ˆSDä¸ºæ ‡å‡†å·®ï¼‰ï¼Œä¸èƒ½è®¡ç®—æ—¶ï¼Œä¸€èˆ¬è®¾EARçš„å˜å¼‚ç³»æ•°ä¸º10%ï¼Œä¹Ÿå°±æ˜¯RNI &#x3D; 1.2EARã€‚</li>\n</ul>\n</li>\n<li>é€‚å®œæ‘„å…¥é‡ï¼ˆAI, adequate intakeï¼‰<ul>\n<li>ä¸»è¦ç”¨ä½œä¸ªä½“çš„è¥å…»æ‘„å…¥ç›®æ ‡ï¼Œå½“æŸç¾¤ä½“çš„è¥å…»ç´ å¹³å‡æ‘„å…¥é‡è¾¾åˆ°æˆ–è¶…è¿‡AIå€¼ï¼Œåˆ™è¯¥ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³è€…çš„å±é™©æ€§å¾ˆå°ã€‚</li>\n<li>æ˜¯é€šè¿‡è§‚å¯Ÿæˆ–å®éªŒè·å¾—çš„å¥åº·äººç¾¤æŸç§è¥å…»ç´ çš„æ‘„å…¥é‡ã€‚</li>\n</ul>\n</li>\n<li>å¯è€å—æœ€é«˜æ‘„å…¥é‡ï¼ˆUL, tolerable upper intake levelï¼‰<ul>\n<li>æ˜¯è¥å…»ç´ æˆ–é£Ÿç‰©æˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡çš„å®‰å…¨ä¸Šé™ã€‚æ˜¯ä¸€ä¸ªå¥åº·äººç¾¤ä¸­å‡ ä¹æ‰€æœ‰ä¸ªä½“éƒ½ä¸ä¼šäº§ç”Ÿæ¯’å‰¯ä½œç”¨çš„æœ€é«˜æ‘„å…¥é‡ã€‚</li>\n<li>å¯¹ä¸€èˆ¬ç¾¤ä½“æ¥è¯´ï¼Œæ‘„å…¥é‡è¾¾åˆ°ULæ°´å¹³å¯¹å‡ ä¹æ‰€æœ‰ä¸ªä½“å‡ä¸è‡´æŸå®³å¥åº·ï¼Œä½†å¹¶ä¸è¡¨ç¤ºè¾¾åˆ°æ­¤æ‘„å…¥æ°´å¹³å¯¹å¥åº·æ˜¯æœ‰ç›Šçš„ã€‚</li>\n</ul>\n</li>\n<li>å®é‡è¥å…»ç´ å¯æ¥å—èŒƒå›´ï¼ˆAMDR, acceptable macronutrient distribution rangesï¼‰<ul>\n<li>æ˜¯æŒ‡è„‚è‚ªã€è›‹ç™½è´¨å’Œç¢³æ°´åŒ–åˆç‰©ç†æƒ³çš„æ‘„å…¥é‡çš„èŒƒå›´ã€‚</li>\n<li>å¸¸ç”¨å èƒ½é‡æ‘„å…¥é‡çš„ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚</li>\n<li>è¯¥èŒƒå›´å¯ä»¥æä¾›è¿™äº›å¿…éœ€è¥å…»ç´ çš„éœ€è¦ï¼Œå¹¶ä¸”æœ‰åˆ©äºé™ä½æ…¢æ€§ç—…å‘ç”Ÿçš„å±é™©ã€‚</li>\n<li>è„‚è‚ªçš„æ¨èæ‘„å…¥é‡èŒƒå›´ä¸º20%<del>35%ï¼Œè›‹ç™½è´¨ä¸º10%</del>20%ï¼Œç¢³æ°´åŒ–åˆç‰©ä¸º50%~65%ã€‚</li>\n</ul>\n</li>\n<li>é¢„é˜²éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„å»ºè®®æ‘„å…¥é‡ï¼ˆPI-NCD, proposed intakes for preventing non-communicable chronic diseases, ç®€ç§°å»ºè®®æ‘„å…¥é‡, PIï¼‰<ul>\n<li>æ˜¯ä»¥è†³é£Ÿç›¸å…³éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„ä¸€çº§é¢„é˜²ä¸ºç›®æ ‡ï¼Œçªå‡ºçš„å¿…éœ€è¥å…»ç´ çš„æ¯æ—¥æ‘„å…¥é‡ã€‚</li>\n<li>å½“NCDæ˜“æ„Ÿäººç¾¤æŸäº›è¥å…»ç´ çš„æ‘„å…¥è¾¾åˆ°PIï¼Œå¯ä»¥é™ä½ä»–ä»¬å‘ç”ŸNCDçš„é£é™©ã€‚</li>\n<li>çœŸæ­£åˆ¶å®šå‡ºæ¥æ˜ç¡®çš„åªæœ‰ï¼šé’¾ã€é’ ã€ç»´ç”Ÿç´ cã€‚</li>\n</ul>\n</li>\n<li>ç‰¹å®šå»ºè®®å€¼ï¼ˆSPL, specific proposed levelsï¼‰<ul>\n<li>æ˜¯ä»¥é™ä½æˆå¹´äººè†³é£Ÿç›¸å…³éä¼ æŸ“æ€§ç–¾ç—…ä¸ºç›®æ ‡ï¼Œæå‡ºçš„å…¶ä»–è†³é£Ÿæˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡ï¼ˆæ°´å¹³ï¼‰ã€‚</li>\n<li>å½“è¯¥æˆåˆ†çš„æ‘„å…¥é‡è¾¾åˆ°SPLï¼Œå¯èƒ½æœ‰åˆ©äºé™ä½ç–¾ç—…çš„å‘ç”Ÿé£é™©æˆ–æ­»äº¡ç‡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"è¥å…»ä¸å¥åº·çš„å…³ç³»\"><a href=\"#è¥å…»ä¸å¥åº·çš„å…³ç³»\" class=\"headerlink\" title=\"è¥å…»ä¸å¥åº·çš„å…³ç³»\"></a>è¥å…»ä¸å¥åº·çš„å…³ç³»</h4><p><strong>è¥å…»ç´ çš„ç”Ÿç†åŠŸèƒ½</strong></p>\n<ul>\n<li>æä¾›èƒ½é‡</li>\n<li>æ„æˆç»†èƒç»„ç»‡ã€ä¾›ç»™ç”Ÿé•¿ã€å‘è‚²å’Œè‡ªæˆ‘æ›´æ–°æ‰€éœ€çš„ææ–™</li>\n<li>è°ƒèŠ‚æœºä½“ç”Ÿç†æ´»åŠ¨</li>\n</ul>\n<p><strong>è¥å…»ç´ è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„ä½“ç°</strong></p>\n<ul>\n<li>åŠ¨æ€å¹³è¡¡<ul>\n<li>èƒ½é‡å¹³è¡¡</li>\n<li>è¥å…»ç´ å¹³è¡¡</li>\n<li>æ°´ç›å¹³è¡¡</li>\n</ul>\n</li>\n<li>å†…ç¯å¢ƒçš„ç¨³æ€<ul>\n<li>ç¥ç»ç³»ç»Ÿè°ƒèŠ‚</li>\n<li>é…¶è°ƒèŠ‚</li>\n<li>æ¿€ç´ è°ƒèŠ‚</li>\n</ul>\n</li>\n</ul>\n<p><strong>è¥å…»æ˜¯ç»´æŒå¥åº·çš„åŸºç¡€</strong></p>\n<ul>\n<li>ç»´æŒäººä½“ç»„ç»‡çš„æ„æˆ</li>\n<li>ç»´æŒç”Ÿç†åŠŸèƒ½</li>\n<li>ç»´æŒå¿ƒç†å¥åº·</li>\n<li>é¢„é˜²ç–¾ç—…å‘ç”Ÿ</li>\n</ul>\n<p><strong>è¥å…»å¯¹äººç¾¤å¥åº·çš„è¥å…»</strong></p>\n<ul>\n<li>ä¿è¯å„¿ç«¥æ­£å¸¸ç”Ÿé•¿å‘è‚²å’Œå¿ƒç†å‘è‚²</li>\n<li>æ»¡è¶³å„ç±»ç‰¹æ®Šäººç¾¤çš„è¥å…»éœ€è¦</li>\n<li>å¢å¼ºç‰¹æ®Šç¯å¢ƒä¸‹äººç¾¤çš„æŠµæŠ—åŠ›ã€è€å—åŠ›ã€é€‚åº”æ€§</li>\n<li>é¢„é˜²è¥å…»ç´ çš„ç¼ºä¹ä¸è¿‡å¤šåŠç›¸å…³çš„ç–¾ç—…</li>\n<li>è¾…åŠ©å„ç§ç–¾ç—…çš„æ²»ç–—</li>\n</ul>\n","excerpt":"","more":"<p><a href=\"https://www.youlu.com/ggyys/audition/COLUMN20231213000000000002\">è¯•å¬</a></p>\n<h3 id=\"æœ¬ç« é‡éš¾ç‚¹åˆ†æ\"><a href=\"#æœ¬ç« é‡éš¾ç‚¹åˆ†æ\" class=\"headerlink\" title=\"æœ¬ç« é‡éš¾ç‚¹åˆ†æ\"></a>æœ¬ç« é‡éš¾ç‚¹åˆ†æ</h3><ol>\n<li>æŒæ¡è¥å…»åŠè¥å…»ç´ çš„æ¦‚å¿µåŠè¥å…»ç´ çš„åˆ†ç±»</li>\n<li>æŒæ¡è†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡çš„åº”ç”¨</li>\n<li>æŒæ¡èƒ½é‡çš„æ¢ç®—ã€èƒ½é‡ç³»æ•°ã€ä»¥åŠèƒ½é‡çš„æ¶ˆè€—</li>\n<li>æŒæ¡ä¸‰å¤§å®é‡è¥å…»ç´ çš„ç»„æˆã€åˆ†ç±»ã€åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€è†³é£Ÿæ¥æºï¼Œç¼ºä¹æˆ–è¿‡é‡å¯¹æœºä½“çš„å½±å“</li>\n<li>æŒæ¡çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ çš„åˆ†ç±»ã€ç”Ÿç†åŠŸèƒ½ã€å‚è€ƒæ‘„å…¥é‡ã€æ¥æºã€ç¼ºä¹æˆ–è¿‡é‡çš„ä¸è‰¯å½±å“</li>\n<li>æŒæ¡æ°´ã€è†³é£Ÿçº¤ç»´çš„ä¸»è¦ç”Ÿç†åŠŸèƒ½</li>\n</ol>\n<h3 id=\"åŸºç¡€æ¦‚å¿µ\"><a href=\"#åŸºç¡€æ¦‚å¿µ\" class=\"headerlink\" title=\"åŸºç¡€æ¦‚å¿µ\"></a>åŸºç¡€æ¦‚å¿µ</h3><p><strong>1. è¥å…»ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;äººä½“ä»å¤–ç¯å¢ƒæ‘„å–é£Ÿç‰©ï¼Œç»è¿‡æ¶ˆåŒ–ã€å¸æ”¶å’Œä»£è°¢ï¼Œåˆ©ç”¨é£Ÿç‰©ä¸­çš„è¥å…»ç´ å’Œå…¶æœ‰ç›Šç‰©è´¨ï¼Œä¾›ç»™èƒ½é‡ï¼Œæ„æˆå’Œæ›´æ–°ç»„ç»‡ï¼Œä»¥è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚<br><strong>2. è¥å…»ç´ ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;é£Ÿç‰©ä¸­å…·æœ‰ç‰¹å®šç”Ÿç†ä½œç”¨ï¼Œèƒ½ç»´æŒæœºä½“ç”Ÿé•¿ã€å‘è‚²ã€æ´»åŠ¨ã€ç”Ÿæ®–ä»¥åŠæ­£å¸¸ä»£è°¢æ‰€éœ€çš„ç‰©è´¨ï¼ŒåŒ…æ‹¬è›‹ç™½è´¨ã€è„‚ç±»ã€ç¢³æ°´åŒ–åˆç‰©ã€çŸ¿ç‰©è´¨ã€ç»´ç”Ÿç´ ç­‰ã€‚ä¸èƒ½åœ¨ä½“å†…åˆæˆï¼Œå¿…é¡»ä»é£Ÿç‰©ä¸­è·å–ï¼Œç§°ä¸ºâ€œå¿…éœ€è¥å…»ç´ â€ã€‚<br><strong>3. ä¸ƒå¤§å¿…é¡»è¥å…»ç´ ï¼š</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;æ°´ã€è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ã€è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆæ¤ç‰©åŒ–åˆç‰© å¯ä»¥æ²¡æœ‰ï¼Œæœ‰æ›´å¥½ï¼šèŒ¶å¤šé…šã€èŠ±é’ç´ ã€èƒ¡èåœç´ ã€ç•ªèŒ„çº¢ç´ ã€çš‚è‹·ã€å¤§è’œç´ ï¼‰<br>&nbsp;&nbsp;&nbsp;&nbsp;è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚ç±»ï¼ˆè„‚è‚ªå’Œç±»è„‚ï¼Œä¸»è¦è¯´è„‚è‚ªï¼‰æ˜¯ä¸»è¦èƒ½é‡æä¾›è€…ï¼Œæ‘„å–é‡æ¯”è¾ƒå¤šï¼Œä¹Ÿå« <strong>å®é‡è¥å…»ç´ </strong>ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ã€ç»´ç”Ÿç´ ã€çŸ¿ç‰©è´¨æ˜¯ <strong>å¾®é‡è¥å…»ç´ </strong>ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;è†³é£Ÿçº¤ç»´ä¹Ÿæ˜¯ç¢³æ°´åŒ–åˆç‰©ï¼Œåªæ˜¯å¾ˆéš¾è¢«äººä½“æ‰€å¸æ”¶ï¼Œå¯ä»¥åœ¨è‚ é“ä¸­è¢«èŒç±»é…µè§£å‘æŒ¥ç‰¹æ®Šä½œç”¨ã€‚<br><strong>4. è¥å…»ç´ åˆ†ç±»</strong></p>\n<table>\n<thead>\n<tr>\n<th>æ°¨åŸºé…¸</th>\n<th>è„‚è‚ªé…¸</th>\n<th>ç¢³æ°´åŒ–åˆç‰©</th>\n<th>å¸¸é‡å…ƒç´ </th>\n<th>å¾®é‡å…ƒç´ </th>\n<th>ç»´ç”Ÿç´ </th>\n<th>æ°´</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>å¼‚äº®æ°¨é…¸</td>\n<td>äºšæ²¹é…¸</td>\n<td>ç¢³æ°´åŒ–åˆç‰©</td>\n<td>é’¾</td>\n<td>ç¢˜</td>\n<td>ç»´ç”Ÿç´ A</td>\n<td>æ°´</td>\n</tr>\n<tr>\n<td>äº®æ°¨é…¸</td>\n<td>Î±-äºšéº»é…¸</td>\n<td></td>\n<td>é’ </td>\n<td>ç¡’</td>\n<td>ç»´ç”Ÿç´ D</td>\n<td></td>\n</tr>\n<tr>\n<td>èµ–æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>é’™</td>\n<td>é“œ</td>\n<td>ç»´ç”Ÿç´ E</td>\n<td></td>\n</tr>\n<tr>\n<td>è›‹æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>é•</td>\n<td>é’¼</td>\n<td>ç»´ç”Ÿç´ K</td>\n<td></td>\n</tr>\n<tr>\n<td>è‹¯ä¸™æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>ç¡«</td>\n<td>é“¬</td>\n<td>ç»´ç”Ÿç´ B1</td>\n<td></td>\n</tr>\n<tr>\n<td>è‹æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>ç£·</td>\n<td>é’´</td>\n<td>ç»´ç”Ÿç´ B2</td>\n<td></td>\n</tr>\n<tr>\n<td>è‰²æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td>æ°¯</td>\n<td>é“</td>\n<td>çƒŸé…¸</td>\n<td></td>\n</tr>\n<tr>\n<td>ç¼¬æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td></td>\n<td>é”Œ</td>\n<td>ç»´ç”Ÿç´ B6</td>\n<td></td>\n</tr>\n<tr>\n<td>ç»„æ°¨é…¸</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>å¶é…¸</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç»´ç”Ÿç´ B12</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>æ³›é…¸</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç”Ÿç‰©ç´ </td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>èƒ†ç¢±</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>ç»´ç”Ÿç´ C</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;æ°¨åŸºé…¸(9)ï¼Œè„‚è‚ªé…¸(2)ï¼Œå¸¸é‡å…ƒç´ (7)ï¼Œå¾®é‡å…ƒç´ (8)ï¼Œç»´ç”Ÿç´ (14)ï¼Œå…¶ä¸­<strong>ç»„æ°¨é…¸</strong>æ˜¯é’ˆå¯¹å©´å¹¼å„¿çš„</p>\n<h4 id=\"è¥å…»åˆ†ç±»\"><a href=\"#è¥å…»åˆ†ç±»\" class=\"headerlink\" title=\"è¥å…»åˆ†ç±»\"></a>è¥å…»åˆ†ç±»</h4><ul>\n<li>å®é‡è¥å…»ç´ <ul>\n<li>ä¸‰å¤§äº§èƒ½è¥å…»ç´ <ul>\n<li>è›‹ç™½è´¨</li>\n<li>è„‚ç±»</li>\n<li>ç¢³æ°´åŒ–åˆç‰©</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>å¾®é‡è¥å…»ç´ <ul>\n<li>ç»´ç”Ÿç´ <ul>\n<li>æ°´æº¶æ€§ç»´ç”Ÿç´ <ul>\n<li>Bæ—ç»´ç”Ÿç´ </li>\n<li>ç»´ç”Ÿç´ C</li>\n</ul>\n</li>\n<li>è„‚æº¶æ€§ç»´ç”Ÿç´ <ul>\n<li>ç»´ç”Ÿç´ A</li>\n<li>ç»´ç”Ÿç´ D</li>\n<li>ç»´ç”Ÿç´ E</li>\n<li>ç»´ç”Ÿç´ K</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>çŸ¿ç‰©è´¨<ul>\n<li>å¸¸é‡å…ƒç´ ï¼ˆå¤§äºä½“é‡0.01%çš„å…ƒç´ ï¼‰<ul>\n<li>é’™</li>\n<li>é•</li>\n<li>é’ </li>\n<li>é’¾</li>\n<li>ç£·</li>\n<li>æ°¯</li>\n<li>ç¡«</li>\n</ul>\n</li>\n<li>å¾®é‡å…ƒç´ <ul>\n<li>é“</li>\n<li>ç¢˜</li>\n<li>é”Œ</li>\n<li>ç¡’</li>\n<li>é“œ</li>\n<li>é’¼</li>\n<li>é“¬</li>\n<li>é’´</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>5.è¥å…»å­¦</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦æ˜¯ç ”ç©¶äººä½“è¥å…»ä¸å¥åº·å…³ç³»çš„ç§‘å­¦ï¼Œç ”ç©¶å†…å®¹åŒ…æ‹¬ï¼š</p>\n<ol>\n<li>è¥å…»ç´ åœ¨äººä½“ä¸­æ¶ˆåŒ–&#x2F;å¸æ”¶&#x2F;ä»£è°¢è¿‡ç¨‹åŠå¯¹äººä½“å¥åº·çš„ä½œç”¨</li>\n<li>è¥å…»ç´ ä¹‹é—´çš„ç›¸äº’ä½œç”¨å’Œå¹³è¡¡</li>\n<li>è¥å…»ç´ éœ€è¦é‡å’Œè†³é£Ÿè¥å…»ç´ å‚è€ƒæ‘„å…¥é‡ï¼ˆDRIsï¼‰</li>\n<li>è¥å…»ç´ ç¼ºä¹ç—…å’Œè¥å…»ç›¸å…³æ…¢æ€§ç—…çš„é¢„é˜²å’Œè¥å…»æ²»ç–—</li>\n<li>ç‰¹æ®Šäººç¾¤å’Œç‰¹æ®Šç¯å¢ƒä¸‹çš„è¥å…»</li>\n<li>é£Ÿç‰©çš„è¥å…»ä»·å€¼</li>\n<li>è¥å…»ç´ ä¿å­˜å’Œè¥å…»ç´ å¼ºåŒ–</li>\n<li>æ¤ç‰©åŒ–å­¦ç‰©ä¸ä¿å¥é£Ÿå“</li>\n<li>ç¤¾åŒºè¥å…»ç®¡ç†å’Œè¥å…»æ•™è‚²</li>\n<li>é£Ÿç‰©è¥å…»æ”¿ç­–å’Œè¥å…»æ³•è§„<br>&nbsp;&nbsp;&nbsp;&nbsp;è¥å…»å­¦å±äºè‡ªç„¶ç§‘å­¦èŒƒç•´ï¼Œæ˜¯é¢„é˜²åŒ»å­¦çš„ç»„æˆéƒ¨åˆ†å…·æœ‰å¾ˆå¼ºçš„å®è·µæ€§ã€‚</li>\n</ol>\n<p><strong>DRIsï¼šä¸ºäº†ä¿è¯äººä½“åˆç†æ‘„å…¥è¥å…»ç´ ï¼Œé¿å…ç¼ºä¹å’Œè¿‡é‡çš„ä¸€ç»„æ¯æ—¥å¹³å‡è†³é£Ÿè¥å…»ç´ æ‘„å…¥é‡çš„å‚è€ƒå€¼ï¼ŒåŒ…æ‹¬ï¼š</strong></p>\n<ul>\n<li>å¹³å‡éœ€è¦é‡ï¼ˆEAR, estimated average requirementï¼‰<ul>\n<li>æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µç¾¤ä½“ä¸­çš„æ‰€æœ‰ä¸ªä½“å¯¹æŸè¥å…»ç´ éœ€è¦é‡çš„å¹³å‡æ°´å¹³ã€‚</li>\n<li>æ‘„å…¥é‡è¾¾åˆ°EARæ°´å¹³æ—¶å¯æ»¡è¶³ç¾¤ä½“ä¸­50%ä¸ªä½“å¯¹è¯¥è¥å…»ç´ çš„éœ€è¦ã€‚</li>\n<li>é’ˆå¯¹äººç¾¤ï¼ŒEARå¯ç”¨äºè¯„ä¼°ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³çš„å‘ç”Ÿç‡ã€‚é’ˆå¯¹ä¸ªä½“ï¼Œå¯ä»¥æ£€æŸ¥å…¶æ‘„å…¥ä¸è¶³çš„å¯èƒ½æ€§ã€‚</li>\n</ul>\n</li>\n<li>æ¨èæ‘„å…¥é‡ï¼ˆRNI, recommended nutrition intakeï¼‰<ul>\n<li>æ»¡è¶³æŸä¸€ç‰¹å®šæ€§åˆ«ã€å¹´é¾„åŠç”Ÿç†çŠ¶å†µä¸­ç»å¤§å¤šæ•°ï¼ˆçº¦97%-98%ï¼‰ä¸ªä½“éœ€è¦é‡çš„æ‘„å…¥æ°´å¹³ã€‚</li>\n<li>ä¸»è¦ç”¨é€”æ˜¯ä½œä¸ºä¸ªä½“æ¯æ—¥æ‘„å…¥è¯¥è¥å…»ç´ çš„ç›®æ ‡å€¼ã€‚</li>\n<li>å·²çŸ¥EARåŠå…¶æ ‡å‡†å·®ï¼Œåˆ™RNI &#x3D; EAR + 2SDï¼ˆSDä¸ºæ ‡å‡†å·®ï¼‰ï¼Œä¸èƒ½è®¡ç®—æ—¶ï¼Œä¸€èˆ¬è®¾EARçš„å˜å¼‚ç³»æ•°ä¸º10%ï¼Œä¹Ÿå°±æ˜¯RNI &#x3D; 1.2EARã€‚</li>\n</ul>\n</li>\n<li>é€‚å®œæ‘„å…¥é‡ï¼ˆAI, adequate intakeï¼‰<ul>\n<li>ä¸»è¦ç”¨ä½œä¸ªä½“çš„è¥å…»æ‘„å…¥ç›®æ ‡ï¼Œå½“æŸç¾¤ä½“çš„è¥å…»ç´ å¹³å‡æ‘„å…¥é‡è¾¾åˆ°æˆ–è¶…è¿‡AIå€¼ï¼Œåˆ™è¯¥ç¾¤ä½“ä¸­æ‘„å…¥ä¸è¶³è€…çš„å±é™©æ€§å¾ˆå°ã€‚</li>\n<li>æ˜¯é€šè¿‡è§‚å¯Ÿæˆ–å®éªŒè·å¾—çš„å¥åº·äººç¾¤æŸç§è¥å…»ç´ çš„æ‘„å…¥é‡ã€‚</li>\n</ul>\n</li>\n<li>å¯è€å—æœ€é«˜æ‘„å…¥é‡ï¼ˆUL, tolerable upper intake levelï¼‰<ul>\n<li>æ˜¯è¥å…»ç´ æˆ–é£Ÿç‰©æˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡çš„å®‰å…¨ä¸Šé™ã€‚æ˜¯ä¸€ä¸ªå¥åº·äººç¾¤ä¸­å‡ ä¹æ‰€æœ‰ä¸ªä½“éƒ½ä¸ä¼šäº§ç”Ÿæ¯’å‰¯ä½œç”¨çš„æœ€é«˜æ‘„å…¥é‡ã€‚</li>\n<li>å¯¹ä¸€èˆ¬ç¾¤ä½“æ¥è¯´ï¼Œæ‘„å…¥é‡è¾¾åˆ°ULæ°´å¹³å¯¹å‡ ä¹æ‰€æœ‰ä¸ªä½“å‡ä¸è‡´æŸå®³å¥åº·ï¼Œä½†å¹¶ä¸è¡¨ç¤ºè¾¾åˆ°æ­¤æ‘„å…¥æ°´å¹³å¯¹å¥åº·æ˜¯æœ‰ç›Šçš„ã€‚</li>\n</ul>\n</li>\n<li>å®é‡è¥å…»ç´ å¯æ¥å—èŒƒå›´ï¼ˆAMDR, acceptable macronutrient distribution rangesï¼‰<ul>\n<li>æ˜¯æŒ‡è„‚è‚ªã€è›‹ç™½è´¨å’Œç¢³æ°´åŒ–åˆç‰©ç†æƒ³çš„æ‘„å…¥é‡çš„èŒƒå›´ã€‚</li>\n<li>å¸¸ç”¨å èƒ½é‡æ‘„å…¥é‡çš„ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚</li>\n<li>è¯¥èŒƒå›´å¯ä»¥æä¾›è¿™äº›å¿…éœ€è¥å…»ç´ çš„éœ€è¦ï¼Œå¹¶ä¸”æœ‰åˆ©äºé™ä½æ…¢æ€§ç—…å‘ç”Ÿçš„å±é™©ã€‚</li>\n<li>è„‚è‚ªçš„æ¨èæ‘„å…¥é‡èŒƒå›´ä¸º20%<del>35%ï¼Œè›‹ç™½è´¨ä¸º10%</del>20%ï¼Œç¢³æ°´åŒ–åˆç‰©ä¸º50%~65%ã€‚</li>\n</ul>\n</li>\n<li>é¢„é˜²éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„å»ºè®®æ‘„å…¥é‡ï¼ˆPI-NCD, proposed intakes for preventing non-communicable chronic diseases, ç®€ç§°å»ºè®®æ‘„å…¥é‡, PIï¼‰<ul>\n<li>æ˜¯ä»¥è†³é£Ÿç›¸å…³éä¼ æŸ“æ€§æ…¢æ€§ç—…çš„ä¸€çº§é¢„é˜²ä¸ºç›®æ ‡ï¼Œçªå‡ºçš„å¿…éœ€è¥å…»ç´ çš„æ¯æ—¥æ‘„å…¥é‡ã€‚</li>\n<li>å½“NCDæ˜“æ„Ÿäººç¾¤æŸäº›è¥å…»ç´ çš„æ‘„å…¥è¾¾åˆ°PIï¼Œå¯ä»¥é™ä½ä»–ä»¬å‘ç”ŸNCDçš„é£é™©ã€‚</li>\n<li>çœŸæ­£åˆ¶å®šå‡ºæ¥æ˜ç¡®çš„åªæœ‰ï¼šé’¾ã€é’ ã€ç»´ç”Ÿç´ cã€‚</li>\n</ul>\n</li>\n<li>ç‰¹å®šå»ºè®®å€¼ï¼ˆSPL, specific proposed levelsï¼‰<ul>\n<li>æ˜¯ä»¥é™ä½æˆå¹´äººè†³é£Ÿç›¸å…³éä¼ æŸ“æ€§ç–¾ç—…ä¸ºç›®æ ‡ï¼Œæå‡ºçš„å…¶ä»–è†³é£Ÿæˆåˆ†çš„æ¯æ—¥æ‘„å…¥é‡ï¼ˆæ°´å¹³ï¼‰ã€‚</li>\n<li>å½“è¯¥æˆåˆ†çš„æ‘„å…¥é‡è¾¾åˆ°SPLï¼Œå¯èƒ½æœ‰åˆ©äºé™ä½ç–¾ç—…çš„å‘ç”Ÿé£é™©æˆ–æ­»äº¡ç‡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"è¥å…»ä¸å¥åº·çš„å…³ç³»\"><a href=\"#è¥å…»ä¸å¥åº·çš„å…³ç³»\" class=\"headerlink\" title=\"è¥å…»ä¸å¥åº·çš„å…³ç³»\"></a>è¥å…»ä¸å¥åº·çš„å…³ç³»</h4><p><strong>è¥å…»ç´ çš„ç”Ÿç†åŠŸèƒ½</strong></p>\n<ul>\n<li>æä¾›èƒ½é‡</li>\n<li>æ„æˆç»†èƒç»„ç»‡ã€ä¾›ç»™ç”Ÿé•¿ã€å‘è‚²å’Œè‡ªæˆ‘æ›´æ–°æ‰€éœ€çš„ææ–™</li>\n<li>è°ƒèŠ‚æœºä½“ç”Ÿç†æ´»åŠ¨</li>\n</ul>\n<p><strong>è¥å…»ç´ è°ƒèŠ‚ç”Ÿç†åŠŸèƒ½çš„ä½“ç°</strong></p>\n<ul>\n<li>åŠ¨æ€å¹³è¡¡<ul>\n<li>èƒ½é‡å¹³è¡¡</li>\n<li>è¥å…»ç´ å¹³è¡¡</li>\n<li>æ°´ç›å¹³è¡¡</li>\n</ul>\n</li>\n<li>å†…ç¯å¢ƒçš„ç¨³æ€<ul>\n<li>ç¥ç»ç³»ç»Ÿè°ƒèŠ‚</li>\n<li>é…¶è°ƒèŠ‚</li>\n<li>æ¿€ç´ è°ƒèŠ‚</li>\n</ul>\n</li>\n</ul>\n<p><strong>è¥å…»æ˜¯ç»´æŒå¥åº·çš„åŸºç¡€</strong></p>\n<ul>\n<li>ç»´æŒäººä½“ç»„ç»‡çš„æ„æˆ</li>\n<li>ç»´æŒç”Ÿç†åŠŸèƒ½</li>\n<li>ç»´æŒå¿ƒç†å¥åº·</li>\n<li>é¢„é˜²ç–¾ç—…å‘ç”Ÿ</li>\n</ul>\n<p><strong>è¥å…»å¯¹äººç¾¤å¥åº·çš„è¥å…»</strong></p>\n<ul>\n<li>ä¿è¯å„¿ç«¥æ­£å¸¸ç”Ÿé•¿å‘è‚²å’Œå¿ƒç†å‘è‚²</li>\n<li>æ»¡è¶³å„ç±»ç‰¹æ®Šäººç¾¤çš„è¥å…»éœ€è¦</li>\n<li>å¢å¼ºç‰¹æ®Šç¯å¢ƒä¸‹äººç¾¤çš„æŠµæŠ—åŠ›ã€è€å—åŠ›ã€é€‚åº”æ€§</li>\n<li>é¢„é˜²è¥å…»ç´ çš„ç¼ºä¹ä¸è¿‡å¤šåŠç›¸å…³çš„ç–¾ç—…</li>\n<li>è¾…åŠ©å„ç§ç–¾ç—…çš„æ²»ç–—</li>\n</ul>\n"},{"title":"Nutritionâ€”catalog","date":"2025-09-28T02:19:44.000Z","_content":"","source":"_posts/20250928_Nutritio_catalog.md","raw":"---\ntitle: Nutritionâ€”catalog\ndate: 2025-09-28 10:19:44\ntags: [è¥å…»å­¦]\ncategories: [è¥å…»å­¦, æ­£è¯¾ç¬”è®°]\n---\n","slug":"20250928_Nutritio_catalog","published":1,"updated":"2025-09-28T02:20:51.057Z","comments":1,"layout":"post","photos":[],"_id":"cmg32pkii0000sou76le8apbr","content":"","excerpt":"","more":""}],"PostAsset":[],"PostCategory":[{"post_id":"cmfqa7j9n0000k4u7eg5zauep","category_id":"cmfqa7j9q0001k4u7dcu13wqm","_id":"cmfqa7j9s0004k4u71rb1bsov"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","category_id":"cmfqf6qtl0001kgu7gr5da4wd","_id":"cmfqf6qto0007kgu76qx8c6x8"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","category_id":"cmfqf6qtn0004kgu77vo0bvzo","_id":"cmfqf6qto0008kgu75n86f9sl"},{"post_id":"cmfxl35cu0001mwu79ia69gpd","category_id":"cmfqf6qtl0001kgu7gr5da4wd","_id":"cmfxl35cw0005mwu7g9ia8hfo"},{"post_id":"cmfxl35cu0001mwu79ia69gpd","category_id":"cmfxl35cw0003mwu70ovdcbrd","_id":"cmfxl35cw0006mwu7610l3pk9"},{"post_id":"cmfz1q7ls0000wou79t1q1ek5","category_id":"cmfz1q7lt0001wou78y7t9q6s","_id":"cmfz1q7lv0005wou74sux0r8m"},{"post_id":"cmg32pkii0000sou76le8apbr","category_id":"cmfz1q7lt0001wou78y7t9q6s","_id":"cmg32pkim0003sou7bonb9ua1"},{"post_id":"cmg32pkii0000sou76le8apbr","category_id":"cmg32pkil0002sou710gk60zb","_id":"cmg32pkim0004sou7ahkj7c0q"},{"post_id":"cmfz1q7ls0000wou79t1q1ek5","category_id":"cmg32pkin0005sou7e8xxcso9","_id":"cmg32pkin0006sou7e00yb6sg"}],"PostTag":[{"post_id":"cmfqa7j9n0000k4u7eg5zauep","tag_id":"cmfqa7j9r0002k4u70auagg1n","_id":"cmfqa7j9s0005k4u7d49ehavl"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqaawrm00002wu77uhfcxgw","_id":"cmfqf6qto0009kgu764z43yie"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqf6qtm0002kgu73imk89wb","_id":"cmfqf6qto000akgu72p5me3ha"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqf6qtn0003kgu7c2g94w08","_id":"cmfqf6qto000bkgu76vinfgf6"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqf6qto0005kgu75wq71oi4","_id":"cmfqf6qto000ckgu73nj6ay5b"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqf6qto0006kgu707qubog9","_id":"cmfqf6qto000dkgu712d68l5s"},{"post_id":"cmfqf6qtj0000kgu7a8n8a6iz","tag_id":"cmfqqo8zy000ekgu76meofylz","_id":"cmfqrejjx000gkgu79k7i9tw2"},{"post_id":"cmfxl35cu0001mwu79ia69gpd","tag_id":"cmfxl35cv0002mwu77hgk92ij","_id":"cmfxl35cw0004mwu76c8w5cfg"},{"post_id":"cmfz1q7ls0000wou79t1q1ek5","tag_id":"cmfz1q7lt0002wou7hgca7rvd","_id":"cmfz1q7lu0003wou76wrydc2j"},{"post_id":"cmg32pkii0000sou76le8apbr","tag_id":"cmfz1q7lt0002wou7hgca7rvd","_id":"cmg32pkil0001sou741f9ak4q"}],"Tag":[{"name":"Hexo","_id":"cmfqa7j9r0002k4u70auagg1n"},{"name":"åšå®¢","_id":"cmfqa7j9s0003k4u79i6p9yvi"},{"name":"Java","_id":"cmfqaawrm00002wu77uhfcxgw"},{"name":"Python","_id":"cmfqaawrn00012wu71h5vbcx2"},{"name":"AI","_id":"cmfqaawrn00022wu78t4fgs0c"},{"name":"RocketMQ","_id":"cmfqf6qtm0002kgu73imk89wb"},{"name":"åˆ†å¸ƒå¼","_id":"cmfqf6qtn0003kgu7c2g94w08"},{"name":"æ¶æ„","_id":"cmfqf6qto0005kgu75wq71oi4"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","_id":"cmfqf6qto0006kgu707qubog9"},{"name":"æºç ","_id":"cmfqqo8zy000ekgu76meofylz"},{"name":"study","_id":"cmfxl35cv0002mwu77hgk92ij"},{"name":"è¥å…»å­¦","_id":"cmfz1q7lt0002wou7hgca7rvd"}]}}